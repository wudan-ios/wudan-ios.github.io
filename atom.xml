<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¸€ä¸ªå­¤ç‹¬çš„æ¬ç çŒ¿</title>
  
  <subtitle>è™½ç„¶ä»£ç è™æˆ‘åƒç™¾éï¼Œæˆ‘å¯¹ä»£ç å¦‚åˆæ‹ã€‚</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wudan-ios.github.io/"/>
  <updated>2019-03-27T07:58:09.623Z</updated>
  <id>https://wudan-ios.github.io/</id>
  
  <author>
    <name>wudan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iOS å•å…ƒæµ‹è¯•</title>
    <link href="https://wudan-ios.github.io/2019/03/27/iOS%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
    <id>https://wudan-ios.github.io/2019/03/27/iOS å•å…ƒæµ‹è¯•/</id>
    <published>2019-03-27T07:58:09.443Z</published>
    <updated>2019-03-27T07:58:09.623Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-7bb4651d5a48524e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h2><p>ä»¥æµ‹è¯•ViewControllerä¸ºä¾‹ã€‚</p><h5 id="ViewController-hæ–‡ä»¶"><a href="#ViewController-hæ–‡ä»¶" class="headerlink" title="ViewController.hæ–‡ä»¶"></a>ViewController.hæ–‡ä»¶</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface ViewController : UIViewController</span><br><span class="line">/** é€»è¾‘æµ‹è¯• */</span><br><span class="line">- (int)getSumWithNum1:(int)a num2:(int)b;</span><br><span class="line">/** å¼‚æ­¥æµ‹è¯• */</span><br><span class="line">- (void)loadDataComplete:(void(^)(id info))complete;</span><br><span class="line">/** æ€§èƒ½æµ‹è¯• */</span><br><span class="line">- (void)openCamera;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h5 id="ViewController-mæ–‡ä»¶"><a href="#ViewController-mæ–‡ä»¶" class="headerlink" title="ViewController.mæ–‡ä»¶"></a>ViewController.mæ–‡ä»¶</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (int)getSumWithNum1:(int)a num2:(int)b &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)loadDataComplete:(void (^)(id))complete &#123;    </span><br><span class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSString *data = @&quot;ğŸ˜&quot;;</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            complete(data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)openCamera &#123;</span><br><span class="line">    for(int i = 0; i &lt; 1000; ++i) &#123;</span><br><span class="line">        NSLog(@&quot;è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²%d&quot;, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è¿›è¡Œå•å…ƒåŒ–æµ‹è¯•ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ª<code>ViewControllerTest</code>æ–‡ä»¶ã€‚<br>æ­¥éª¤<br><img src="https://upload-images.jianshu.io/upload_images/3334769-c0d1455212a740ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»ºæ–‡ä»¶"></p><ul><li>å¯¼å…¥æµ‹è¯•å¤´æ–‡ä»¶<code>#import &quot;ViewController.h&quot;</code></li><li>å£°æ˜å±æ€§<code>@property (nonatomic, strong) ViewController *vc;</code></li><li>åœ¨<code>- (void)setUp;</code>è¿›è¡Œåˆå§‹åŒ–ä»£ç <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)setUp &#123;</span><br><span class="line">    self.vc = [[ViewController alloc] init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="1ã€é€»è¾‘æµ‹è¯•"><a href="#1ã€é€»è¾‘æµ‹è¯•" class="headerlink" title="1ã€é€»è¾‘æµ‹è¯•"></a>1ã€é€»è¾‘æµ‹è¯•</h3><ol><li>ç»™å‡ºæµ‹è¯•æ•°æ®</li><li>è¿›è¡Œæµ‹è¯•</li><li>ä½¿ç”¨æ–­è¨€è¿›è¡Œåˆ¤å®š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)testSum &#123;</span><br><span class="line">    // 1. given</span><br><span class="line">    int a = 10;</span><br><span class="line">    int b = 22;</span><br><span class="line">    // 2. when</span><br><span class="line">    int sum = [self.vc getSumWithNum1:a num2:b];</span><br><span class="line">    // 3. then</span><br><span class="line">    XCTAssertEqual(sum, 32, @&quot;é”™è¯¯&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="2ã€å¼‚æ­¥æµ‹è¯•"><a href="#2ã€å¼‚æ­¥æµ‹è¯•" class="headerlink" title="2ã€å¼‚æ­¥æµ‹è¯•"></a>2ã€å¼‚æ­¥æµ‹è¯•</h3><ol><li>åˆ›å»º<code>XCTestExpectation</code>ï¼Œè®¾ç½®é”™è¯¯æç¤º</li><li>è°ƒç”¨æ–¹æ³•ï¼Œåœ¨å¼‚æ­¥ä¸­è°ƒç”¨<code>fulfill</code></li><li>è¿›è¡Œåˆ¤æ–­æ—¶é—´ï¼Œæ˜¯å¦åœ¨é¢„æœŸæ—¶é—´å†…å®¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">XCTestExpectation *exp = [self expectationWithDescription:@&quot;è¶…è¿‡é¢„æœŸæ—¶é—´&quot;];</span><br><span class="line">[self.vc loadDataComplete:^(id info) &#123;</span><br><span class="line">    XCTAssertNil(info, @&quot;æ•°æ®ä¸ºç©º&quot;);</span><br><span class="line">    [exp fulfill];</span><br><span class="line">&#125;];</span><br><span class="line">[self waitForExpectationsWithTimeout:4 handler:^(NSError * _Nullable error) &#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, error);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></li></ol><h3 id="3ã€æ€§èƒ½æµ‹è¯•"><a href="#3ã€æ€§èƒ½æµ‹è¯•" class="headerlink" title="3ã€æ€§èƒ½æµ‹è¯•"></a>3ã€æ€§èƒ½æµ‹è¯•</h3><p><img src="https://upload-images.jianshu.io/upload_images/3334769-96f0facc7307a744.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ€§èƒ½æµ‹è¯•"></p><ol><li>è®¾ç½®Baselineæ—¶é—´</li><li>Max STDDEV æœ€å¤§æ ·æœ¬æ ‡å‡†åå·®æ¯”ä¾‹</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)testPerformanceExample &#123;</span><br><span class="line">    [self measureBlock:^&#123;</span><br><span class="line">        [self.vc openCamera];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="UIæµ‹è¯•"><a href="#UIæµ‹è¯•" class="headerlink" title="UIæµ‹è¯•"></a>UIæµ‹è¯•</h2><p><img src="https://upload-images.jianshu.io/upload_images/3334769-0dc163b565bdcbf6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è„šæœ¬å½•åˆ¶"><br>1ã€å½•åˆ¶è„šæœ¬<br><br>2ã€ç¼–è¾‘è„šæœ¬<br><br>3ã€è‡ªåŠ¨åŒ–æµ‹è¯•</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-7bb4651d5a48524e.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å±æ€§ä¿®é¥°è¯</title>
    <link href="https://wudan-ios.github.io/2019/03/27/%E5%B1%9E%E6%80%A7%E4%BF%AE%E9%A5%B0%E8%AF%8D/"/>
    <id>https://wudan-ios.github.io/2019/03/27/å±æ€§ä¿®é¥°è¯/</id>
    <published>2019-03-27T02:19:31.456Z</published>
    <updated>2019-03-27T02:19:32.272Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-f0679730c4864b7b.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h3 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h3><p>é»˜è®¤æ ¼å¼ï¼š<code>@syntheszie var = _var;</code></p><p><code>ARC</code>ä¸­ï¼Œé»˜è®¤ä¿®é¥°<br></p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹<code>@property (atomic, assign)</code><br></li><li>å¯¹è±¡æ•°æ®ç±»å‹<code>@property (atomic, strong)</code></li></ul><h3 id="ä¿®é¥°è¯è§£é‡Š"><a href="#ä¿®é¥°è¯è§£é‡Š" class="headerlink" title="ä¿®é¥°è¯è§£é‡Š"></a>ä¿®é¥°è¯è§£é‡Š</h3><ul><li><p><code>nonatomic</code> éåŸå­æ€§è®¿é—®ï¼Œä¸å¯¹setæ–¹æ³•åŠ é”ï¼Œä¸æ˜¯å®‰å…¨çº¿ç¨‹ï¼Œä½†æ˜¯æ€§èƒ½é«˜ã€‚</p></li><li><p><code>atomic</code> åŸå­æ€§è®¿é—®ï¼Œå¯¹ç”Ÿæˆçš„ set æ–¹æ³•åŠ äº’æ–¥é” @synchronized(é”å¯¹è±¡ï¼‰ï¼Œå®‰å…¨çº¿ç¨‹ï¼ˆä¸æ˜¯ç»å¯¹å®‰å…¨çº¿ç¨‹ï¼‰,æ€§èƒ½å·®ã€‚</p></li><li><code>strong</code>ARCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œ<code>æ‹¥æœ‰å…³ç³»</code>ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚</li><li><code>reatain</code>MRCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œ<code>æ‹¥æœ‰å…³ç³»</code>ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚</li><li><code>assign</code>ä¿®é¥°åŸºç¡€æ•°æ®ç±»å‹ï¼Œç›´æ¥èµ‹å€¼ï¼Œ<code>éæ‹¥æœ‰å…³ç³»</code>ï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚</li><li><code>weak</code>ä¿®é¥°åè®®ï¼Œæ§ä»¶ï¼Œ<code>éæ‹¥æœ‰å…³ç³»</code>ï¼ŒæŒ‡å‘çš„å¯¹è±¡é”€æ¯ï¼ŒæŒ‡é’ˆä¼šè‡ªåŠ¨ç½®ä¸ºnilï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚</li><li><code>unsafe_unretained</code>ä¸weakç±»ä¼¼ï¼Œä¸ä¼šè‡ªåŠ¨nilåŒ–ï¼Œå¦‚æœæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸè¢«é‡Šæ”¾äº†ï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆã€‚</li><li><code>copy</code>åœ¨ MRC æ—¶æ˜¯è¿™æ ·åšçš„ release æ—§å¯¹è±¡( æ—§å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ -1 ) , copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ .ï¼ˆæ–°å¯¹è±¡æ˜¯æŒ‡æœ€ç»ˆæŒ‡å‘çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¸ç®¡æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼‰ï¼Œåœ¨ ARC æ—¶æ˜¯è¿™ä¹ˆå¹²çš„ copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ã€‚</li><li><code>readonly</code>åªç”Ÿæˆgetæ–¹æ³•ï¼Œä¸æƒ³æŠŠæš´éœ²çš„å±æ€§è¢«äººéšä¾¿æ›¿æ¢æ—¶ , å¯ä»¥ä½¿ç”¨ã€‚</li><li><code>readwrite</code>ç”Ÿæˆget/setæ–¹æ³•ã€‚</li></ul><h3 id="dynamic"><a href="#dynamic" class="headerlink" title="@dynamic"></a>@dynamic</h3><p>å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</p><h3 id="synthesize"><a href="#synthesize" class="headerlink" title="@synthesize"></a>@synthesize</h3><p>å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h3><p>çº¿ç¨‹åŒæ­¥é”</p><h3 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h3><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒ?</p><ul><li>ä½¿ç”¨<blockquote><ol><li>åè®®å£°æ˜ä½¿ç”¨weak</li><li>IBOutlet ä½¿ç”¨weak</li></ol></blockquote></li><li>weak å’Œ assign çš„ä¸åŒç‚¹:<blockquote><p>weak ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,ç³»ç»Ÿä¼šå°† weak ä¿®é¥°çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ nil,åœ¨ OC ç»™ nil å‘æ¶ˆæ¯æ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜çš„;å¦‚æœä½¿ç”¨ assign ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,å±æ€§å¯¹è±¡æŒ‡é’ˆè¿˜æŒ‡å‘åŸæ¥çš„å¯¹è±¡,ç”±äºå¯¹è±¡å·²ç»è¢«é”€æ¯,è¿™æ—¶å€™å°±äº§ç”Ÿäº†é‡æŒ‡é’ˆ,å¦‚æœè¿™æ—¶å€™åœ¨ç»™æ­¤å¯¹è±¡å‘é€æ¶ˆæ¯,å¾ˆå®¹é€ æˆç¨‹åºå¥”æºƒassigin å¯ä»¥ç”¨äºä¿®é¥°é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨ atomic ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—?</p><ul><li>ä¸æ˜¯,atomic çš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<blockquote><p>ä¾‹å¦‚ï¼š å£°æ˜ä¸€ä¸ª NSMutableArray çš„åŸå­å±æ€§ stuff,æ­¤æ—¶ self.stuff å’Œ self.stuff =othersulf éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯,ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p></blockquote></li></ul><p>ï¼ˆ3ï¼‰@synthesize å’Œ @dynamic åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨</p><ul><li><p>@property æœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯,ä¸€ä¸ªæ˜¯@synthesize,ä¸€ä¸ªæ˜¯@dynamicã€‚<br>å¦‚æœ@synthesize å’Œ@dynamic éƒ½æ²¡å†™,é‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯<br>@syntheszie var = _var;</p></li><li><p>@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p></li><li>@dynamic å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</li><li>å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼›ç„¶åä½ æ²¡æœ‰æä¾›@setter æ–¹æ³•å’Œ@getter æ–¹æ³•,ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜,ä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVar,ç”±äºç¼º setteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ;<br>æˆ–è€…å½“è¿è¡Œåˆ° someVar = instance.var æ—¶,ç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚</li></ul><p>ï¼ˆ4ï¼‰ARC ä¸‹,ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶,é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›?</p><ul><li><p>åŸºæœ¬æ•°æ®ï¼š  <code>atomic,readwrite,assign</code></p></li><li><p>æ™®é€šçš„ OC å¯¹è±¡: <code>atomic,readwrite,strong</code></p></li></ul><p>ï¼ˆ5ï¼‰ç”¨@property å£°æ˜çš„ NSString(æˆ– NSArray,NSDictionary)ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—,ä¸ºä»€ä¹ˆ?å¦‚æœæ”¹ç”¨ strong å…³é”®å­—,å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜?</p><blockquote><p>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨ copy çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨ copy æ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯ strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</p></blockquote><p>ï¼ˆ6ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜: @property(copy)NSMutableArray *array;</p><blockquote><p>å› ä¸º copy ç­–ç•¥æ‹·è´å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡,ç„¶è€Œå´æŠŠå®ƒå½“æˆå¯å˜å¯¹è±¡ä½¿ç”¨,å¾ˆå®¹æ˜“é€ æˆç¨‹åºå¥”æºƒè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”,ä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº,è¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜,é€šè¿‡å£°æ˜ nonatomic å¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶<br>å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€,åœ¨ iOS å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨ nonatomic æ›¿ä»£ atomic.</p></blockquote><p>ï¼ˆ7ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ç”¨ copy ä¿®é¥°ç¬¦?å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter?</p><blockquote><p>è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½,åˆ™éœ€å®ç° NSCopying åè®®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// å®ç°ä¸å¯å˜ç‰ˆæœ¬æ‹·è´</span><br><span class="line">- (id)copyWithZone:(NSZone *)zone; // å®ç°å¯å˜ç‰ˆæœ¬æ‹·è´</span><br><span class="line">- (id)mutableCopyWithZone:(NSZone *)zone;</span><br><span class="line">// é‡å†™å¸¦ copy å…³é”®å­—çš„ setter</span><br><span class="line">- (void)setName:(NSString *)name &#123;</span><br><span class="line">    _name = [name copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><h3 id="æ·±æ‹·è´å’Œæµ…æ‹·è´"><a href="#æ·±æ‹·è´å’Œæµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´å’Œæµ…æ‹·è´"></a>æ·±æ‹·è´å’Œæµ…æ‹·è´</h3><h4 id="copy-å’Œ-mutableCopy"><a href="#copy-å’Œ-mutableCopy" class="headerlink" title="copy å’Œ mutableCopy"></a>copy å’Œ mutableCopy</h4><ul><li><p><code>copy</code>æ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯ä¸å¯å˜ç±»å‹(ä¾‹å¦‚, NSString, NSDictionary, NSArrayç­‰ç­‰)</p></li><li><p><code>mutableCopy</code>æ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯å¯å˜ç±»å‹(ä¾‹å¦‚, NSMutableString, NSMutableDictionary, NSMutableArrayç­‰ç­‰)</p></li></ul><hr><ul><li><code>copy</code> å¯¹äºå¯å˜å¯¹è±¡ä¸ºæ·±æ‹·è´ï¼Œå¯¹äºä¸å¯å˜å¯¹è±¡ä¸ºæµ…æ‹·è´</li><li><code>mutableCopy</code> å§‹ç»ˆæ˜¯æ·±æ‹·è´</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-f0679730c4864b7b.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Block</title>
    <link href="https://wudan-ios.github.io/2019/03/26/Block/"/>
    <id>https://wudan-ios.github.io/2019/03/26/Block/</id>
    <published>2019-03-26T02:46:08.805Z</published>
    <updated>2019-03-26T02:46:08.997Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-cd0f22bd52a1e015.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h3 id="Blockçš„å®è´¨"><a href="#Blockçš„å®è´¨" class="headerlink" title="Blockçš„å®è´¨"></a>Blockçš„å®è´¨</h3><p>æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼Œä»–å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚Blockæ˜¯å°è£…äº†å‡½æ•°è°ƒç”¨ä»¥åŠå‡½æ•°è°ƒç”¨ç¯å¢ƒçš„OCå¯¹è±¡ã€‚</p><h3 id="Blockä¸‰ç§ç±»å‹"><a href="#Blockä¸‰ç§ç±»å‹" class="headerlink" title="Blockä¸‰ç§ç±»å‹"></a>Blockä¸‰ç§ç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>å­˜å‚¨åŒºåŸŸ</th></tr></thead><tbody><tr><td>GlobalBlock</td><td>æ•°æ®åŒº</td></tr><tr><td>StackBlock</td><td>æ ˆåŒº</td></tr><tr><td>MallocBlock</td><td>å †åŒº</td></tr></tbody></table><h3 id="Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼"><a href="#Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼"></a>Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼</h3><p>1ã€åˆ©ç”¨ <code>__weak</code>å’Œ<code>__strong</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> __weak typeof(self) weakSelf = self;</span><br><span class="line">self.block = ^&#123;</span><br><span class="line">    __strong typeof(self) strongSelf = weakSelf;</span><br><span class="line">    NSLog(@&quot;%@&quot;, NSStringFromCGRect(strongSelf.view.frame));</span><br><span class="line">&#125;;</span><br><span class="line">self.block();</span><br></pre></td></tr></table></figure></p><p>2ã€åˆ©ç”¨é€ æˆå¾ªç¯å¼•ç”¨çš„ä¸´æ—¶å˜é‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__block ViewController *vc = self;</span><br><span class="line">self.block = ^&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, NSStringFromCGRect(vc.view.frame));</span><br><span class="line">    vc = nil;</span><br><span class="line">&#125;;</span><br><span class="line">self.block();</span><br></pre></td></tr></table></figure></p><p>3ã€ç›´æ¥å£°æ˜Blockä¸­æ·»åŠ é€ æˆå¾ªç¯å¼•ç”¨çš„å‚æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^Block)(UIViewController *vc);</span><br><span class="line"></span><br><span class="line">self.block = ^(UIViewController *vc)&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, NSStringFromCGRect(vc.view.frame));</span><br><span class="line">&#125;;</span><br><span class="line">self.block(self);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-cd0f22bd52a1e015.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>KVO</title>
    <link href="https://wudan-ios.github.io/2019/03/26/KVO/"/>
    <id>https://wudan-ios.github.io/2019/03/26/KVO/</id>
    <published>2019-03-26T02:45:39.565Z</published>
    <updated>2019-03-26T02:45:40.608Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-0c2f7bf66b38a01a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h3 id="ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ"><a href="#ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ" class="headerlink" title="ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ"></a>ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ</h3><p>è§‚å¯Ÿå€¼çš„4ä¸­æ¨¡å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  NSKeyValueObservingOptionNew     æ–°å€¼</span><br><span class="line"> *  NSKeyValueObservingOptionOld     æ—§å€¼</span><br><span class="line"> *  NSKeyValueObservingOptionInitial æ³¨å†Œå‘é€é€šçŸ¥ï¼Œæ”¹å˜æ—¶å‘é€é€šçŸ¥</span><br><span class="line"> *  NSKeyValueObservingOptionPrior   æ”¹å˜ä¹‹å‰å‘é€é€šçŸ¥ï¼Œæ”¹å˜åå‘é€é€šçŸ¥</span><br><span class="line"> */</span><br></pre></td></tr></table></figure></p><p>é’ˆå¯¹<code>Person</code>ç±»é‡Œé¢çš„<code>name</code>å±æ€§è¿›è¡Œè§‚å¯Ÿ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹è§‚å¯Ÿ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context &#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, change);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰“å°æ•ˆæœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 09:20:16.875033+0800 KVO[1844:81256] &#123;</span><br><span class="line">    kind = 1;</span><br><span class="line">    new = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ"><a href="#ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ" class="headerlink" title="ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ"></a>ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ</h3><p>è§‚å¯Ÿ<code>Person</code>é‡Œé¢<code>Dog</code>ç±»çš„<code>age</code>ï¼Œé€šè¿‡ç‚¹è¯­æ³•ç›´æ¥ç›‘å¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[person addObserver:self forKeyPath:@&quot;dog.age&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥ç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 09:23:25.854859+0800 KVO[1876:84141] &#123;</span><br><span class="line">    kind = 1;</span><br><span class="line">    new = 11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼"><a href="#ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼" class="headerlink" title="ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼"></a>ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼</h3><p>ä¾‹å¦‚è§‚å¯Ÿ<code>Person</code>é‡Œé¢çš„<code>Dog</code>çš„<code>age</code>å’Œ<code>level</code>ï¼Œåˆ™åœ¨<code>Person</code>ç±»ä¸­é‡æ–°<code>+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key &#123;</span><br><span class="line">    NSSet *keyPaths = [super keyPathsForValuesAffectingValueForKey:key];</span><br><span class="line">    if ([key isEqualToString:@&quot;dog&quot;]) &#123;</span><br><span class="line">        NSArray *array = @[@&quot;_dog.name&quot;, @&quot;_dog.level&quot;];</span><br><span class="line">        keyPaths = [keyPaths setByAddingObjectsFromArray:array];</span><br><span class="line">    &#125;</span><br><span class="line">    return keyPaths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç›´æ¥è§‚å¯Ÿ<code>Dog</code>ç±»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[person addObserver:self forKeyPath:@&quot;dog&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br></pre></td></tr></table></figure></p><p>æ‰“å°ç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 09:27:11.485240+0800 KVO[1929:87568] &#123;</span><br><span class="line">    kind = 1;</span><br><span class="line">    new = &quot;&lt;Dog: 0x6000027c0b80&gt;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ‰‹åŠ¨æ¨¡å¼"><a href="#æ‰‹åŠ¨æ¨¡å¼" class="headerlink" title="æ‰‹åŠ¨æ¨¡å¼"></a>æ‰‹åŠ¨æ¨¡å¼</h3><p>åœ¨Personç±»ä¸­é‡å†™<code>+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key &#123;</span><br><span class="line">    // ä¿®æ”¹ä¸ºæ‰‹åŠ¨æ¨¡å¼</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰‹åŠ¨è§¦å‘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[self.person willChangeValueForKey:@&quot;name&quot;];</span><br><span class="line">[self.person didChangeValueForKey:@&quot;name&quot;];</span><br></pre></td></tr></table></figure></p><h3 id="è§‚å¯Ÿå®¹å™¨ç±»"><a href="#è§‚å¯Ÿå®¹å™¨ç±»" class="headerlink" title="è§‚å¯Ÿå®¹å™¨ç±»"></a>è§‚å¯Ÿå®¹å™¨ç±»</h3><p>éœ€è¦åˆ©ç”¨<code>KVC</code><br>ä¾‹å¦‚è§‚å¯Ÿ<code>person</code>ä¸­çš„<code>array</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[self.person mutableArrayValueForKey:@&quot;array&quot;] addObject:@&quot;obj&quot;];</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 11:02:13.996095+0800 KVO[5521:170395] &#123;</span><br><span class="line">    indexes = &quot;&lt;_NSCachedIndexSet: 0x600002216160&gt;[number of indexes: 1 (in 1 ranges), indexes: (0)]&quot;;</span><br><span class="line">    kind = 2;</span><br><span class="line">    new =     (</span><br><span class="line">        obj</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h3 id="KVOçš„åº•å±‚å®ç°"><a href="#KVOçš„åº•å±‚å®ç°" class="headerlink" title="KVOçš„åº•å±‚å®ç°"></a>KVOçš„åº•å±‚å®ç°</h3><p>å®è´¨ï¼šè§‚å¯Ÿå€¼çš„setteræ–¹æ³•<br>é€šè¿‡runtimeï¼Œæ–°å»ºä¸€ä¸ªå­ç±»ç»§æ‰¿äºè§‚å¯Ÿç±»ï¼ˆNSKVONotifing_ç±»åï¼‰ï¼ŒåŠ¨æ€çš„ä¿®æ”¹äº†è§‚å¯Ÿç±»çš„ç±»å‹ä¸ºå­ç±»çš„ç±»å‹,åœ¨å­ç±»é‡Œé¢é‡å†™setæ–¹æ³•ï¼Œè°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)setName:(NSString *)name &#123;</span><br><span class="line">    [self willChangeValueForKey:@&quot;name&quot;];</span><br><span class="line">    [super setName:name];</span><br><span class="line">    [self didChangeValueForKey:@&quot;name&quot;];   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-0c2f7bf66b38a01a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOS-3D Touch</title>
    <link href="https://wudan-ios.github.io/2019/03/21/iOS-3D%20Touch/"/>
    <id>https://wudan-ios.github.io/2019/03/21/iOS-3D Touch/</id>
    <published>2019-03-21T01:51:49.822Z</published>
    <updated>2019-03-21T02:05:23.145Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-f28947056b8dfe49.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h3 id="æ¡Œé¢å›¾æ ‡ç‚¹å‡»"><a href="#æ¡Œé¢å›¾æ ‡ç‚¹å‡»" class="headerlink" title="æ¡Œé¢å›¾æ ‡ç‚¹å‡»"></a>æ¡Œé¢å›¾æ ‡ç‚¹å‡»</h3><p>éœ€è¦åœ¨<code>AppDelegate</code>é‡Œé¢è¿›è¡Œä»£ç ç¼–å†™ã€‚<br>1ã€åˆ›å»ºæ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/** type  å”¯ä¸€æ ‡ç¤ºrç¬¦</span><br><span class="line">*  localizedTitle æ ‡é¢˜</span><br><span class="line">*  localizedSubtitle å‰¯æ ‡é¢˜</span><br><span class="line">*  icon UIApplicationShortcutIconå¯¹è±¡</span><br><span class="line">*  userInfo ä¼ é€’ä¿¡æ¯</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å›¾æ ‡ç”ŸæˆUIApplicationShortcutIconå¯¹è±¡</span><br><span class="line">UIApplicationShortcutItem *shoreItem1 = [[UIApplicationShortcutItem alloc] initWithType:@&quot;type1&quot;</span><br><span class="line">localizedTitle:@&quot;æ ‡é¢˜&quot;</span><br><span class="line">localizedSubtitle:@&quot;å‰¯æ ‡é¢˜&quot;</span><br><span class="line">icon:[UIApplicationShortcutIcon iconWithType:UIApplicationShortcutIconTypeCompose]</span><br><span class="line">userInfo:nil];</span><br><span class="line"></span><br><span class="line">// ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡ç”ŸæˆUIApplicationShortcutIconå¯¹è±¡</span><br><span class="line">UIApplicationShortcutItem *shoreItem2 = [[UIApplicationShortcutItem alloc] initWithType:@&quot;type2&quot;</span><br><span class="line">localizedTitle:@&quot;æ ‡é¢˜2&quot;</span><br><span class="line">localizedSubtitle:@&quot;å‰¯æ ‡é¢˜2&quot;</span><br><span class="line">icon:[UIApplicationShortcutIcon iconWithTemplateImageName:@&quot;éªŒè¯ç &quot;]</span><br><span class="line">userInfo:nil];</span><br><span class="line">[UIApplication sharedApplication].shortcutItems = @[shoreItem1, shoreItem2];</span><br></pre></td></tr></table></figure></p><blockquote><p>æ³¨ï¼šç³»ç»Ÿçš„UIApplicationShortcutIconæ ·å¼ï¼Œè‡ªå·±å»ç ”ç©¶å§ï¼<a href="https://developer.apple.com/documentation/uikit/uiapplicationshortcuticontype?language=objc" target="_blank" rel="noopener">ç‚¹å‡»è¿™ä¸ªæ˜¯å®˜æ–¹åœ°å€</a></p></blockquote><p>2ã€ç‚¹å‡»å›è°ƒï¼Œå¯ä»¥æ ¹æ®<code>shortcutItem.type</code> è¿›è¡Œåˆ¤æ–­ç‚¹å‡»çš„æ˜¯å“ªä¸ªitem<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void (^)(BOOL))completionHandler &#123;</span><br><span class="line">NSLog(@&quot;ç‚¹å‡»äº†%@&quot;, shortcutItem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åº”ç”¨å†…ï¼Œç‚¹å‡»è¿›è¡Œé¡µé¢æ“ä½œ"><a href="#åº”ç”¨å†…ï¼Œç‚¹å‡»è¿›è¡Œé¡µé¢æ“ä½œ" class="headerlink" title="åº”ç”¨å†…ï¼Œç‚¹å‡»è¿›è¡Œé¡µé¢æ“ä½œ"></a>åº”ç”¨å†…ï¼Œç‚¹å‡»è¿›è¡Œé¡µé¢æ“ä½œ</h3><p>1ã€éµå¾ªä»£ç†<code>UIViewControllerPreviewingDelegate</code></p><p>2ã€åˆ¤æ–­è®¾å¤‡æ˜¯å¦æ”¯æŒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (self.traitCollection.forceTouchCapability == UIForceTouchCapabilityAvailable)&#123;</span><br><span class="line">[self registerForPreviewingWithDelegate:self sourceView:self.view];</span><br><span class="line">NSLog(@&quot;3D Touch  å¯ç”¨!&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">NSLog(@&quot;3D Touch  ä¸å¯ç”¨!&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>3ã€å®ç°ä»£ç†æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (nullable UIViewController *)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext viewControllerForLocation:(CGPoint)location &#123;</span><br><span class="line">NextViewController *vc = [[NextViewController alloc] init];</span><br><span class="line">return vc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)previewingContext:(id&lt;UIViewControllerPreviewing&gt;)previewingContext commitViewController:(UIViewController *)viewControllerToCommit &#123;</span><br><span class="line">[self showViewController:viewControllerToCommit sender:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>4ã€åœ¨éœ€è¦æ˜¾ç¤ºçš„é¡µé¢é‡Œé¢è°ƒç”¨<code>- (NSArray&lt;id&lt;UIPreviewActionItem&gt;&gt; *)previewActionItems</code>æ·»åŠ Items<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray&lt;id&lt;UIPreviewActionItem&gt;&gt; *)previewActionItems &#123;</span><br><span class="line">UIPreviewAction *action1 = [UIPreviewAction actionWithTitle:@&quot;æ ‡é¢˜1&quot; style:UIPreviewActionStyleDefault handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) &#123;</span><br><span class="line">NSLog(@&quot;click---æ ‡é¢˜1&quot;);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">UIPreviewAction *action2 = [UIPreviewAction actionWithTitle:@&quot;æ ‡é¢˜2&quot; style:UIPreviewActionStyleSelected handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) &#123;</span><br><span class="line">NSLog(@&quot;click---æ ‡é¢˜2&quot;);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">UIPreviewAction *action3 = [UIPreviewAction actionWithTitle:@&quot;æ ‡é¢˜3&quot; style:UIPreviewActionStyleDestructive handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) &#123;</span><br><span class="line">NSLog(@&quot;click---æ ‡é¢˜3&quot;);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">NSArray *actions = @[action1,action2,action3];</span><br><span class="line">return actions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ¸©é¦¨æç¤º"><a href="#æ¸©é¦¨æç¤º" class="headerlink" title="æ¸©é¦¨æç¤º"></a>æ¸©é¦¨æç¤º</h3><ul><li>ç‚¹å‡»Appå›¾æ ‡æ˜¾ç¤ºæœ€åˆ†äº«æŒ‰é’®ï¼Œæ˜¯è‹¹æœç»™ä¸Šæ¶Appæ·»åŠ çš„<br><img src="https://upload-images.jianshu.io/upload_images/3334769-cffec3aa7180b169.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/680" alt="IMG_2873.PNG"></li><li>ç‚¹å‡»åˆ†äº«çš„æ•ˆæœ<br><img src="https://upload-images.jianshu.io/upload_images/3334769-ec648a2fc0916645.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/680" alt="IMG_2872.PNG"></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-f28947056b8dfe49.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Runtime-æ¶ˆæ¯è½¬å‘</title>
    <link href="https://wudan-ios.github.io/2019/03/19/Runtime-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/"/>
    <id>https://wudan-ios.github.io/2019/03/19/Runtime-æ¶ˆæ¯è½¬å‘/</id>
    <published>2019-03-19T05:15:50.881Z</published>
    <updated>2019-03-19T05:15:51.093Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://poldw0h4y.bkt.clouddn.com/%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" alt="æ¶ˆæ¯è½¬å‘æµç¨‹å›¾"></p><p>iOS æ–¹æ³•çš„åŠ¨æ€è§£æå’Œæ¶ˆæ¯è½¬å‘</p><p>ä»¥åˆ›å»ºçš„Messageç±»ä¸ºç¤ºä¾‹<br>Message.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@interface Message : NSObject</span><br><span class="line"></span><br><span class="line">- (void)sendMessage:(NSString *)message;</span><br><span class="line"></span><br><span class="line">+ (void)sendClassMessage:(NSString *)message;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><p>Message.m<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@implementation Message</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><h3 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h3><p>å¾è¯¢æ¥æ”¶è€…æ‰€å±çš„ç±»ï¼Œæ˜¯å¦éœ€è¦åŠ¨æ€æ·»åŠ ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ï¼Œæ¥å¤„ç†è¿™ä¸ªæœªæ‰¾åˆ°çš„æ–¹æ³•ã€‚</p><ol><li>é¦–å…ˆåˆ¤æ–­æ˜¯å¦å®ç°äº† <code>resolveInstanceMethod</code>ï¼Œå¦‚æœæ²¡æœ‰å®ç°ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›</li><li>å¦‚æœå®ç°äº†ï¼Œè°ƒç”¨ <code>resolveInstanceMethod</code>ï¼Œè·å–è¿”å›å€¼ï¼›</li><li>å¦‚æœè¿”å›å€¼ä¸º YESï¼Œè¡¨ç¤º <code>resolveInstanceMethod</code> å£°ç§°å®ƒå·²ç»æä¾›äº† <code>selector</code> çš„å®ç°ï¼Œå› æ­¤å†æ¬¡æŸ¥æ‰¾ method listï¼Œå¦‚æœæ‰¾åˆ°å¯¹åº”çš„ <code>IMP</code>ï¼Œåˆ™è¿”å›è¯¥å®ç°ï¼Œå¦åˆ™æç¤ºè­¦å‘Šä¿¡æ¯ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›</li><li>å¦‚æœè¿”å›å€¼ä¸º NOï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›<h4 id="1-å¯¹è±¡æ–¹æ³•"><a href="#1-å¯¹è±¡æ–¹æ³•" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4>é€šè¿‡<code>+ (BOOL)resolveInstanceMethod:(SEL)sel;</code>æ–¹æ³•è¿›è¡Œè§£æ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    if (sel == @selector(sendMessage:)) &#123;</span><br><span class="line">        class_addMethod([self class], sel, (IMP)innerSenderMessageMetod, &quot;v@:@&quot;);</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void innerSenderMessageMetod(id obj, SEL _cmd) &#123;</span><br><span class="line">    NSLog(@&quot;å¯¹è±¡æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="2-ç±»æ–¹æ³•"><a href="#2-ç±»æ–¹æ³•" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4><p>é€šè¿‡<code>+ (BOOL)resolveClassMethod:(SEL)sel;</code>æ–¹æ³•è¿›è¡Œè§£æ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)resolveClassMethod:(SEL)sel &#123;</span><br><span class="line">    if (sel == @selector(sendClassMessage:)) &#123;</span><br><span class="line">        class_addMethod(object_getClass(self), sel, (IMP)innerSenderClassMessageMetod, &quot;v@:@&quot;);</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super resolveClassMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void innerSenderClassMessageMetod(id obj, SEL _cmd) &#123;</span><br><span class="line">    NSLog(@&quot;ç±»æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3><p>å¦‚æœæ²¡æœ‰åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥æ­¤é˜¶æ®µï¼Œæ­¤æ—¶è¯¢é—®æ˜¯å¦è¦å°†è¿™æ¡æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–çš„å¯¹è±¡ï¼Œæ¥å¤„ç†è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœè¿”å›nilï¼Œå³è¡¨ç¤ºä¸è½¬å‘ç»™å…¶ä»–å¯¹è±¡ï¼Œæ­¤æ—¶ä¼šè¿›å…¥ç¬¬3é˜¶æ®µ<br>åˆ›å»ºäº†ä¸€ä¸ªå¤‡ç”¨ç±»<code>MessageTemp</code><br>MessageTemp.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface MessageTemp : NSObject</span><br><span class="line"></span><br><span class="line">- (void)sendMessage:(NSString *)message;</span><br><span class="line">- (void)sendClassMessage:(NSString *)message;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><p>MessageTemp.m<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@implementation MessageTemp</span><br><span class="line">- (void)sendMessage:(NSString *)message &#123;</span><br><span class="line">    NSLog(@&quot;å¤‡ç”¨Messageï¼Œè§£æå¯¹è±¡æ–¹æ³•&quot;);</span><br><span class="line">&#125;</span><br><span class="line">- (void)sendClassMessage:(NSString *)message &#123;</span><br><span class="line">    NSLog(@&quot;å¤‡ç”¨Messageï¼Œè§£æç±»æ–¹æ³•&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><h4 id="1-å¯¹è±¡æ–¹æ³•-1"><a href="#1-å¯¹è±¡æ–¹æ³•-1" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector == @selector(sendMessage:)) &#123;</span><br><span class="line">        return [MessageTemp new];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•-1"><a href="#2-ç±»æ–¹æ³•-1" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (id)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector == @selector(sendClassMessage:)) &#123;</span><br><span class="line">        return [MessageTemp new];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h3><p>å½“ <code>forwardingTargetForSelector:</code> æ–¹æ³•æœªåšå‡ºä»»ä½•å“åº”çš„è¯ï¼Œä¼šæ¥åˆ°æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚æ¶ˆæ¯è½¬å‘æ—¶ä¼šé¦–å…ˆè°ƒç”¨ <code>methodSignatureForSelector:</code> æ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…éƒ¨ç”Ÿæˆ <code>NSMethodSignature</code> ç±»å‹çš„æ–¹æ³•ç­¾åå¯¹è±¡ã€‚åœ¨ç”Ÿæˆç­¾åå¯¹è±¡æ—¶ï¼Œå¯ä»¥æŒ‡å®š <code>target</code> å’Œ <code>SEL</code>ï¼Œå¯ä»¥å°†è¿™ä¸¤ä¸ªå‚æ•°æ¢æˆå…¶ä»–å‚æ•°ï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚</p><h4 id="1-å¯¹è±¡æ–¹æ³•-2"><a href="#1-å¯¹è±¡æ–¹æ³•-2" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation &#123;</span><br><span class="line">    if ([anInvocation selector] == @selector(sendMessage:)) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:[MessageTemp new]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [super forwardInvocation:anInvocation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector == @selector(sendMessage:)) &#123;</span><br><span class="line">        return [NSMethodSignature signatureWithObjCTypes:&quot;v@:@&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•-2"><a href="#2-ç±»æ–¹æ³•-2" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+ (void)forwardInvocation:(NSInvocation *)anInvocation &#123;</span><br><span class="line">    if ([anInvocation selector] == @selector(sendClassMessage:)) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:[MessageTemp new]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [super forwardInvocation:anInvocation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector == @selector(sendClassMessage:)) &#123;</span><br><span class="line">        return [NSMethodSignature signatureWithObjCTypes:&quot;v@:@&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ul><li>é€‚ç”¨äºæŠŠæ“ä½œç»™å¦å¤–ä¸€ä¸ªç±»æ¥å®ç°</li><li>åˆ©ç”¨åˆ†ç±»ï¼Œé˜²æ­¢åº”ç”¨ç¨‹åºå› ä¸ºæœªå¤„ç†æ¶ˆæ¯è€Œå´©æºƒ</li><li>Jspatch </li><li>Aspects</li><li>BlocksKit</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;http://poldw0h4y.bkt.clouddn.com/%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg&quot; alt=&quot;æ¶ˆæ¯è½¬å‘æµç¨‹å›¾&quot;&gt;&lt;/p&gt;
&lt;p&gt;iOS
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSä»£ç å—(Snippet)</title>
    <link href="https://wudan-ios.github.io/2019/03/13/%E4%BB%A3%E7%A0%81%E5%9D%97(Snippet)/"/>
    <id>https://wudan-ios.github.io/2019/03/13/ä»£ç å—(Snippet)/</id>
    <published>2019-03-13T03:03:18.597Z</published>
    <updated>2019-03-13T03:03:18.811Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-b07622a36a646add.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><p>ä»£ç å—(Snippet)ï¼Œæ–¹ä¾¿äº†ä»£ç å¿«é€Ÿåˆ›å»ºã€‚</p><h4 id="ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’"><a href="#ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’" class="headerlink" title="ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’"></a>ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-80379a923c19ef74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»£ç å—ç®¡ç†"></p><h4 id="æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»"><a href="#æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»" class="headerlink" title="æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»"></a>æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-52aa3439524de38c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ·»åŠ "></p><h4 id="ç¼–è¾‘"><a href="#ç¼–è¾‘" class="headerlink" title="ç¼–è¾‘"></a>ç¼–è¾‘</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-df39d293cbb6e8b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¼–è¾‘"></p><ol><li>Titleï¼šæ ‡é¢˜ã€‚ </li><li>Summaryï¼šæè¿°æ–‡å­—ã€‚ </li><li>Platformï¼šå¯ä»¥ä½¿ç”¨çš„å¹³å°ï¼ˆå¦‚iOSã€Mac OSï¼‰ã€‚ </li><li>Languageï¼šå¯ä»¥åœ¨å“ªäº›è¯­è¨€ä¸­ä½¿ç”¨ï¼ˆå¦‚ Objective-Cã€Swiftï¼‰ã€‚ </li><li>Completion Shortcutï¼šå¿«æ·æ–¹å¼ï¼Œä»¥å­—æ¯å¼€å¤´ï¼ˆæ”¯æŒå°‘æ•°ç¬¦å·ï¼Œå¦‚@ï¼‰ã€‚ </li><li>Completion Scopesï¼šä½œç”¨èŒƒå›´ï¼Œä¸€èˆ¬å†™åœ¨æ­£ç¡®çš„ä½ç½®æ‹–åŠ¨å³å¯ï¼ŒXcodeä¼šè‡ªè¡Œé€‰æ‹©å¥½ã€‚<h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) &lt;#ClassName#&gt; *&lt;#class#&gt;; ///&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, assign) &lt;#DataType#&gt; &lt;#name#&gt;; ///&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, copy) &lt;#ClassName#&gt; *&lt;#name#&gt;; ///&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, weak) id&lt;&lt;#delegateOrDataSouce#&gt;&gt; &lt;#delegateOrDataSouce#&gt;; ///&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, weak) &lt;#Class#&gt; *&lt;#name#&gt;; ///&lt; &lt;#æ³¨é‡Š#&gt;</span><br></pre></td></tr></table></figure></li></ol><h4 id="å¸¸ç”¨æ³¨é‡Š"><a href="#å¸¸ç”¨æ³¨é‡Š" class="headerlink" title="å¸¸ç”¨æ³¨é‡Š"></a>å¸¸ç”¨æ³¨é‡Š</h4><ol><li><p>é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/** &lt;#å±æ€§æ³¨é‡Š#&gt; */</span><br></pre></td></tr></table></figure></li><li><p>å³ä¾§æ³¨é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">///&lt; &lt;#æ³¨é‡Š#&gt;</span><br></pre></td></tr></table></figure></li><li><p>ç®€è¿°é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/** &lt;#ç®€è¦æè¿°#&gt;</span><br><span class="line"> * &lt;#è¯¦ç»†æè¿°#&gt;</span><br><span class="line"> */</span><br></pre></td></tr></table></figure></li><li><p>Pragma</p></li></ol><ul><li><p>æœ‰åˆ†å‰²çº¿</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark &lt;#mark#&gt;</span><br></pre></td></tr></table></figure></li><li><p>æ— åˆ†å‰²çº¿</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - &lt;#mark&gt; æˆ– // MARK: &lt;#mark#&gt;</span><br></pre></td></tr></table></figure></li></ul><ol start="5"><li><p>Warning(è­¦å‘Š)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#warning &lt;#message#&gt;</span><br></pre></td></tr></table></figure></li><li><p>???(ä¸ç¡®å®š)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// ???: &lt;#???#&gt;</span><br></pre></td></tr></table></figure></li><li><p>!!!(è­¦å‘Š)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// !!!: &lt;#???#&gt;</span><br></pre></td></tr></table></figure></li><li><p>FIXME(éœ€è¦ä¿®æ”¹çš„åœ°æ–¹)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// FIXME: &lt;#Fixè¯¦æƒ…#&gt;</span><br></pre></td></tr></table></figure></li><li><p>å¸¸ç”¨æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - é¡µé¢æ§ä»¶é…ç½®</span><br><span class="line">- (void)setupSubViewsProperties &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - é¡µé¢æ§ä»¶å¸ƒå±€</span><br><span class="line">- (void)setupSubViewsConstraint &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æšä¸¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, &lt;#TypeName#&gt;) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">typedef NS_OPTIONS(NSUInteger, &lt;#TypeName#&gt;) &#123;</span><br><span class="line">                </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>IFDEBUG</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#if DEBUG</span><br><span class="line">&lt;#TODO#&gt;</span><br><span class="line">#else</span><br><span class="line">&lt;#TODO#&gt;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></li><li><p>å¿«æ·åˆå§‹åŒ–UILabel</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UILabel *l = [[UILabel alloc] init];</span><br><span class="line">l.font = [UIFont &lt;#font#&gt;];</span><br><span class="line">l.text = @&quot;&lt;#conent#&gt;&quot;;</span><br><span class="line">l.textColor = [UIColor &lt;#textColor#&gt;];</span><br><span class="line">l.numberOfLines = 0;</span><br><span class="line">[&lt;#view#&gt; addSubview:l];</span><br></pre></td></tr></table></figure></li><li><p>å¿«æ·åˆå§‹åŒ–UIButton</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIButton *b = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">b.backgroundColor = [UIColor &lt;#backgroundColor#&gt;];</span><br><span class="line">b.titleLabel.font = [UIFont &lt;#font#&gt;];</span><br><span class="line">[b setTitle:&lt;#title#&gt; forState:UIControlStateNormal];</span><br><span class="line">[b setTitleColor:[UIColor &lt;#titleColor#&gt;] forState:UIControlStateNormal];</span><br><span class="line">[b setImage:[UIImage imageNamed:&lt;#(nonnull NSString *)#&gt;] forState:UIControlStateNormal]</span><br><span class="line">[b addTarget:self action:@selector(didTapped&lt;#Button Name#&gt;:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">[&lt;#view#&gt; addSubview:b];</span><br></pre></td></tr></table></figure></li><li><p>UIButton ç‚¹å‡»äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/** &lt;#ButtonName#&gt;ç‚¹å‡»äº‹ä»¶ */</span><br><span class="line">- (void)didTapped&lt;#ButtonName#&gt;:(UIButton *)sender &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Notificationäº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/** &lt;#Notification Name#&gt;é€šçŸ¥äº‹ä»¶ */</span><br><span class="line">- (void)didReceive&lt;#Notification Name#&gt;:(NSNotification *)notification &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>UIGestureRecognizerè§¦æ‘¸äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/** &lt;#GestureRecognizer Name#&gt;è§¦æ‘¸äº‹ä»¶ */</span><br><span class="line">- (void)didRecognized&lt;#GestureRecognizer Name#&gt;:(UIGestureRecognizer *)recognizer &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h4><p>è¿™ä¹Ÿæ˜¯ä¸ºäº†ä¸ªäººæ„è§ï¼Œå…¶ä»–è¿˜æœ‰å¾ˆå¤šå¯ä»¥åšæˆä»£ç å—çš„ï¼Œä¾‹å¦‚CGDï¼ŒTableViewDataSourceç­‰ç­‰ï¼Œå¸Œæœ›çŸ­çŸ­çš„æ–‡ç« å¯ä»¥è®©ä½ ä»£ç å¯ä»¥å†™çš„æ›´å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-b07622a36a646add.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSå·¥å…·ç±»-æ—¶é—´å·®</title>
    <link href="https://wudan-ios.github.io/2019/02/26/iOS%E5%B7%A5%E5%85%B7%E7%B1%BB-%E6%97%B6%E9%97%B4%E5%B7%AE/"/>
    <id>https://wudan-ios.github.io/2019/02/26/iOSå·¥å…·ç±»-æ—¶é—´å·®/</id>
    <published>2019-02-26T06:56:01.346Z</published>
    <updated>2019-02-26T07:48:48.016Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-073af85178d8c456.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><p>æœ€è¿‘æƒ³å†™ç‚¹æ—¥å¸¸ä½¿ç”¨çš„å·¥å…·ç±»ï¼Œæ–¹ä¾¿å¼€å‘ã€‚<br>é¦–å…ˆæƒ³åˆ°å°±æ˜¯æ—¶é—´ä¹‹ç±»çš„é—®é¢˜ï¼Œæ‰€ä»¥æ‰“å¼€<code>Xocde</code>ï¼Œè¿›è¡Œä»£ç ç¼–è¾‘ã€‚<br>è¿™ä¸ªä»£ç è€ƒè™‘ä¸æ˜¯å¾ˆå®Œå…¨ï¼Œæ—¥åæœ‰æ—¶é—´å†è¿›è¡Œä¿®æ”¹è¡¥å……ã€‚</p><h3 id="æ¥å£æ–‡ä»¶"><a href="#æ¥å£æ–‡ä»¶" class="headerlink" title="æ¥å£æ–‡ä»¶"></a>æ¥å£æ–‡ä»¶</h3><p>æˆ‘ä½¿ç”¨çš„ç±»åç§°ä¸º<code>DateHandleUtils</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, WeiBoTimeStyle) &#123;</span><br><span class="line">    WeiBoTimeStyleSecond,</span><br><span class="line">    WeiBoTimeStyleMillisecond</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface DateHandleUtils : NSObject</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ ¹æ®æ—¶é—´è¿”å›æ–‡å­—æ—¶é—´æˆ³</span><br><span class="line"></span><br><span class="line"> @param timeInterval æ¯”è¾ƒæ—¶é—´</span><br><span class="line"> @param style æ—¶é—´æˆ³æ ¼å¼</span><br><span class="line"> @return `åˆšåˆš`ã€`10ç§’å‰`ã€`10åˆ†é’Ÿå‰`ã€`1å°æ—¶å‰`ç­‰ç­‰</span><br><span class="line"> */</span><br><span class="line">+ (NSString *)weiboTimeWithPublicTime:(NSTimeInterval)timeInterval timeStyel:(WeiBoTimeStyle)style;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å½“å‰æ—¶é—´æ—¶é—´æˆ³</span><br><span class="line"> *</span><br><span class="line"> @return æ¯«ç§’çš„æ—¶é—´æˆ³</span><br><span class="line"> */</span><br><span class="line">+ (NSTimeInterval)currentMilliSecondTimeInterval;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å½“å‰æ—¶é—´æ—¶é—´æˆ³</span><br><span class="line"> *</span><br><span class="line"> @return ç§’çš„æ—¶é—´æˆ³</span><br><span class="line"> */</span><br><span class="line">+ (NSTimeInterval)currentSecondTimeInterval;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ ¹æ®æ—¶é—´æˆ³è·å–æ—¶é—´å·®</span><br><span class="line"> *</span><br><span class="line"> @param startTime å¼€å§‹æ—¶é—´çš„æ—¶é—´æˆ³</span><br><span class="line"> @param endTime ç»“æŸæ—¶é—´çš„æ—¶é—´æˆ³</span><br><span class="line"> @return è¿”å›å·®å€¼ï¼Œå•ä½ä¸ºç§’</span><br><span class="line"> @warning ä¼ å€¼æ ¼å¼ä¸ºï¼šæ¯«ç§’çº§æ—¶é—´æˆ³</span><br><span class="line"> */</span><br><span class="line">+ (NSTimeInterval)timeDifferenceOfMillisecondWithStartTimeInterval:(NSTimeInterval)startTime endTimeInterval:(NSTimeInterval)endTime;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ ¹æ®æ—¶é—´æˆ³è·å–æ—¶é—´å·®</span><br><span class="line"> *</span><br><span class="line"> @param startTime å¼€å§‹æ—¶é—´çš„æ—¶é—´æˆ³</span><br><span class="line"> @param endTime ç»“æŸæ—¶é—´çš„æ—¶é—´æˆ³</span><br><span class="line"> @return è¿”å›å·®å€¼ï¼Œå•ä½ä¸ºç§’</span><br><span class="line"> @warning ä¼ å€¼æ ¼å¼ä¸ºï¼šç§’çº§æ—¶é—´æˆ³</span><br><span class="line"> */</span><br><span class="line">+ (NSTimeInterval)timeDifferenceOfSecondsWithStartTimeInterval:(NSTimeInterval)startTime endTimeInterval:(NSTimeInterval)endTime;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure></p><h3 id="å®ç°æ–‡ä»¶"><a href="#å®ç°æ–‡ä»¶" class="headerlink" title="å®ç°æ–‡ä»¶"></a>å®ç°æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">@implementation DateHandleUtils</span><br><span class="line"></span><br><span class="line">+ (NSString *)weiboTimeWithPublicTime:(NSTimeInterval)timeInterval timeStyel:(WeiBoTimeStyle)style &#123;</span><br><span class="line">    NSTimeInterval interval;</span><br><span class="line">        switch (style) &#123;</span><br><span class="line">        case WeiBoTimeStyleSecond:</span><br><span class="line">            interval = [DateHandleUtils timeDifferenceOfSecondsWithStartTimeInterval:timeInterval endTimeInterval:[DateHandleUtils currentSecondTimeInterval]];</span><br><span class="line">            break;</span><br><span class="line">        case WeiBoTimeStyleMillisecond:</span><br><span class="line">            interval = [DateHandleUtils timeDifferenceOfMillisecondWithStartTimeInterval:timeInterval endTimeInterval:[DateHandleUtils currentMilliSecondTimeInterval]];</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (interval &lt; 10) &#123;</span><br><span class="line">        return @&quot;åˆšåˆš&quot;;</span><br><span class="line">    &#125; else if (interval &lt; 60) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%.fç§’å‰&quot;, interval];</span><br><span class="line">    &#125; else if (interval / 60 &lt; 60) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%.fåˆ†é’Ÿå‰&quot;, interval / 60];</span><br><span class="line">    &#125; else if (interval / 60 / 60 &lt; 24) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%.få°æ—¶å‰&quot;, interval / 60 / 60 - 1];</span><br><span class="line">    &#125; else if (interval / 60 / 60 / 24 &lt; 30) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%.få¤©å‰&quot;, interval / 60 / 60 / 24];</span><br><span class="line">    &#125; else if (interval / 60 / 60 / 24 / 30 &lt; 12) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%.fæœˆå‰&quot;, interval / 60 / 60 / 24 / 30];</span><br><span class="line">    &#125; else if (interval / 60 / 60 / 24 / 30 / 12 &gt;= 1)&#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%.få¹´å‰&quot;, interval / 60 / 60 / 24 / 30 / 12];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return @&quot;æœªçŸ¥æ—¶é—´&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSTimeInterval)currentMilliSecondTimeInterval &#123;</span><br><span class="line">    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];</span><br><span class="line">    [formatter setDateStyle: NSDateFormatterMediumStyle];</span><br><span class="line">    [formatter setTimeStyle: NSDateFormatterShortStyle];</span><br><span class="line">    [formatter setDateFormat: @&quot;YYYY-MM-dd HH:mm:ss SSS&quot;];</span><br><span class="line">    </span><br><span class="line">    NSTimeZone *timeZone = [NSTimeZone timeZoneWithName: @&quot;Asia/Shanghai&quot;];</span><br><span class="line">    [formatter setTimeZone: timeZone];</span><br><span class="line">    NSDate *datenow = [NSDate date];</span><br><span class="line">    return [datenow timeIntervalSince1970] * 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSTimeInterval)currentSecondTimeInterval &#123;</span><br><span class="line">    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];</span><br><span class="line">    [formatter setDateStyle: NSDateFormatterMediumStyle];</span><br><span class="line">    [formatter setTimeStyle: NSDateFormatterShortStyle];</span><br><span class="line">    [formatter setDateFormat: @&quot;YYYY-MM-dd HH:mm:ss SSS&quot;];</span><br><span class="line">    </span><br><span class="line">    NSTimeZone *timeZone = [NSTimeZone timeZoneWithName: @&quot;Asia/Shanghai&quot;];</span><br><span class="line">    [formatter setTimeZone: timeZone];</span><br><span class="line">    NSDate *datenow = [NSDate date];</span><br><span class="line">    return [datenow timeIntervalSince1970];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSTimeInterval)timeDifferenceOfMillisecondWithStartTimeInterval:(NSTimeInterval)startTime endTimeInterval:(NSTimeInterval)endTime &#123;</span><br><span class="line">    if (startTime &lt; endTime) &#123;</span><br><span class="line">        return (endTime - startTime) / 1000;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return (startTime - endTime) / 1000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSTimeInterval)timeDifferenceOfSecondsWithStartTimeInterval:(NSTimeInterval)startTime endTimeInterval:(NSTimeInterval)endTime &#123;</span><br><span class="line">    if (startTime &lt; endTime) &#123;</span><br><span class="line">        return (endTime - startTime);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return (startTime - endTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><p>éƒ½æ˜¯ç±»æ–¹æ³•ï¼Œç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ç±»åè°ƒç”¨å°±å¯ä»¥äº†(å®ä¾‹ï¼š<code>[DateHandleUtils currentMilliSecondTimeInterval];</code>);</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-073af85178d8c456.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSå¼€å‘æŠ€å·§-ä¸æ–­æ›´æ–°ä¸­</title>
    <link href="https://wudan-ios.github.io/2019/01/24/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"/>
    <id>https://wudan-ios.github.io/2019/01/24/å¼€å‘æŠ€å·§/</id>
    <published>2019-01-24T06:23:46.585Z</published>
    <updated>2019-03-18T02:48:04.187Z</updated>
    
    <content type="html"><![CDATA[<p>1ã€PrefixHeaderå¯¼å…¥ä½ç½®å†™æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(SRCROOT)/$(PROJECT_NAME)/&lt;#æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹åç§°#&gt;/PrefixHeader.pch</span><br></pre></td></tr></table></figure></p><p>2ã€éšè—å¯¼èˆªæ çš„ä¸¤ç§æ–¹å¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//æ–¹å¼ä¸€ ã€Šæ¨èã€‹</span><br><span class="line">//åœ¨éœ€è¦éšè—çš„viewControllerä¸­éµå¾ª&lt;UINavigationControllerDelegate&gt;</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line"> // è®¾ç½®å¯¼èˆªæ§åˆ¶å™¨çš„ä»£ç†ä¸ºself</span><br><span class="line">    self.navigationController.delegate = self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UINavigationControllerDelegate</span><br><span class="line">// å°†è¦æ˜¾ç¤ºæ§åˆ¶å™¨</span><br><span class="line">- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated &#123;</span><br><span class="line">    // åˆ¤æ–­è¦æ˜¾ç¤ºçš„æ§åˆ¶å™¨æ˜¯å¦æ˜¯è‡ªå·±</span><br><span class="line">    BOOL isShowHomePage = [viewController isKindOfClass:[self class]];</span><br><span class="line">    </span><br><span class="line">    [self.navigationController setNavigationBarHidden:isShowHomePage animated:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ–¹å¼äºŒ</span><br><span class="line">- (void)viewWillAppear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line"></span><br><span class="line">    [self.navigationController setNavigationBarHidden:YES animated:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewWillDisappear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillDisappear:animated];</span><br><span class="line"></span><br><span class="line">    [self.navigationController setNavigationBarHidden:NO animated:YES];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>3ã€TabBarItemè¦æ±‚åªæ˜¾ç¤ºå›¾ç‰‡ä¸æ˜¾ç¤ºæ–‡å­—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// self è¡¨ç¤ºéœ€è¦è®¾ç½®æ ·å¼çš„æ§åˆ¶å™¨</span><br><span class="line">[self.tabBarItem setImageInsets:UIEdgeInsetsMake(6, 0, -6, 0)];</span><br></pre></td></tr></table></figure></p><p>4ã€TableViewæˆ–CollectionViewå•é€‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æ­¥éª¤ä¸€ã€ å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡--&gt;</span><br><span class="line">@property (nonatomic, assign) NSInteger selectedIndex;</span><br><span class="line">&lt;!--æ­¥éª¤äºŒã€TableViewæˆ–CollectionViewç‚¹å‡»äº‹ä»¶çš„æ–¹æ³•ä¸­ä¿å­˜ç‚¹å‡»çš„indexï¼Œå¹¶åˆ·æ–°--&gt;</span><br><span class="line">self.selectedIndex = indexPath.row;</span><br><span class="line">[collectionView reloadData];æˆ–[tableView reloadData];</span><br><span class="line">&lt;!--æ­¥éª¤ä¸‰ã€åœ¨cellForItemAtIndexPathæˆ–cellForRowAtIndexPathæ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦æ˜¯æ‰€ä¿å­˜çš„index--&gt;</span><br><span class="line">if (self.selectedIndex == indexPath.row) &#123;</span><br><span class="line">    // è®¾ç½®é€‰ä¸­æ ·å¼</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // è®¾ç½®æˆé»˜è®¤æ ·å¼    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>5ã€æ€ä¹ˆåŒºåˆ†çœŸæœºè¿˜æ˜¯æ¨¡æ‹Ÿå™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#if TARGET_IPHONE_SIMULATOR  </span><br><span class="line">    NSLog(@&quot;run on simulator&quot;);  </span><br><span class="line">#define SIMULATOR_TEST</span><br><span class="line">#else  </span><br><span class="line">//ä¸å®šä¹‰SIMULATOR_TESTè¿™ä¸ªå®</span><br><span class="line">    NSLog(@&quot;run on device&quot;);  </span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></p><p>6ã€if Debug<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifdef DEBUG    </span><br><span class="line">// do sth</span><br><span class="line">#else   </span><br><span class="line">// do sth</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></p><p>7ã€ä¸€é”®æ¸…ç†æ‰€æœ‰æ¨¡æ‹Ÿå™¨å®‰è£…è¿‡çš„APP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å…ˆå…³é—­æ‰€æœ‰æ¨¡æ‹Ÿå™¨ åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸‹é¢å‘½ä»¤å³å¯</span><br><span class="line">xcrun simctl erase all</span><br></pre></td></tr></table></figure></p><p>8ã€SDWebImageæ¸…ç†ç¼“å­˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)didReceiveMemoryWarning &#123;</span><br><span class="line">    [super didReceiveMemoryWarning];</span><br><span class="line">    [[[SDWebImageManager sharedManager] imageCache] clearMemory];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>9ã€UITableViewçš„HeaderViewä¸‹æ‹‰æ”¾å¤§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1ã€View1:ä½œä¸ºæ˜¾ç¤ºView</span><br><span class="line">2ã€View2:ä½œä¸ºtableViewçš„tableHeaderViewï¼Œå¹¶æ·»åŠ View1ï¼ŒView2çš„å¤§å°å’ŒView1å¤§å°ç›¸åŒ.</span><br><span class="line">3ã€åœ¨UIScrollViewDelegateæ–¹æ³•ä¸­è¿›è¡Œè®¾è®¡</span><br><span class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView &#123;</span><br><span class="line">    CGFloat width = UIScreen.mainScreen.bounds.size.width;</span><br><span class="line">    CGFloat viewHeight = kScreenWidth * 0.5; // View1çš„åˆå§‹é«˜åº¦</span><br><span class="line">    CGFloat yOffset = scrollView.contentOffset.y;</span><br><span class="line">    if (yOffset &lt; 0) &#123;</span><br><span class="line">        CGFloat totalOffset = viewHeight + ABS(yOffset);</span><br><span class="line">        CGFloat f = totalOffset / viewHeight;</span><br><span class="line">        self.headerView.frame = CGRectMake(- (width * f - width) / 2, yOffset, width * f, totalOffset);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>10ã€Masonryåˆ¶ä½œå°±å®«æ ¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">//Objective-C ----&gt; Masonry</span><br><span class="line">/**</span><br><span class="line"> å¤šè§†å›¾å¸ƒå±€</span><br><span class="line"></span><br><span class="line"> @param viewArray è§†å›¾æ•°ç»„</span><br><span class="line"> @param column åˆ—æ•°</span><br><span class="line"> @param tbSpeace è§†å›¾ä¸Šä¸‹é—´è·</span><br><span class="line"> @param lrSpeace è§†å›¾å·¦å³é—´è·</span><br><span class="line"> @param topSpeace å’Œçˆ¶è§†å›¾ä¸Šé—´è·</span><br><span class="line"> @param lrSuperViewSpeace çˆ¶è§†å›¾å·¦å³é—´è·</span><br><span class="line"> @param superView çˆ¶è§†å›¾</span><br><span class="line"> @param viewHeight è§†å›¾é«˜åº¦</span><br><span class="line"> */</span><br><span class="line">- (void)wd_masLayoutSubViewsWithViewArray:(NSArray&lt;UIView *&gt; *)viewArray</span><br><span class="line">                              columnOfRow:(NSInteger)column</span><br><span class="line">                    topBottomOfItemSpeace:(CGFloat)tbSpeace</span><br><span class="line">                      leftRightItemSpeace:(CGFloat)lrSpeace</span><br><span class="line">                     topOfSuperViewSpeace:(CGFloat)topSpeace</span><br><span class="line">                 leftRightSuperViewSpeace:(CGFloat)lrSuperViewSpeace</span><br><span class="line">                          addToSubperView:(UIView *)superView</span><br><span class="line">                               viewHeight:(CGFloat)viewHeight&#123;</span><br><span class="line">  </span><br><span class="line">                    CGFloat viewWidth = superView.bounds.size.width;</span><br><span class="line">                    CGFloat itemWidth = (viewWidth - lrSuperViewSpeace * 2 - (column - 1) * lrSpeace) / column * 1.0f;</span><br><span class="line">                    CGFloat itemHeight = viewHeight;</span><br><span class="line">                    UIView *last = nil;</span><br><span class="line">  </span><br><span class="line">                    for (int i = 0; i &lt; viewArray.count; i++) &#123;</span><br><span class="line">                        UIView *item = viewArray[i];</span><br><span class="line">                        [superView addSubview:item];</span><br><span class="line"></span><br><span class="line">                        [item mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">                            make.width.mas_equalTo(itemWidth);</span><br><span class="line">                            make.height.mas_equalTo(itemHeight);</span><br><span class="line">                          </span><br><span class="line">                            CGFloat top = topSpeace + (i / column) * (itemHeight + tbSpeace);</span><br><span class="line">                            make.top.mas_offset(top);</span><br><span class="line">                            if (!last || (i % column) == 0) &#123;</span><br><span class="line">                                make.left.mas_offset(lrSuperViewSpeace);</span><br><span class="line">                            &#125;else&#123;</span><br><span class="line">                                make.left.mas_equalTo(last.mas_right).mas_offset(lrSpeace);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;];</span><br><span class="line">                      </span><br><span class="line">                        last = item;</span><br><span class="line">                    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>11ã€Snapkitåˆ¶ä½œä¹å®«æ ¼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">//Swift ----&gt; SnapKit</span><br><span class="line">    </span><br><span class="line">    /// å¤šè§†å›¾å¸ƒå±€</span><br><span class="line">    ///</span><br><span class="line">    /// - Parameters:</span><br><span class="line">    ///   - viewArray: è§†å›¾æ•°ç»„</span><br><span class="line">    ///   - columnOfRow: åˆ—æ•°</span><br><span class="line">    ///   - topBottomOfItemSpeace: è§†å›¾ä¸Šä¸‹é—´è·</span><br><span class="line">    ///   - leftRightItemSpeace: è§†å›¾å·¦å³é—´è·</span><br><span class="line">    ///   - topOfSuperViewSpeace: å’Œçˆ¶è§†å›¾ä¸Šé—´è·</span><br><span class="line">    ///   - leftRightSuperViewSpeace: çˆ¶è§†å›¾å·¦å³é—´è·</span><br><span class="line">    ///   - addToSubperView: çˆ¶è§†å›¾</span><br><span class="line">    ///   - viewHeight: è§†å›¾é«˜åº¦</span><br><span class="line">    func wd_masLayoutSubViews(viewArray:Array&lt;UIView&gt;,</span><br><span class="line">                              columnOfRow:Int,</span><br><span class="line">                              topBottomOfItemSpeace:CGFloat,</span><br><span class="line">                              leftRightItemSpeace:CGFloat,</span><br><span class="line">                              topOfSuperViewSpeace:CGFloat,</span><br><span class="line">                              leftRightSuperViewSpeace:CGFloat,</span><br><span class="line">                              addToSubperView:UIView,</span><br><span class="line">                              viewHeight:CGFloat) -&gt; Void &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        let viewWidth = addToSubperView.bounds.width</span><br><span class="line">        let tempW = leftRightSuperViewSpeace * 2 + CGFloat(columnOfRow - 1) * leftRightItemSpeace</span><br><span class="line">        let itemWidth = (viewWidth - tempW) / CGFloat(columnOfRow)</span><br><span class="line">        let itemHeight = viewHeight</span><br><span class="line">        </span><br><span class="line">        print(leftRightSuperViewSpeace,leftRightItemSpeace,itemWidth)</span><br><span class="line">        </span><br><span class="line">        var lastView:UIView?</span><br><span class="line">        </span><br><span class="line">        for (index) in viewArray.enumerated() &#123;</span><br><span class="line">            </span><br><span class="line">            let item = viewArray[i]</span><br><span class="line">            addToSubperView.addSubview(item)</span><br><span class="line">            </span><br><span class="line">            item.snp.makeConstraints &#123; (make) in</span><br><span class="line">                make.width.equalTo(itemWidth)</span><br><span class="line">                make.height.equalTo(itemHeight)</span><br><span class="line">                let top = topOfSuperViewSpeace + CGFloat(i / columnOfRow) * (itemHeight + topBottomOfItemSpeace)</span><br><span class="line">                make.top.equalTo(top)</span><br><span class="line">                </span><br><span class="line">                if !(lastView != nil) || i%columnOfRow == 0 &#123;</span><br><span class="line">                    make.left.equalTo(leftRightSuperViewSpeace)</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    make.left.equalTo((lastView?.snp.right)!).offset(leftRightItemSpeace)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                lastView = item</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>12ã€æ²‰æµ¸å¼TableView(ScrollViewã€CollectionView)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (@available(iOS 11.0, *)) &#123;</span><br><span class="line">self.tableView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">self.automaticallyAdjustsScrollViewInsets = false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>13ã€é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/** é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„ */</span><br><span class="line">- (NSString *)calculationAgeWithBirthday: (NSString *)birthday &#123;</span><br><span class="line">    NSCalendar *calendar = [NSCalendar currentCalendar];</span><br><span class="line">    NSDate *nowDate = [NSDate date];</span><br><span class="line">    NSString *birth = birthday;</span><br><span class="line">    NSDateFormatter *dateFormatter = [[NSDateFormatter alloc]init];</span><br><span class="line">    [dateFormatter setDateFormat:@&quot;yyyy-MM-dd&quot;];</span><br><span class="line">    NSDate *birthDay = [dateFormatter dateFromString:birth];</span><br><span class="line">    unsigned int unitFlags = NSCalendarUnitYear | NSCalendarUnitMonth | NSCalendarUnitDay;</span><br><span class="line">    NSDateComponents *date = [calendar components:unitFlags fromDate:birthDay toDate:nowDate options:0];</span><br><span class="line">    if ([date year] &gt; 0) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%ldå²&quot;, (long)[date year]];</span><br><span class="line">    &#125; else if([date month] &gt; 0) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%ldæœˆ&quot;, (long)[date month]];</span><br><span class="line">    &#125;  else if([date day] &gt; 0)&#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%ldå¤©&quot;, (long)[date day]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return @&quot;0å¤©&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSString *)ageStrFromIdentityCard:(NSString *)numberStr &#123;</span><br><span class="line">    NSString *dateSt;</span><br><span class="line">    NSMutableString *dateS;</span><br><span class="line">    if (numberStr.length &gt; 15) &#123;</span><br><span class="line">        dateSt = [numberStr substringWithRange:NSMakeRange(6, 8)];</span><br><span class="line">        dateS = [NSMutableString stringWithFormat:@&quot;%@&quot;, dateSt];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:4];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:7];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">        // åªè€ƒè™‘ 19å¼€å¤´çš„15ä½çš„èº«ä»½è¯å·</span><br><span class="line">        dateSt = [NSString stringWithFormat:@&quot;19%@&quot;,[numberStr substringWithRange:NSMakeRange(6, 6)]];</span><br><span class="line">        dateS = [NSMutableString stringWithFormat:@&quot;%@&quot;, dateSt];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:4];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:7];</span><br><span class="line">    &#125;</span><br><span class="line">    return [self calculationAgeWithBirthday:dateS];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;1ã€PrefixHeaderå¯¼å…¥ä½ç½®å†™æ³•&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td 
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AVPlayerå°è£…</title>
    <link href="https://wudan-ios.github.io/2019/01/11/AVPlayer%E5%B0%81%E8%A3%85/"/>
    <id>https://wudan-ios.github.io/2019/01/11/AVPlayerå°è£…/</id>
    <published>2019-01-11T07:41:50.499Z</published>
    <updated>2019-01-11T07:45:56.494Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-066df343391a04f5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><p>æœ€è¿‘åœ¨å†™å…³äºéŸ³è§†é¢‘æ’­æ”¾çš„æ¡ˆä¾‹ï¼Œæ‰€ä»¥å°±è¶æœºä¼šç ”ç©¶äº†ä¸€ä¸‹AVPlayerçš„å†…å®¹ã€‚æˆ‘å°è£…çš„ç›®å‰åªèƒ½æ’­æ”¾ç½‘ç»œéŸ³è§†é¢‘ã€‚è¿˜æœªæ·»åŠ ç¼“å­˜ï¼Œä»¥åæ‰¾æœºä¼šç ”ç©¶ä¸€ä¸‹å†æ›´æ–°ã€‚ä»£ç ä¸­æä¾›äº†éŸ³è§†é¢‘çš„ä¸Šä¸€æ›²ã€ä¸‹ä¸€æ›²ã€æš‚åœã€å¼€å§‹ã€åœæ­¢ã€å•æ›²æ’­æ”¾ã€é¡ºåºæ’­æ”¾ã€éšæœºæ’­æ”¾ç­‰åŠŸèƒ½ã€‚ä»£ç å†™çš„ä¸å¥½ï¼Œä»…ä¾›å‚è€ƒ~</p><h3 id="ä»£ç æ¥å£æ–‡ä»¶"><a href="#ä»£ç æ¥å£æ–‡ä»¶" class="headerlink" title="ä»£ç æ¥å£æ–‡ä»¶"></a>ä»£ç æ¥å£æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;AVFoundation/AVFoundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">// å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾å½¢å¼</span><br><span class="line">typedef NS_ENUM(NSInteger, MediaPlayType) &#123;</span><br><span class="line">    MediaPlayTypeCycle,   ///&lt; é¡ºåº</span><br><span class="line">    MediaPlayTypeSingle,  ///&lt; å•æ›²å¾ªç¯</span><br><span class="line">    MediaPlayTypeRandom   ///&lt; éšæœºæ’­æ”¾</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾çŠ¶æ€</span><br><span class="line">typedef NS_ENUM(NSInteger, MediaPlayStatus) &#123;</span><br><span class="line">    MediaPlayStatusStop,        ///&lt; åœæ­¢æ’­æ”¾</span><br><span class="line">    MediaPlayStatusPause,       ///&lt; æš‚åœæ’­æ”¾</span><br><span class="line">    MediaPlayStatusPlaying      ///&lt; æ­£åœ¨æ’­æ”¾</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// åª’ä½“åŠ è½½çŠ¶æ€</span><br><span class="line">typedef NS_ENUM(NSInteger, MediaLoadStatus) &#123;</span><br><span class="line">    MediaLoadStatusReadyToPlay,  ///&lt; å‡†å¤‡æ’­æ”¾</span><br><span class="line">    MediaLoadStatusUnknown,      ///&lt; æœªçŸ¥</span><br><span class="line">    MediaPlayStatusFailed        ///&lt; å¤±è´¥</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@class MediaPlyerManager;</span><br><span class="line"></span><br><span class="line">@protocol MediaPlyerManagerDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">// æ•°æ®åŠ è½½çŠ¶æ€ æ ¹æ®çŠ¶æ€è¿›è¡Œæ’­æ”¾æˆ–å…¶ä»–æ“ä½œ</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager playerItemStatus:(MediaLoadStatus)status;</span><br><span class="line">// ç¼“å†²è¿›åº¦</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager netBufferValue:(CGFloat)value;</span><br><span class="line">// ç¼“å†²æ˜¯å¦è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager bufferHasEnough:(BOOL)enough;</span><br><span class="line">// å½“å‰æ’­æ”¾çš„æ—¶é—´</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentPlayTime:(NSString *)time currentPlayTimeValue:(CGFloat)value;</span><br><span class="line">// æ’­æ”¾æ€»æ—¶é—´</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager mediaEndTime:(NSString *)time mediaEndTimeValue:(CGFloat)value;</span><br><span class="line">// æ’­æ”¾ç»“æŸ</span><br><span class="line">- (void)MediaPlayerCurrentMediaPlayFinish:(MediaPlyerManager *)playerManager;</span><br><span class="line">// æ’­æ”¾çŠ¶æ€</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager playeStatus:(MediaPlayStatus)status;</span><br><span class="line">// è·å–æ•°æ®åˆ‡æ¢æ—¶è·å–æ­£åœ¨æ’­æ”¾çš„URLå’Œå½“å‰çš„index</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentUrl:(NSString *)url currentIndex:(NSInteger)index;</span><br><span class="line">// ä¸ºäº†é…åˆæ‰‹æœºåå°æ’­æ”¾ å®æ—¶è·å–æ’­æ”¾çš„è¿›åº¦ï¼Œæ€»çš„æ—¶é—´ï¼Œå½“å‰çš„index&lt;é€šè¿‡indexè·å–å›¾ç‰‡ç­‰ä¿¡æ¯&gt;</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentProgressValue:(CGFloat)value totalValue:(CGFloat)totalValue currentIndex:(NSInteger)index;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">typedef MediaPlyerManager *(^playerCurrentTime)(NSString *time);</span><br><span class="line"></span><br><span class="line">@interface MediaPlyerManager : NSObject</span><br><span class="line">@property (nonatomic, strong, readonly) AVPlayer                  *mediaPlayer;          ///&lt; æ’­æ”¾å™¨</span><br><span class="line">@property (nonatomic, strong, readonly) AVPlayerItem              *meidaPlayerItem;      ///&lt; æ’­æ”¾å™¨çš„CurrentItem</span><br><span class="line">@property (nonatomic, strong, readonly) NSMutableArray&lt;NSString*&gt; *dataUrlArray;         ///&lt; æ­£åœ¨æ’­æ”¾çš„åˆ—è¡¨æ•°æ®</span><br><span class="line">@property (nonatomic, assign, readonly) MediaPlayType              playType;             ///&lt; å½“å‰æ’­æ”¾ç±»å‹</span><br><span class="line">@property (nonatomic, assign, readonly) MediaPlayStatus            playStatus;           ///&lt; å½“å‰æ’­æ”¾çŠ¶æ€</span><br><span class="line">@property (nonatomic, assign, readonly) NSInteger                  currentIndex;         ///&lt; å½“å‰æ’­æ”¾çš„ç´¢å¼•</span><br><span class="line">@property (nonatomic, assign, readonly) BOOL                       isPlaying;            ///&lt; æ˜¯å¦åœ¨æ’­æ”¾</span><br><span class="line">@property (nonatomic, assign, readonly) CGFloat                    curentPlayTimeValue;  ///&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼</span><br><span class="line">@property (nonatomic, copy, readonly) NSString                    *curentPlayTime;       ///&lt; å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line">@property (nonatomic, assign, readonly) CGFloat                    endPlayTimeValue;     ///&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼</span><br><span class="line">@property (nonatomic, copy, readonly) NSString                    *endPlayTime;          ///&lt; å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line">+ (instancetype)defaultManager;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> åˆ—è¡¨æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt;</span><br><span class="line"></span><br><span class="line"> @param urls æ–‡ä»¶è·¯å¾„æ•°ç»„</span><br><span class="line"> @param delegate å›è°ƒä»£ç†</span><br><span class="line"> @return MediaPlyerManager</span><br><span class="line"> */</span><br><span class="line">- (MediaPlyerManager *)playerWithUrls:(NSArray&lt;NSString *&gt; *)urls actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> å•ä¸ªéŸ³è§†é¢‘æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt;</span><br><span class="line"></span><br><span class="line"> @param url æ–‡ä»¶è·¯å¾„</span><br><span class="line"> @param delegate å›è°ƒä»£ç†</span><br><span class="line"> @return MediaPlyerManager</span><br><span class="line"> */</span><br><span class="line">- (MediaPlyerManager *)playerWithUrl:(NSString *)url actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">    å¼€å§‹æ’­æ”¾</span><br><span class="line"> */</span><br><span class="line">- (void)play;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">    æš‚åœæ’­æ”¾</span><br><span class="line"> */</span><br><span class="line">- (void)pause;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">    åœæ­¢æ’­æ”¾</span><br><span class="line"> */</span><br><span class="line">- (void)stop;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">    ä¸‹ä¸€æ›²</span><br><span class="line"> */</span><br><span class="line">- (void)next;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">    ä¸Šä¸€æ›²</span><br><span class="line"> */</span><br><span class="line">- (void)previous;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æŒ‡å®šè¿›åº¦å¼€å§‹æ’­æ”¾</span><br><span class="line"></span><br><span class="line"> @param progress è¿›åº¦ç™¾åˆ†æ¯”</span><br><span class="line"> */</span><br><span class="line">- (void)setupPlayerSeekToProgress:(CGFloat)progress;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> åˆ¶å®šæ’­æ”¾ç±»å‹</span><br><span class="line"></span><br><span class="line"> @param type ç±»å‹</span><br><span class="line"> */</span><br><span class="line">- (void)setupMediaPlayerType:(MediaPlayType)type;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æŒ‡å®šæ’­æ”¾çš„index</span><br><span class="line"></span><br><span class="line"> @param index ç´¢å¼•</span><br><span class="line"> */</span><br><span class="line">- (void)setupPlayerIndex:(NSInteger)index;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ·»åŠ æ•°æ®</span><br><span class="line"></span><br><span class="line"> @param files æ–‡ä»¶æ•°ç»„</span><br><span class="line"> @param index ç´¢å¼•</span><br><span class="line"> */</span><br><span class="line">- (void)insertMediaFile:(NSArray&lt;NSString *&gt; *)files atIndex:(NSInteger)index;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">    ç§»é™¤å…¨éƒ¨æ•°æ®</span><br><span class="line"> */</span><br><span class="line">- (void)removeAllFiles;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> ç§»é™¤ç´¢å¼•ä¸­çš„å•ä¸ªæ•°æ®</span><br><span class="line"></span><br><span class="line"> @param index ç´¢å¼•</span><br><span class="line"> */</span><br><span class="line">- (void)removeObjectAtIndex:(NSInteger)index;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> è®¾ç½®é”å±æ ·å¼</span><br><span class="line"></span><br><span class="line"> @param coverImage ä¸“è¾‘å›¾ç‰‡</span><br><span class="line"> @param size æ˜¾ç¤ºå¤§å°</span><br><span class="line"> @param title æ ‡é¢˜</span><br><span class="line"> @param author ä¸“è¾‘ä½œè€…</span><br><span class="line"> @param album ä¸“è¾‘åç§°</span><br><span class="line"> @param currentTime å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line"> @param duration æ’­æ”¾æ€»æ—¶é•¿</span><br><span class="line"> */</span><br><span class="line">- (void)setupLockScreenPlayInfo:(UIImage *)coverImage</span><br><span class="line">                      imageSize:(CGSize)size</span><br><span class="line">                          title:(NSString *)title</span><br><span class="line">                         ahthor:(NSString *)author</span><br><span class="line">                         album:(NSString *)album</span><br><span class="line">                currentPlayTime:(CGFloat)currentTime</span><br><span class="line">                       duration:(CGFloat)duration;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°æ–‡ä»¶"><a href="#ä»£ç å®ç°æ–‡ä»¶" class="headerlink" title="ä»£ç å®ç°æ–‡ä»¶"></a>ä»£ç å®ç°æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;MediaPlyerManager.h&quot;</span><br><span class="line">#import &lt;MediaPlayer/MediaPlayer.h&gt;</span><br><span class="line"></span><br><span class="line">@interface MediaPlyerManager ()</span><br><span class="line">@property (nonatomic, strong, readwrite) NSMutableArray&lt;NSString *&gt; *dataUrlArray;</span><br><span class="line">@property (nonatomic, strong, readwrite) AVPlayer                  *mediaPlayer;</span><br><span class="line">@property (nonatomic, assign, readwrite) BOOL                      isPlaying;</span><br><span class="line">@property (nonatomic, strong, readwrite) AVPlayerItem              *meidaPlayerItem;</span><br><span class="line">@property (nonatomic, assign, readwrite) MediaPlayType             playeType;</span><br><span class="line">@property (nonatomic, assign, readwrite) NSInteger                 currentIndex;</span><br><span class="line">@property (nonatomic, assign, readwrite) MediaPlayStatus           playStatus;</span><br><span class="line">@property (nonatomic, assign, readwrite) CGFloat                   curentPlayTimeValue;</span><br><span class="line">@property (nonatomic, copy, readwrite  ) NSString                  *curentPlayTime;</span><br><span class="line">@property (nonatomic, assign, readwrite) CGFloat                   endPlayTimeValue;</span><br><span class="line">@property (nonatomic, copy, readwrite  ) NSString                  *endPlayTime;</span><br><span class="line">@property (nonatomic, weak             ) id &lt;MediaPlyerManagerDelegate&gt; delegate;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation MediaPlyerManager</span><br><span class="line"></span><br><span class="line">+ (instancetype)defaultManager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static MediaPlyerManager *manger;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        manger = [[MediaPlyerManager alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return manger;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line">- (MediaPlyerManager *)playerWithUrl:(NSString *)url actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate &#123;</span><br><span class="line">    [self playerWithUrls:@[url] actionWithDelegate:delegate];</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (MediaPlyerManager *)playerWithUrls:(NSArray&lt;NSString *&gt; *)urls actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate &#123;</span><br><span class="line">    self.delegate         = delegate;</span><br><span class="line">    self.currentIndex     = 0;</span><br><span class="line">    self.dataUrlArray     = [NSMutableArray array];</span><br><span class="line">    NSMutableArray *array = [NSMutableArray arrayWithCapacity:urls.count];</span><br><span class="line">    for (NSString *urlStr in urls) &#123;</span><br><span class="line">        [array addObject:[self createPlayerItemWithUrl:urlStr]];</span><br><span class="line">        [self.dataUrlArray addObject:urlStr];</span><br><span class="line">    &#125;</span><br><span class="line">    self.playeType = MediaPlayTypeCycle;</span><br><span class="line">    self.mediaPlayer = [[AVPlayer alloc] initWithPlayerItem:array.firstObject];</span><br><span class="line">    self.meidaPlayerItem = self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">    [self addObserver];</span><br><span class="line">    </span><br><span class="line">    __weak typeof(self) weakself = self;</span><br><span class="line">    [self.mediaPlayer addPeriodicTimeObserverForInterval:CMTimeMake(1, 1) queue:NULL usingBlock:^(CMTime time) &#123;</span><br><span class="line">        NSString *currentString = [weakself getStringFromCMTime:time];</span><br><span class="line">        weakself.curentPlayTime = currentString;</span><br><span class="line">        weakself.curentPlayTimeValue = (CGFloat)time.value/time.timescale;        </span><br><span class="line">#pragma mark - è·å–å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line">        if (weakself.delegate &amp;&amp; [weakself.delegate respondsToSelector:@selector(MediaPlayer:currentPlayTime:currentPlayTimeValue:)]) &#123;</span><br><span class="line">            [weakself.delegate MediaPlayer:weakself currentPlayTime:currentString currentPlayTimeValue:(CGFloat)time.value/time.timescale];</span><br><span class="line">        &#125;</span><br><span class="line">#pragma mark - å®æ—¶è·å–æ’­æ”¾ä¿¡æ¯</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:currentProgressValue:totalValue:currentIndex:)]) &#123;</span><br><span class="line">            [weakself.delegate MediaPlayer:weakself currentProgressValue:weakself.curentPlayTimeValue totalValue:weakself.endPlayTimeValue currentIndex:weakself.currentIndex];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’­æ”¾ç»“æŸ</span><br><span class="line"></span><br><span class="line">- (void)playFinish:(NSNotification *)notification &#123;</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayerCurrentMediaPlayFinish:)]) &#123;</span><br><span class="line">        [self.delegate MediaPlayerCurrentMediaPlayFinish:self];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (self.playeType == MediaPlayTypeSingle) &#123;</span><br><span class="line">        [self.mediaPlayer seekToTime:kCMTimeZero];</span><br><span class="line">        [self play];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (self.currentIndex &lt; self.dataUrlArray.count - 1) &#123;</span><br><span class="line">            self.currentIndex += 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.currentIndex = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">        self.meidaPlayerItem = self.mediaPlayer.currentItem;</span><br><span class="line">        [self getCurrentIndex:self.currentIndex];</span><br><span class="line">        [self play];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - KVO</span><br><span class="line"></span><br><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath</span><br><span class="line">                      ofObject:(id)object</span><br><span class="line">                        change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change</span><br><span class="line">                       context:(void *)context &#123;</span><br><span class="line">    </span><br><span class="line">    AVPlayerItem *playerItem = object;</span><br><span class="line">    if ([keyPath isEqualToString:@&quot;status&quot;]) &#123;</span><br><span class="line">        MediaLoadStatus status = [change[@&quot;new&quot;] integerValue];</span><br><span class="line">#pragma mark - è·å–åª’ä½“åŠ è½½çŠ¶æ€</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:playerItemStatus:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self playerItemStatus:status];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;loadedTimeRanges&quot;]) &#123;</span><br><span class="line">        NSArray * timeRanges         = playerItem.loadedTimeRanges;</span><br><span class="line">        CMTimeRange timeRange        = [timeRanges.firstObject CMTimeRangeValue];</span><br><span class="line">        NSTimeInterval totalLoadTime = CMTimeGetSeconds(timeRange.start) \</span><br><span class="line">                                                + CMTimeGetSeconds(timeRange.duration);</span><br><span class="line">        NSTimeInterval duration      = CMTimeGetSeconds(playerItem.duration);</span><br><span class="line">        NSTimeInterval scale         = totalLoadTime/duration;</span><br><span class="line">        </span><br><span class="line">#pragma mark - è·å–åª’ä½“æ€»æ—¶é—´</span><br><span class="line">        if ((CGFloat)duration/scale &gt;= 0) &#123;</span><br><span class="line">            self.endPlayTime = [self getStringFromCMTime:playerItem.duration];</span><br><span class="line">            self.endPlayTimeValue = (CGFloat)duration/scale;</span><br><span class="line">            if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:mediaEndTime:mediaEndTimeValue:)]) &#123;</span><br><span class="line">                [self.delegate MediaPlayer:self mediaEndTime:[self getStringFromCMTime:playerItem.duration] mediaEndTimeValue:(CGFloat)duration/scale];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">#pragma mark - ç¼“å†²ç™¾åˆ†æ¯”</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:netBufferValue:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self netBufferValue:scale];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;playbackBufferEmpty&quot;]) &#123;</span><br><span class="line">        </span><br><span class="line">#pragma mark - ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:bufferHasEnough:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self bufferHasEnough:false];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;playbackLikelyToKeepUp&quot;]) &#123;</span><br><span class="line">        </span><br><span class="line">#pragma mark - ç¼“å†²è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:bufferHasEnough:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self bufferHasEnough:true];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - å¼€å§‹æ’­æ”¾</span><br><span class="line"></span><br><span class="line">- (void)play &#123;</span><br><span class="line">    [self.mediaPlayer play];</span><br><span class="line">    [self getPlayStatus:MediaPlayStatusPlaying];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æš‚åœæ’­æ”¾</span><br><span class="line"></span><br><span class="line">- (void)pause &#123;</span><br><span class="line">    [self.mediaPlayer pause];</span><br><span class="line">    [self getPlayStatus:MediaPlayStatusPause];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åœæ­¢æ’­æ”¾</span><br><span class="line"></span><br><span class="line">- (void)stop &#123;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:nil];</span><br><span class="line">    [self getPlayStatus:MediaPlayStatusStop];</span><br><span class="line">    [self removeObserver];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - ä¸‹ä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">- (void)next &#123;</span><br><span class="line">    if (self.playeType == MediaPlayTypeRandom) &#123;</span><br><span class="line">        self.currentIndex = (NSInteger)arc4random_uniform((int32_t)(self.dataUrlArray.count - 1));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (self.currentIndex == self.dataUrlArray.count - 1) &#123;</span><br><span class="line">            self.currentIndex = 0;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.currentIndex += 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">    self.meidaPlayerItem = self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">    [self addObserver];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - ä¸Šä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">- (void)previous &#123;</span><br><span class="line">    if (self.playeType == MediaPlayTypeRandom) &#123;</span><br><span class="line">        self.currentIndex = (NSInteger)arc4random_uniform((int32_t)(self.dataUrlArray.count - 1));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (self.currentIndex == 0) &#123;</span><br><span class="line">            self.currentIndex = self.dataUrlArray.count - 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.currentIndex -= 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">    self.meidaPlayerItem = self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">    [self addObserver];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’­æ”¾çŠ¶æ€</span><br><span class="line"></span><br><span class="line">- (void)getPlayStatus:(MediaPlayStatus)status &#123;</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:playeStatus:)]) &#123;</span><br><span class="line">        [self.delegate MediaPlayer:self playeStatus:status];</span><br><span class="line">    &#125;</span><br><span class="line">    self.playStatus = status;</span><br><span class="line"></span><br><span class="line">    if (status == MediaPlayStatusPlaying) &#123;</span><br><span class="line">        self.isPlaying = true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        self.isPlaying = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ ¹æ®indexè¿›è¡Œå›è°ƒ</span><br><span class="line"></span><br><span class="line">- (void)getCurrentIndex:(NSInteger)index &#123;</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:currentUrl:currentIndex:)]) &#123;</span><br><span class="line">        [self.delegate MediaPlayer:self currentUrl:self.dataUrlArray[index] currentIndex:index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - è®¾ç½®æ’­æ”¾è¿›åº¦ç™¾åˆ†æ¯”</span><br><span class="line"></span><br><span class="line">- (void)setupPlayerSeekToProgress:(CGFloat)progress &#123;</span><br><span class="line">    float timeValue = progress * CMTimeGetSeconds(self.mediaPlayer.currentItem.duration);</span><br><span class="line">    [self.mediaPlayer seekToTime:CMTimeMake(timeValue, 1)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - è®¾ç½®æ’­æ”¾å½¢å¼</span><br><span class="line"></span><br><span class="line">- (void)setupMediaPlayerType:(MediaPlayType)type &#123;</span><br><span class="line">    self.playeType = type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’­æ”¾æŒ‡å®šindexçš„åª’ä½“</span><br><span class="line"></span><br><span class="line">- (void)setupPlayerIndex:(NSInteger)index &#123;</span><br><span class="line">    if (index &gt; (self.dataUrlArray.count - 1)) &#123;</span><br><span class="line">        @throw [NSException exceptionWithName:@&quot;è¶Šç•Œé”™è¯¯&quot; reason:@&quot;index ä¸èƒ½è¶…å‡ºURLæ•°ç»„çš„é•¿åº¦&quot; userInfo:nil];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    self.currentIndex = index;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">    self.meidaPlayerItem = self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’å…¥æ•°æ®</span><br><span class="line"></span><br><span class="line">- (void)insertMediaFile:(NSArray&lt;NSString *&gt; *)files atIndex:(NSInteger)index &#123;</span><br><span class="line">    for (NSString *urlStr in files) &#123;</span><br><span class="line">        NSInteger i = [files indexOfObject:urlStr];</span><br><span class="line">        [self.dataUrlArray insertObject:urlStr atIndex:index + i];</span><br><span class="line">    &#125;</span><br><span class="line">    if (index &lt; self.currentIndex) &#123;</span><br><span class="line">        self.currentIndex += 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åˆ é™¤æ•°æ®</span><br><span class="line"></span><br><span class="line">- (void)removeAllFiles &#123;</span><br><span class="line">    [self stop];</span><br><span class="line">    [self.dataUrlArray removeAllObjects];</span><br><span class="line">    self.dataUrlArray = [NSMutableArray array];</span><br><span class="line">    self.currentIndex = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeObjectAtIndex:(NSInteger)index &#123;</span><br><span class="line">    if (self.dataUrlArray.count == 1) &#123;</span><br><span class="line">        [self removeAllFiles];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self.dataUrlArray removeObjectAtIndex:index];</span><br><span class="line">        if (index == self.currentIndex) &#123;</span><br><span class="line">            if (index == 0) &#123;</span><br><span class="line">                self.currentIndex = 0;</span><br><span class="line">                [self next];</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                self.currentIndex -= 1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (self.currentIndex &gt; index) &#123;</span><br><span class="line">                self.currentIndex -= 1;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Utils</span><br><span class="line"></span><br><span class="line">- (NSString *)getStringFromCMTime:(CMTime)time &#123;</span><br><span class="line">    float currentTimeValue       = (CGFloat)time.value/time.timescale;</span><br><span class="line">    NSDate * currentDate         = [NSDate dateWithTimeIntervalSince1970:currentTimeValue];</span><br><span class="line">    NSCalendar *calendar         = [[NSCalendar alloc] initWithCalendarIdentifier:NSCalendarIdentifierGregorian];</span><br><span class="line">    NSInteger unitFlags          = NSCalendarUnitHour | NSCalendarUnitMinute | NSCalendarUnitSecond;</span><br><span class="line">    NSDateComponents *components = [calendar components:unitFlags fromDate:currentDate];</span><br><span class="line">    if (currentTimeValue &gt;= 3600 ) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%02ld:%02ld:%02ld&quot;, (long)components.hour, (long)components.minute, (long)components.second];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%02ld:%02ld&quot;, (long)components.minute, (long)components.second];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addObserver &#123;</span><br><span class="line">    // ç›‘æ§çŠ¶æ€å±æ€§</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;status&quot;</span><br><span class="line">                              options:(NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew)</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    // ç›‘æ§ç¼“å†²åŠ è½½æƒ…å†µå±æ€§</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;loadedTimeRanges&quot;</span><br><span class="line">                              options:(NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew)</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    // ç›‘å¬ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;playbackBufferEmpty&quot;</span><br><span class="line">                              options:NSKeyValueObservingOptionNew</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    // ç›‘å¬ç¼“å†²è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;playbackLikelyToKeepUp&quot;</span><br><span class="line">                              options:NSKeyValueObservingOptionNew</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    // è·å–æ˜¯å¦æ’­æ”¾ç»“æŸ</span><br><span class="line">    [[NSNotificationCenter defaultCenter] addObserver:self</span><br><span class="line">                                             selector:@selector(playFinish:)</span><br><span class="line">                                                 name:AVPlayerItemDidPlayToEndTimeNotification</span><br><span class="line">                                               object:self.meidaPlayerItem];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeObserver &#123;</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">    @try &#123;</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;loadedTimeRanges&quot;];</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;playbackBufferEmpty&quot;];</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;playbackLikelyToKeepUp&quot;];</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;status&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    @catch(NSException *exception) &#123;</span><br><span class="line">        NSLog(@&quot;%@&quot;, exception);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - è®¾ç½®é”å±æ ·å¼</span><br><span class="line"></span><br><span class="line">- (void)setupLockScreenPlayInfo:(UIImage *)coverImage</span><br><span class="line">                      imageSize:(CGSize)size</span><br><span class="line">                          title:(NSString *)title</span><br><span class="line">                         ahthor:(NSString *)author</span><br><span class="line">                          album:(NSString *)album</span><br><span class="line">                currentPlayTime:(CGFloat)currentTime</span><br><span class="line">                       duration:(CGFloat)duration &#123;</span><br><span class="line">    </span><br><span class="line">    Class playingInfoCenter = NSClassFromString(@&quot;MPNowPlayingInfoCenter&quot;);</span><br><span class="line">    if (playingInfoCenter) &#123;</span><br><span class="line">        NSMutableDictionary *songInfo = [[NSMutableDictionary alloc] init];</span><br><span class="line">        MPMediaItemArtwork *albumArt = [[MPMediaItemArtwork alloc] initWithBoundsSize:size requestHandler:^UIImage * _Nonnull(CGSize size) &#123;</span><br><span class="line">            return coverImage;</span><br><span class="line">        &#125;];</span><br><span class="line">        [songInfo setObject:title forKey:MPMediaItemPropertyTitle];</span><br><span class="line">        [songInfo setObject:author forKey:MPMediaItemPropertyArtist];</span><br><span class="line">        [songInfo setObject:album forKey:MPMediaItemPropertyAlbumTitle];</span><br><span class="line">        [songInfo setObject:albumArt forKey:MPMediaItemPropertyArtwork];</span><br><span class="line">        [songInfo setObject:[NSNumber numberWithDouble:currentTime] forKey:MPNowPlayingInfoPropertyElapsedPlaybackTime];</span><br><span class="line">        [songInfo setObject:[NSNumber numberWithDouble:duration] forKey:MPMediaItemPropertyPlaybackDuration];</span><br><span class="line">        [[MPNowPlayingInfoCenter defaultCenter] setNowPlayingInfo:songInfo];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (AVPlayerItem *)createPlayerItemWithUrl:(NSString *)url &#123;</span><br><span class="line">    return [AVPlayerItem playerItemWithURL:[NSURL URLWithString:url]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h3 id="æé—®"><a href="#æé—®" class="headerlink" title="æé—®"></a>æé—®</h3><p>æœ¬æ¥ç›¸åŒä½¿ç”¨AVQueuePlayeræ¥è¿›è¡Œåˆ—è¡¨æ’­æ”¾çš„ï¼Œä½†æ˜¯å½“åšå•æ›²å¾ªç¯çš„æ—¶å€™é‡åˆ°é—®é¢˜ï¼šé€šè¿‡é€šçŸ¥ç›‘å¬æ’­æ”¾å®Œæˆï¼Œåœ¨é€šçŸ¥çš„æ–¹æ³•é‡Œè¿›è¡Œå…·ä½“æ“ä½œï¼Œä½†æ˜¯è®¾ç½®æ— æ•ˆï¼Œç›´æ¥æ’­æ”¾çš„è¿˜æ˜¯ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•è§£å†³ï¼Œå¸®å¿™å›å¤ä¸€ä¸‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-066df343391a04f5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>RxSwiftå­¦ä¹ æ—¥å¸¸</title>
    <link href="https://wudan-ios.github.io/2019/01/03/RxSwift%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%B8%B8%EF%BC%88%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D%EF%BC%89/"/>
    <id>https://wudan-ios.github.io/2019/01/03/RxSwiftå­¦ä¹ æ—¥å¸¸ï¼ˆåŸºç¡€ä»‹ç»ï¼‰/</id>
    <published>2019-01-03T01:52:22.730Z</published>
    <updated>2019-01-03T01:52:23.454Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Observable-ä»‹ç»"><a href="#Observable-ä»‹ç»" class="headerlink" title="Observable ä»‹ç»"></a>Observable ä»‹ç»</h1><h2 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable<t></t></h2><ul><li>Observable<t> è¿™ä¸ªç±»å°±æ˜¯ Rx æ¡†æ¶çš„åŸºç¡€ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸ºå¯è§‚å¯Ÿåºåˆ—ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å¯ä»¥å¼‚æ­¥åœ°äº§ç”Ÿä¸€ç³»åˆ—çš„ Eventï¼ˆäº‹ä»¶ï¼‰ï¼Œå³ä¸€ä¸ª Observable<t> å¯¹è±¡ä¼šéšç€æ—¶é—´æ¨ç§»ä¸å®šæœŸåœ°å‘å‡º event(element : T) è¿™æ ·ä¸€ä¸ªä¸œè¥¿ã€‚</t></t></li><li>è€Œä¸”è¿™äº› Event è¿˜å¯ä»¥æºå¸¦æ•°æ®ï¼Œå®ƒçš„æ³›å‹ <t> å°±æ˜¯ç”¨æ¥æŒ‡å®šè¿™ä¸ª Event æºå¸¦çš„æ•°æ®çš„ç±»å‹ã€‚</t></li><li>æœ‰äº†å¯è§‚å¯Ÿåºåˆ—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ä¸ª Observerï¼ˆè®¢é˜…è€…ï¼‰æ¥è®¢é˜…å®ƒï¼Œè¿™æ ·è¿™ä¸ªè®¢é˜…è€…æ‰èƒ½æ”¶åˆ° Observable<t> ä¸æ—¶å‘å‡ºçš„ Eventã€‚<h2 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h2>æŸ¥çœ‹ RxSwift æºç å¯ä»¥å‘ç°ï¼Œäº‹ä»¶ Event çš„å®šä¹‰å¦‚ä¸‹ï¼š</t></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public enum Event&lt;Element&gt; &#123;</span><br><span class="line">    /// Next element is produced.</span><br><span class="line">    case next(Element)</span><br><span class="line"> </span><br><span class="line">    /// Sequence terminated with an error.</span><br><span class="line">    case error(Swift.Error)</span><br><span class="line"> </span><br><span class="line">    /// Sequence completed successfully.</span><br><span class="line">    case completed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Event å°±æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Observable æ˜¯å¯ä»¥å‘å‡º 3 ç§ä¸åŒç±»å‹çš„ Event äº‹ä»¶ï¼š</p><ul><li>nextï¼šnext äº‹ä»¶å°±æ˜¯é‚£ä¸ªå¯ä»¥æºå¸¦æ•°æ® <t> çš„äº‹ä»¶ï¼Œå¯ä»¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªâ€œæœ€æ­£å¸¸â€çš„äº‹ä»¶ã€‚</t></li><li>errorï¼šerror äº‹ä»¶è¡¨ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œå®ƒå¯ä»¥æºå¸¦å…·ä½“çš„é”™è¯¯å†…å®¹ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† error eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†ã€‚</li><li>completedï¼šcompleted äº‹ä»¶è¡¨ç¤º Observable å‘å‡ºçš„äº‹ä»¶æ­£å¸¸åœ°ç»“æŸäº†ï¼Œè·Ÿ error ä¸€æ ·ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† completed eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†<h2 id="Observable-ä¸-Sequenceæ¯”è¾ƒ"><a href="#Observable-ä¸-Sequenceæ¯”è¾ƒ" class="headerlink" title="Observable ä¸ Sequenceæ¯”è¾ƒ"></a>Observable ä¸ Sequenceæ¯”è¾ƒ</h2>(1)ã€ä¸ºæ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€ä¸ª Observable çš„å®ä¾‹æƒ³è±¡æˆäºä¸€ä¸ª Swift ä¸­çš„ Sequenceï¼š</li><li>å³ä¸€ä¸ª Observableï¼ˆObservableTypeï¼‰ç›¸å½“äºä¸€ä¸ªåºåˆ— Sequenceï¼ˆSequenceTypeï¼‰ã€‚</li><li>ObservableType.subscribe(_:) æ–¹æ³•å…¶å®å°±ç›¸å½“äº SequenceType.generate()ã€‚</li></ul><p>(2)ã€ä½†å®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰è®¸å¤šåŒºåˆ«çš„ï¼š</p><ul><li>Swift ä¸­çš„ SequenceType æ˜¯åŒæ­¥çš„å¾ªç¯ï¼Œè€Œ Observable æ˜¯å¼‚æ­¥çš„ã€‚</li><li>Observable å¯¹è±¡ä¼šåœ¨æœ‰ä»»ä½• Event æ—¶å€™ï¼Œè‡ªåŠ¨å°† Event ä½œä¸ºä¸€ä¸ªå‚æ•°é€šè¿‡ ObservableType.subscribe(_:) å‘å‡ºï¼Œå¹¶ä¸éœ€è¦ä½¿ç”¨ next æ–¹æ³•ã€‚<h2 id="åˆ›å»º-Observable-åºåˆ—"><a href="#åˆ›å»º-Observable-åºåˆ—" class="headerlink" title="åˆ›å»º Observable åºåˆ—"></a>åˆ›å»º Observable åºåˆ—</h2><h3 id="just-æ–¹æ³•"><a href="#just-æ–¹æ³•" class="headerlink" title="just() æ–¹æ³•"></a>just() æ–¹æ³•</h3>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡ä¼ å…¥ä¸€ä¸ªé»˜è®¤å€¼æ¥åˆå§‹åŒ–ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹æˆ‘ä»¬æ˜¾å¼åœ°æ ‡æ³¨å‡ºäº† observable çš„ç±»å‹ä¸º Observable<int>ï¼Œå³æŒ‡å®šäº†è¿™ä¸ª Observable æ‰€å‘å‡ºçš„äº‹ä»¶æºå¸¦çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯ Int ç±»å‹çš„ã€‚</int></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable&lt;Int&gt;.just(5)</span><br></pre></td></tr></table></figure><h3 id="of-æ–¹æ³•"><a href="#of-æ–¹æ³•" class="headerlink" title="of() æ–¹æ³•"></a>of() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼ˆå¿…éœ€è¦æ˜¯åŒç±»å‹çš„ï¼‰<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æˆ‘æ²¡æœ‰æ˜¾å¼åœ°å£°æ˜å‡º Observable çš„æ³›å‹ç±»å‹ï¼ŒSwift ä¹Ÿä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br></pre></td></tr></table></figure></p><h3 id="from-æ–¹æ³•"><a href="#from-æ–¹æ³•" class="headerlink" title="from() æ–¹æ³•"></a>from() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•éœ€è¦ä¸€ä¸ªæ•°ç»„å‚æ•°ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æ•°æ®é‡Œçš„å…ƒç´ å°±ä¼šè¢«å½“åšè¿™ä¸ª Observable æ‰€å‘å‡º event æºå¸¦çš„æ•°æ®å†…å®¹ï¼Œæœ€ç»ˆæ•ˆæœåŒä¸Šé¢é¥¿ of() æ ·ä¾‹æ˜¯ä¸€æ ·çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.from([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;])</span><br></pre></td></tr></table></figure></p><h3 id="empty-æ–¹æ³•"><a href="#empty-æ–¹æ³•" class="headerlink" title="empty() æ–¹æ³•"></a>empty() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºå†…å®¹çš„ Observable åºåˆ—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable&lt;Int&gt;.empty()</span><br></pre></td></tr></table></figure></p><h3 id="never-æ–¹æ³•"><a href="#never-æ–¹æ³•" class="headerlink" title="never() æ–¹æ³•"></a>never() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ°¸è¿œä¸ä¼šå‘å‡º Eventï¼ˆä¹Ÿä¸ä¼šç»ˆæ­¢ï¼‰çš„ Observable åºåˆ—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable&lt;Int&gt;.never()</span><br></pre></td></tr></table></figure></p><h3 id="error-æ–¹æ³•"><a href="#error-æ–¹æ³•" class="headerlink" title="error() æ–¹æ³•"></a>error() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¸åšä»»ä½•æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥å‘é€ä¸€ä¸ªé”™è¯¯çš„ Observable åºåˆ—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enum MyError: Error &#123;</span><br><span class="line">    case A</span><br><span class="line">    case B</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line">let observable = Observable&lt;Int&gt;.error(MyError.A)</span><br></pre></td></tr></table></figure></p><h3 id="range-æ–¹æ³•"><a href="#range-æ–¹æ³•" class="headerlink" title="range() æ–¹æ³•"></a>range() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡æŒ‡å®šèµ·å§‹å’Œç»“æŸæ•°å€¼ï¼Œåˆ›å»ºä¸€ä¸ªä»¥è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰å€¼ä½œä¸ºåˆå§‹å€¼çš„ Observable åºåˆ—ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ä½¿ç”¨range()</span><br><span class="line">let observable = Observable.range(start: 1, count: 5)</span><br><span class="line"> </span><br><span class="line">//ä½¿ç”¨of()</span><br><span class="line">let observable = Observable.of(1, 2, 3 ,4 ,5)</span><br></pre></td></tr></table></figure></p><h3 id="repeatElement-æ–¹æ³•"><a href="#repeatElement-æ–¹æ³•" class="headerlink" title="repeatElement() æ–¹æ³•"></a>repeatElement() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥æ— é™å‘å‡ºç»™å®šå…ƒç´ çš„ Event çš„ Observable åºåˆ—ï¼ˆæ°¸ä¸ç»ˆæ­¢ï¼‰ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.repeatElement(1)</span><br></pre></td></tr></table></figure></p><h3 id="generate-æ–¹æ³•"><a href="#generate-æ–¹æ³•" class="headerlink" title="generate() æ–¹æ³•"></a>generate() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªåªæœ‰å½“æä¾›çš„æ‰€æœ‰çš„åˆ¤æ–­æ¡ä»¶éƒ½ä¸º true çš„æ—¶å€™ï¼Œæ‰ä¼šç»™å‡ºåŠ¨ä½œçš„ Observable åºåˆ—ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//ä½¿ç”¨generate()æ–¹æ³•</span><br><span class="line">let observable = Observable.generate(</span><br><span class="line">    initialState: 0,</span><br><span class="line">    condition: &#123; $0 &lt;= 10 &#125;,</span><br><span class="line">    iterate: &#123; $0 + 2 &#125;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">//ä½¿ç”¨of()æ–¹æ³•</span><br><span class="line">let observable = Observable.of(0 , 2 ,4 ,6 ,8 ,10)</span><br></pre></td></tr></table></figure></p><h3 id="create-æ–¹æ³•"><a href="#create-æ–¹æ³•" class="headerlink" title="create() æ–¹æ³•"></a>create() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª block å½¢å¼çš„å‚æ•°ï¼Œä»»åŠ¡æ˜¯å¯¹æ¯ä¸€ä¸ªè¿‡æ¥çš„è®¢é˜…è¿›è¡Œå¤„ç†ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ ·ä¾‹ã€‚ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œè¿™é‡Œå¢åŠ äº†è®¢é˜…ç›¸å…³ä»£ç ï¼ˆå…³äºè®¢é˜…æˆ‘ä¹‹åä¼šè¯¦ç»†ä»‹ç»çš„ï¼‰ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//è¿™ä¸ªblockæœ‰ä¸€ä¸ªå›è°ƒå‚æ•°observerå°±æ˜¯è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„è®¢é˜…è€…</span><br><span class="line">//å½“ä¸€ä¸ªè®¢é˜…è€…è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šå°†è®¢é˜…è€…ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ªblockæ¥æ‰§è¡Œä¸€äº›å†…å®¹</span><br><span class="line">let observable = Observable&lt;String&gt;.create&#123;observer in</span><br><span class="line">    //å¯¹è®¢é˜…è€…å‘å‡ºäº†.nextäº‹ä»¶ï¼Œä¸”æºå¸¦äº†ä¸€ä¸ªæ•°æ®&quot;hangge.com&quot;</span><br><span class="line">    observer.onNext(&quot;hangge.com&quot;)</span><br><span class="line">    //å¯¹è®¢é˜…è€…å‘å‡ºäº†.completedäº‹ä»¶</span><br><span class="line">    observer.onCompleted()</span><br><span class="line">    //å› ä¸ºä¸€ä¸ªè®¢é˜…è¡Œä¸ºä¼šæœ‰ä¸€ä¸ªDisposableç±»å‹çš„è¿”å›å€¼ï¼Œæ‰€ä»¥åœ¨ç»“å°¾ä¸€å®šè¦returenä¸€ä¸ªDisposable</span><br><span class="line">    return Disposables.create()</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//è®¢é˜…æµ‹è¯•</span><br><span class="line">observable.subscribe &#123;</span><br><span class="line">    print($0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="deferred-æ–¹æ³•"><a href="#deferred-æ–¹æ³•" class="headerlink" title="deferred() æ–¹æ³•"></a>deferred() æ–¹æ³•</h3><p>è¯¥ä¸ªæ–¹æ³•ç›¸å½“äºæ˜¯åˆ›å»ºä¸€ä¸ª Observable å·¥å‚ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ª block æ¥æ‰§è¡Œå»¶è¿Ÿ Observable åºåˆ—åˆ›å»ºçš„è¡Œä¸ºï¼Œè€Œè¿™ä¸ª block é‡Œå°±æ˜¯çœŸæ­£çš„å®ä¾‹åŒ–åºåˆ—å¯¹è±¡çš„åœ°æ–¹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//ç”¨äºæ ‡è®°æ˜¯å¥‡æ•°ã€è¿˜æ˜¯å¶æ•°</span><br><span class="line">var isOdd = true</span><br><span class="line"> </span><br><span class="line">//ä½¿ç”¨deferred()æ–¹æ³•å»¶è¿ŸObservableåºåˆ—çš„åˆå§‹åŒ–ï¼Œé€šè¿‡ä¼ å…¥çš„blockæ¥å®ç°Observableåºåˆ—çš„åˆå§‹åŒ–å¹¶ä¸”è¿”å›ã€‚</span><br><span class="line">let factory : Observable&lt;Int&gt; = Observable.deferred &#123;</span><br><span class="line">     </span><br><span class="line">    //è®©æ¯æ¬¡æ‰§è¡Œè¿™ä¸ªblockæ—¶å€™éƒ½ä¼šè®©å¥‡ã€å¶æ•°è¿›è¡Œäº¤æ›¿</span><br><span class="line">    isOdd = !isOdd</span><br><span class="line">     </span><br><span class="line">    //æ ¹æ®isOddå‚æ•°ï¼Œå†³å®šåˆ›å»ºå¹¶è¿”å›çš„æ˜¯å¥‡æ•°Observableã€è¿˜æ˜¯å¶æ•°Observable</span><br><span class="line">    if isOdd &#123;</span><br><span class="line">        return Observable.of(1, 3, 5 ,7)</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        return Observable.of(2, 4, 6, 8)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//ç¬¬1æ¬¡è®¢é˜…æµ‹è¯•</span><br><span class="line">factory.subscribe &#123; event in</span><br><span class="line">    print(&quot;\(isOdd)&quot;, event)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//ç¬¬2æ¬¡è®¢é˜…æµ‹è¯•</span><br><span class="line">factory.subscribe &#123; event in</span><br><span class="line">    print(&quot;\(isOdd)&quot;, event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="interval-æ–¹æ³•"><a href="#interval-æ–¹æ³•" class="headerlink" title="interval() æ–¹æ³•"></a>interval() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—æ¯éš”ä¸€æ®µè®¾å®šçš„æ—¶é—´ï¼Œä¼šå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°çš„å…ƒç´ ã€‚è€Œä¸”å®ƒä¼šä¸€ç›´å‘é€ä¸‹å»ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ–¹æ³•è®©å…¶æ¯ 1 ç§’å‘é€ä¸€æ¬¡ï¼Œå¹¶ä¸”æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼ˆMainSchedulerï¼‰å‘é€ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="timer-æ–¹æ³•"><a href="#timer-æ–¹æ³•" class="headerlink" title="timer() æ–¹æ³•"></a>timer() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//5ç§’ç§åå‘å‡ºå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ 0</span><br><span class="line">let observable = Observable&lt;Int&gt;.timer(5, scheduler: MainScheduler.instance)</span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ2ï¼‰å¦ä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œæ¯éš”ä¸€æ®µæ—¶é—´äº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//å»¶æ—¶5ç§’ç§åï¼Œæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªå…ƒç´ </span><br><span class="line">let observable = Observable&lt;Int&gt;.timer(5, period: 1, scheduler: MainScheduler.instance)</span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="è®¢é˜…-Observable"><a href="#è®¢é˜…-Observable" class="headerlink" title="è®¢é˜… Observable"></a>è®¢é˜… Observable</h1><h3 id="ç¬¬ä¸€ç§ç”¨æ³•ï¼š"><a href="#ç¬¬ä¸€ç§ç”¨æ³•ï¼š" class="headerlink" title="ç¬¬ä¸€ç§ç”¨æ³•ï¼š"></a>ç¬¬ä¸€ç§ç”¨æ³•ï¼š</h3><p>ï¼ˆ1ï¼‰æˆ‘ä»¬ä½¿ç”¨ subscribe() è®¢é˜…äº†ä¸€ä¸ª Observable å¯¹è±¡ï¼Œè¯¥æ–¹æ³•çš„ block çš„å›è°ƒå‚æ•°å°±æ˜¯è¢«å‘å‡ºçš„ event äº‹ä»¶ï¼Œæˆ‘ä»¬å°†å…¶ç›´æ¥æ‰“å°å‡ºæ¥ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥ç»“æœå¯ä»¥çœ‹å‡º</p><ul><li>åˆå§‹åŒ– Observable åºåˆ—æ—¶è®¾ç½®çš„é»˜è®¤å€¼éƒ½æŒ‰é¡ºåºé€šè¿‡ .next äº‹ä»¶å‘é€å‡ºæ¥ã€‚</li><li>å½“ Observable åºåˆ—çš„åˆå§‹æ•°æ®éƒ½å‘é€å®Œæ¯•ï¼Œå®ƒè¿˜ä¼šè‡ªåŠ¨å‘ä¸€ä¸ª .completed äº‹ä»¶å‡ºæ¥ã€‚<br></li></ul><p>ï¼ˆ2ï¼‰å¦‚æœæƒ³è¦è·å–åˆ°è¿™ä¸ªäº‹ä»¶é‡Œçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ event.element å¾—åˆ°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event.element)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ç¬¬äºŒç§ç”¨æ³•ï¼š"><a href="#ç¬¬äºŒç§ç”¨æ³•ï¼š" class="headerlink" title="ç¬¬äºŒç§ç”¨æ³•ï¼š"></a>ç¬¬äºŒç§ç”¨æ³•ï¼š</h3><p>ï¼ˆ1ï¼‰RxSwift è¿˜æä¾›äº†å¦ä¸€ä¸ª subscribe æ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠ event è¿›è¡Œåˆ†ç±»ï¼š</p><ul><li>é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚ï¼ˆå…¶ä¸­ onDisposed è¡¨ç¤ºè®¢é˜…è¡Œä¸ºè¢« dispose åçš„å›è°ƒï¼Œè¿™ä¸ªæˆ‘åé¢ä¼šè¯´ï¼‰</li><li>åŒæ—¶ä¼šæŠŠ event æºå¸¦çš„æ•°æ®ç›´æ¥è§£åŒ…å‡ºæ¥ä½œä¸ºå‚æ•°ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe(onNext: &#123; element in</span><br><span class="line">    print(element)</span><br><span class="line">&#125;, onError: &#123; error in</span><br><span class="line">    print(error)</span><br><span class="line">&#125;, onCompleted: &#123;</span><br><span class="line">    print(&quot;completed&quot;)</span><br><span class="line">&#125;, onDisposed: &#123;</span><br><span class="line">    print(&quot;disposed&quot;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p>2ï¼‰subscribe() æ–¹æ³•çš„ onNextã€onErrorã€onCompleted å’Œ onDisposed è¿™å››ä¸ªå›è°ƒ block å‚æ•°éƒ½æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œå³å®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åªå¤„ç† onNext è€Œä¸ç®¡å…¶ä»–çš„æƒ…å†µã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe(onNext: &#123; element in</span><br><span class="line">    print(element)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h1 id="ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h1><h3 id="1ã€-doOn-ä»‹ç»"><a href="#1ã€-doOn-ä»‹ç»" class="headerlink" title="1ã€ doOn ä»‹ç»"></a>1ã€ doOn ä»‹ç»</h3><p>ï¼ˆ1ï¼‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ doOn æ–¹æ³•æ¥ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡äº‹ä»¶å‘é€å‰è¢«è°ƒç”¨ã€‚<br><br>ï¼ˆ2ï¼‰åŒæ—¶å®ƒå’Œ subscribe ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚æ¯”å¦‚ï¼š</p><ul><li>do(onNext:) æ–¹æ³•å°±æ˜¯åœ¨ subscribe(onNext:) å‰è°ƒç”¨</li><li>è€Œ do(onCompleted:) æ–¹æ³•åˆ™ä¼šåœ¨ subscribe(onCompleted:) å‰é¢è°ƒç”¨ã€‚</li></ul><h3 id="ä½¿ç”¨æ ·ä¾‹"><a href="#ä½¿ç”¨æ ·ä¾‹" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line"> </span><br><span class="line">observable</span><br><span class="line">    .do(onNext: &#123; element in</span><br><span class="line">        print(&quot;Intercepted Nextï¼š&quot;, element)</span><br><span class="line">    &#125;, onError: &#123; error in</span><br><span class="line">        print(&quot;Intercepted Errorï¼š&quot;, error)</span><br><span class="line">    &#125;, onCompleted: &#123;</span><br><span class="line">        print(&quot;Intercepted Completed&quot;)</span><br><span class="line">    &#125;, onDispose: &#123;</span><br><span class="line">        print(&quot;Intercepted Disposed&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .subscribe(onNext: &#123; element in</span><br><span class="line">        print(element)</span><br><span class="line">    &#125;, onError: &#123; error in</span><br><span class="line">        print(error)</span><br><span class="line">    &#125;, onCompleted: &#123;</span><br><span class="line">        print(&quot;completed&quot;)</span><br><span class="line">    &#125;, onDisposed: &#123;</span><br><span class="line">        print(&quot;disposed&quot;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h1 id="Observable-çš„é”€æ¯ï¼ˆDisposeï¼‰"><a href="#Observable-çš„é”€æ¯ï¼ˆDisposeï¼‰" class="headerlink" title="Observable çš„é”€æ¯ï¼ˆDisposeï¼‰"></a>Observable çš„é”€æ¯ï¼ˆDisposeï¼‰</h1><h3 id="1ã€Observable-ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹"><a href="#1ã€Observable-ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹" class="headerlink" title="1ã€Observable ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹"></a>1ã€Observable ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹</h3><p>ï¼ˆ1ï¼‰ä¸€ä¸ª Observable åºåˆ—è¢«åˆ›å»ºå‡ºæ¥åå®ƒä¸ä¼šé©¬ä¸Šå°±å¼€å§‹è¢«æ¿€æ´»ä»è€Œå‘å‡º Eventï¼Œè€Œæ˜¯è¦ç­‰åˆ°å®ƒè¢«æŸä¸ªäººè®¢é˜…äº†æ‰ä¼šæ¿€æ´»å®ƒã€‚<br><br>ï¼ˆ2ï¼‰è€Œ Observable åºåˆ—æ¿€æ´»ä¹‹åè¦ä¸€ç›´ç­‰åˆ°å®ƒå‘å‡ºäº† .error æˆ–è€… .completed çš„ event åï¼Œå®ƒæ‰è¢«ç»ˆç»“ã€‚</p><h3 id="2ã€dispose-æ–¹æ³•"><a href="#2ã€dispose-æ–¹æ³•" class="headerlink" title="2ã€dispose() æ–¹æ³•"></a>2ã€dispose() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰ä½¿ç”¨è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å–æ¶ˆä¸€ä¸ªè®¢é˜…è¡Œä¸ºã€‚<br><br>ï¼ˆ2ï¼‰å¦‚æœæˆ‘ä»¬è§‰å¾—è¿™ä¸ªè®¢é˜…ç»“æŸäº†ä¸å†éœ€è¦äº†ï¼Œå°±å¯ä»¥è°ƒç”¨ dispose() æ–¹æ³•æŠŠè¿™ä¸ªè®¢é˜…ç»™é”€æ¯æ‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚<br><br>ï¼ˆ2ï¼‰å½“ä¸€ä¸ªè®¢é˜…è¡Œä¸ºè¢« dispose äº†ï¼Œé‚£ä¹ˆä¹‹å observable å¦‚æœå†å‘å‡º eventï¼Œè¿™ä¸ªå·²ç» dispose çš„è®¢é˜…å°±æ”¶ä¸åˆ°æ¶ˆæ¯äº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">//ä½¿ç”¨subscriptionå¸¸é‡å­˜å‚¨è¿™ä¸ªè®¢é˜…æ–¹æ³•</span><br><span class="line">let subscription = observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line">//è°ƒç”¨è¿™ä¸ªè®¢é˜…çš„dispose()æ–¹æ³•</span><br><span class="line">subscription.dispose()</span><br></pre></td></tr></table></figure></p><h3 id="3ã€DisposeBag"><a href="#3ã€DisposeBag" class="headerlink" title="3ã€DisposeBag"></a>3ã€DisposeBag</h3><p>é™¤äº† dispose() æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬æ›´ç»å¸¸ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªå« DisposeBag çš„å¯¹è±¡æ¥ç®¡ç†å¤šä¸ªè®¢é˜…è¡Œä¸ºçš„é”€æ¯ï¼š<br>æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ª DisposeBag å¯¹è±¡çœ‹æˆä¸€ä¸ªåƒåœ¾è¢‹ï¼ŒæŠŠç”¨è¿‡çš„è®¢é˜…è¡Œä¸ºéƒ½æ”¾è¿›å»ã€‚<br>è€Œè¿™ä¸ª DisposeBag å°±ä¼šåœ¨è‡ªå·±å¿«è¦ dealloc çš„æ—¶å€™ï¼Œå¯¹å®ƒé‡Œé¢çš„æ‰€æœ‰è®¢é˜…è¡Œä¸ºéƒ½è°ƒç”¨ dispose() æ–¹æ³•ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let disposeBag = DisposeBag()</span><br><span class="line">         </span><br><span class="line">//ç¬¬1ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…</span><br><span class="line">let observable1 = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">observable1.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">//ç¬¬2ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…</span><br><span class="line">let observable2 = Observable.of(1, 2, 3)</span><br><span class="line">observable2.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure></p><h1 id="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»"><a href="#è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»" class="headerlink" title="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»"></a>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»</h1><p>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„ä½œç”¨å°±æ˜¯ç›‘å¬äº‹ä»¶ï¼Œç„¶åå¯¹è¿™ä¸ªäº‹ä»¶åšå‡ºå“åº”ã€‚æˆ–è€…è¯´ä»»ä½•å“åº”äº‹ä»¶çš„è¡Œä¸ºéƒ½æ˜¯è§‚å¯Ÿè€…ã€‚æ¯”å¦‚ï¼š</p><ul><li>å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†â€å°±æ˜¯è§‚å¯Ÿè€… Observer<void></void></li><li>å½“æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªè¿œç¨‹çš„ json æ•°æ®åï¼Œå°†å…¶æ‰“å°å‡ºæ¥ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œæ‰“å° json æ•°æ®â€å°±æ˜¯è§‚å¯Ÿè€… Observer<json></json></li></ul><h1 id="ç›´æ¥åœ¨-subscribeã€bind-æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ç›´æ¥åœ¨-subscribeã€bind-æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ç›´æ¥åœ¨ subscribeã€bind æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…"></a>ç›´æ¥åœ¨ subscribeã€bind æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…</h1><h3 id="1-åœ¨-subscribe-æ–¹æ³•ä¸­åˆ›å»º"><a href="#1-åœ¨-subscribe-æ–¹æ³•ä¸­åˆ›å»º" class="headerlink" title="1. åœ¨ subscribe æ–¹æ³•ä¸­åˆ›å»º"></a>1. åœ¨ subscribe æ–¹æ³•ä¸­åˆ›å»º</h3><p>ï¼ˆ1ï¼‰åˆ›å»ºè§‚å¯Ÿè€…æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨ Observable çš„ subscribe æ–¹æ³•åé¢æè¿°å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéœ€è¦å¦‚ä½•åšå‡ºå“åº”ã€‚<br><br>ï¼ˆ2ï¼‰æ¯”å¦‚ä¸‹é¢çš„æ ·ä¾‹ï¼Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ onNextï¼ŒonErrorï¼ŒonCompleted è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">          </span><br><span class="line">observable.subscribe(onNext: &#123; element in</span><br><span class="line">    print(element)</span><br><span class="line">&#125;, onError: &#123; error in</span><br><span class="line">    print(error)</span><br><span class="line">&#125;, onCompleted: &#123;</span><br><span class="line">    print(&quot;completed&quot;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h3 id="2-åœ¨-bind-æ–¹æ³•ä¸­åˆ›å»º"><a href="#2-åœ¨-bind-æ–¹æ³•ä¸­åˆ›å»º" class="headerlink" title="2. åœ¨ bind æ–¹æ³•ä¸­åˆ›å»º"></a>2. åœ¨ bind æ–¹æ³•ä¸­åˆ›å»º</h3><p>ä¸‹é¢ä»£ç æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®šæ—¶ç”Ÿæˆç´¢å¼•æ•°çš„ Observable åºåˆ—ï¼Œå¹¶å°†ç´¢å¼•æ•°ä¸æ–­æ˜¾ç¤ºåœ¨ label æ ‡ç­¾ä¸Šï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag = DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        //Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line"> </span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind &#123; [weak self](text) in</span><br><span class="line">                //æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">                self?.label.text = text</span><br><span class="line">            &#125;</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="ä½¿ç”¨-AnyObserver-åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ä½¿ç”¨-AnyObserver-åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ä½¿ç”¨ AnyObserver åˆ›å»ºè§‚å¯Ÿè€…"></a>ä½¿ç”¨ AnyObserver åˆ›å»ºè§‚å¯Ÿè€…</h1><p>AnyObserver å¯ä»¥ç”¨æ¥æå™ä»»æ„ä¸€ç§è§‚å¯Ÿè€…ã€‚</p><h3 id="1ã€é…åˆ-subscribe-æ–¹æ³•ä½¿ç”¨"><a href="#1ã€é…åˆ-subscribe-æ–¹æ³•ä½¿ç”¨" class="headerlink" title="1ã€é…åˆ subscribe æ–¹æ³•ä½¿ç”¨"></a>1ã€é…åˆ subscribe æ–¹æ³•ä½¿ç”¨</h3><p>æ¯”å¦‚ä¸Šé¢ç¬¬ä¸€ä¸ªæ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//è§‚å¯Ÿè€…</span><br><span class="line">let observer: AnyObserver&lt;String&gt; = AnyObserver &#123; (event) in</span><br><span class="line">    switch event &#123;</span><br><span class="line">    case .next(let data):</span><br><span class="line">        print(data)</span><br><span class="line">    case .error(let error):</span><br><span class="line">        print(error)</span><br><span class="line">    case .completed:</span><br><span class="line">        print(&quot;completed&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">let observable = Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">observable.subscribe(observer)</span><br></pre></td></tr></table></figure></p><h3 id="2ã€é…åˆ-bindTo-æ–¹æ³•ä½¿ç”¨"><a href="#2ã€é…åˆ-bindTo-æ–¹æ³•ä½¿ç”¨" class="headerlink" title="2ã€é…åˆ bindTo æ–¹æ³•ä½¿ç”¨"></a>2ã€é…åˆ bindTo æ–¹æ³•ä½¿ç”¨</h3><p>ä¹Ÿå¯é…åˆ Observable çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼ˆbindToï¼‰ä½¿ç”¨ã€‚æ¯”å¦‚ä¸Šé¢çš„ç¬¬äºŒä¸ªæ ·ä¾‹æˆ‘å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag = DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        //è§‚å¯Ÿè€…</span><br><span class="line">        let observer: AnyObserver&lt;String&gt; = AnyObserver &#123; [weak self] (event) in</span><br><span class="line">            switch event &#123;</span><br><span class="line">            case .next(let text):</span><br><span class="line">                //æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">                self?.label.text = text</span><br><span class="line">            default:</span><br><span class="line">                break</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        //Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind(to: observer)</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="ä½¿ç”¨-Binder-åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ä½¿ç”¨-Binder-åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ä½¿ç”¨ Binder åˆ›å»ºè§‚å¯Ÿè€…"></a>ä½¿ç”¨ Binder åˆ›å»ºè§‚å¯Ÿè€…</h1><h3 id="1ã€åŸºæœ¬ä»‹ç»"><a href="#1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="1ã€åŸºæœ¬ä»‹ç»"></a>1ã€åŸºæœ¬ä»‹ç»</h3><p>ï¼ˆ1ï¼‰ç›¸è¾ƒäº AnyObserver çš„å¤§è€Œå…¨ï¼ŒBinder æ›´ä¸“æ³¨äºç‰¹å®šçš„åœºæ™¯ã€‚Binder ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul><li>ä¸ä¼šå¤„ç†é”™è¯¯äº‹ä»¶</li><li>ç¡®ä¿ç»‘å®šéƒ½æ˜¯åœ¨ç»™å®š Scheduler ä¸Šæ‰§è¡Œï¼ˆé»˜è®¤ MainSchedulerï¼‰</li></ul><p>ï¼ˆ2ï¼‰ä¸€æ—¦äº§ç”Ÿé”™è¯¯äº‹ä»¶ï¼Œåœ¨è°ƒè¯•ç¯å¢ƒä¸‹å°†æ‰§è¡Œ fatalErrorï¼Œåœ¨å‘å¸ƒç¯å¢ƒä¸‹å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</p><h3 id="ä½¿ç”¨æ ·ä¾‹-1"><a href="#ä½¿ç”¨æ ·ä¾‹-1" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h3><p>ï¼ˆ1ï¼‰åœ¨ä¸Šé¢åºåˆ—æ•°æ˜¾ç¤ºæ ·ä¾‹ä¸­ï¼Œlabel æ ‡ç­¾çš„æ–‡å­—æ˜¾ç¤ºå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ UI è§‚å¯Ÿè€…ã€‚å®ƒåœ¨å“åº”äº‹ä»¶æ—¶ï¼Œåªä¼šå¤„ç† next äº‹ä»¶ï¼Œè€Œä¸”æ›´æ–° UI çš„æ“ä½œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹æ›´å¥½çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Binderã€‚<br><br>ï¼ˆ2ï¼‰ä¸Šé¢çš„æ ·ä¾‹æˆ‘ä»¬æ”¹ç”¨ Binder ä¼šç®€å•è®¸å¤šï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag = DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">                 </span><br><span class="line">        //è§‚å¯Ÿè€…</span><br><span class="line">        let observer: Binder&lt;String&gt; = Binder(label) &#123; (view, text) in</span><br><span class="line">            //æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">            view.text = text</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        //Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind(to: observer)</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="é™„ï¼šBinder-åœ¨-RxCocoa-ä¸­çš„åº”ç”¨"><a href="#é™„ï¼šBinder-åœ¨-RxCocoa-ä¸­çš„åº”ç”¨" class="headerlink" title="é™„ï¼šBinder åœ¨ RxCocoa ä¸­çš„åº”ç”¨"></a>é™„ï¼šBinder åœ¨ RxCocoa ä¸­çš„åº”ç”¨</h3><p>ï¼ˆ1ï¼‰å…¶å® RxCocoa åœ¨å¯¹è®¸å¤š UI æ§ä»¶è¿›è¡Œæ‰©å±•æ—¶ï¼Œå°±åˆ©ç”¨ Binder å°†æ§ä»¶å±æ€§å˜æˆè§‚æŸ¥è€…ï¼Œæ¯”å¦‚ UIControl+Rx.swift ä¸­çš„ isEnabled å±æ€§ä¾¿æ˜¯ä¸€ä¸ª observer ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import RxSwift</span><br><span class="line">import UIKit</span><br><span class="line"> </span><br><span class="line">extension Reactive where Base: UIControl &#123;</span><br><span class="line">     </span><br><span class="line">    /// Bindable sink for `enabled` property.</span><br><span class="line">    public var isEnabled: Binder&lt;Bool&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; control, value in</span><br><span class="line">            control.isEnabled = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ2ï¼‰å› æ­¤æˆ‘ä»¬å¯ä»¥å°†åºåˆ—ç›´æ¥ç»‘å®šåˆ°å®ƒä¸Šé¢ã€‚æ¯”å¦‚ä¸‹é¢æ ·ä¾‹ï¼Œbutton ä¼šåœ¨å¯ç”¨ã€ä¸å¯ç”¨è¿™ä¸¤ç§çŠ¶æ€é—´äº¤æ›¿å˜æ¢ï¼ˆæ¯éš”ä¸€ç§’ï¼‰ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">let observable = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">observable</span><br><span class="line">    .map &#123; $0 % 2 == 0 &#125;</span><br><span class="line">    .bind(to: button.rx.isEnabled)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure></p><h1 id="è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§"><a href="#è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§" class="headerlink" title="è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§"></a>è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§</h1><p>æœ‰æ—¶æˆ‘ä»¬æƒ³è®© UI æ§ä»¶åˆ›å»ºå‡ºæ¥åé»˜è®¤å°±æœ‰ä¸€äº›è§‚å¯Ÿè€…ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½ä¸ºå®ƒä»¬å•ç‹¬å»åˆ›å»ºè§‚å¯Ÿè€…ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦è®©æ‰€æœ‰çš„ UIlabel éƒ½æœ‰ä¸ª fontSize å¯ç»‘å®šå±æ€§ï¼Œå®ƒä¼šæ ¹æ®äº‹ä»¶å€¼è‡ªåŠ¨æ”¹å˜æ ‡ç­¾çš„å­—ä½“å¤§å°ã€‚</p><h3 id="æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹-UI-ç±»è¿›è¡Œæ‰©å±•"><a href="#æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹-UI-ç±»è¿›è¡Œæ‰©å±•" class="headerlink" title="æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹ UI ç±»è¿›è¡Œæ‰©å±•"></a>æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹ UI ç±»è¿›è¡Œæ‰©å±•</h3><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡å¯¹ UILabel è¿›è¡Œæ‰©å±•ï¼Œå¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag = DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        //Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable = Observable&lt;Int&gt;.interval(0.5, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; CGFloat($0) &#125;</span><br><span class="line">            .bind(to: label.fontSize) //æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">extension UILabel &#123;</span><br><span class="line">    public var fontSize: Binder&lt;CGFloat&gt; &#123;</span><br><span class="line">        return Binder(self) &#123; label, fontSize in</span><br><span class="line">            label.font = UIFont.systemFont(ofSize: fontSize)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ–¹å¼äºŒï¼šé€šè¿‡å¯¹-Reactive-ç±»è¿›è¡Œæ‰©å±•"><a href="#æ–¹å¼äºŒï¼šé€šè¿‡å¯¹-Reactive-ç±»è¿›è¡Œæ‰©å±•" class="headerlink" title="æ–¹å¼äºŒï¼šé€šè¿‡å¯¹ Reactive ç±»è¿›è¡Œæ‰©å±•"></a>æ–¹å¼äºŒï¼šé€šè¿‡å¯¹ Reactive ç±»è¿›è¡Œæ‰©å±•</h3><p>æ—¢ç„¶ä½¿ç”¨äº† RxSwiftï¼Œé‚£ä¹ˆæ›´è§„èŒƒçš„å†™æ³•åº”è¯¥æ˜¯å¯¹ Reactive è¿›è¡Œæ‰©å±•ã€‚è¿™é‡ŒåŒæ ·æ˜¯ç»™ UILabel å¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚<br><br>ï¼ˆæ³¨æ„ï¼šè¿™ç§æ–¹å¼ä¸‹ï¼Œæˆ‘ä»¬ç»‘å®šå±æ€§æ—¶è¦å†™æˆ label.rx.fontSizeï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag = DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        //Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable = Observable&lt;Int&gt;.interval(0.5, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; CGFloat($0) &#125;</span><br><span class="line">            .bind(to: label.rx.fontSize) //æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">extension Reactive where Base: UILabel &#123;</span><br><span class="line">    public var fontSize: Binder&lt;CGFloat&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; label, fontSize in</span><br><span class="line">            label.font = UIFont.systemFont(ofSize: fontSize)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="RxSwift-è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI-è§‚å¯Ÿè€…ï¼‰"><a href="#RxSwift-è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI-è§‚å¯Ÿè€…ï¼‰" class="headerlink" title="RxSwift è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI è§‚å¯Ÿè€…ï¼‰"></a>RxSwift è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI è§‚å¯Ÿè€…ï¼‰</h1><p>ï¼ˆ1ï¼‰å…¶å® RxSwift å·²ç»ä¸ºæˆ‘ä»¬æä¾›è®¸å¤šå¸¸ç”¨çš„å¯ç»‘å®šå±æ€§ã€‚æ¯”å¦‚ UILabel å°±æœ‰ text å’Œ attributedText è¿™ä¸¤ä¸ªå¯ç»‘å®šå±æ€§ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import RxSwift</span><br><span class="line">import UIKit</span><br><span class="line"> </span><br><span class="line">extension Reactive where Base: UILabel &#123;</span><br><span class="line">     </span><br><span class="line">    /// Bindable sink for `text` property.</span><br><span class="line">    public var text: Binder&lt;String?&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; label, text in</span><br><span class="line">            label.text = text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /// Bindable sink for `attributedText` property.</span><br><span class="line">    public var attributedText: Binder&lt;NSAttributedString?&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; label, text in</span><br><span class="line">            label.attributedText = text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ2ï¼‰é‚£ä¹ˆä¸Šæ–‡é‚£ä¸ªå®šæ—¶æ˜¾ç¤ºç´¢å¼•æ•°çš„æ ·ä¾‹ï¼Œæˆ‘ä»¬å…¶å®ä¸éœ€è¦è‡ªå®šä¹‰ UI è§‚å¯Ÿè€…ï¼Œç›´æ¥ä½¿ç”¨ RxSwift æä¾›çš„ç»‘å®šå±æ€§å³å¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag = DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        //Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind(to: label.rx.text) //æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="Subjects-ä»‹ç»"><a href="#Subjects-ä»‹ç»" class="headerlink" title="Subjects ä»‹ç»"></a>Subjects ä»‹ç»</h1><h3 id="Subjects-åŸºæœ¬ä»‹ç»"><a href="#Subjects-åŸºæœ¬ä»‹ç»" class="headerlink" title="Subjects åŸºæœ¬ä»‹ç»"></a>Subjects åŸºæœ¬ä»‹ç»</h3><p>ï¼ˆ1ï¼‰Subjects æ—¢æ˜¯è®¢é˜…è€…ï¼Œä¹Ÿæ˜¯ Observableï¼š</p><ul><li>è¯´å®ƒæ˜¯è®¢é˜…è€…ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½å¤ŸåŠ¨æ€åœ°æ¥æ”¶æ–°çš„å€¼ã€‚</li><li>è¯´å®ƒåˆæ˜¯ä¸€ä¸ª Observableï¼Œæ˜¯å› ä¸ºå½“ Subjects æœ‰äº†æ–°çš„å€¼ä¹‹åï¼Œå°±ä¼šé€šè¿‡ Event å°†æ–°å€¼å‘å‡ºç»™ä»–çš„æ‰€æœ‰è®¢é˜…è€…ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸€å…±æœ‰å››ç§ Subjectsï¼Œåˆ†åˆ«ä¸ºï¼šPublishSubjectã€BehaviorSubjectã€ReplaySubjectã€Variableã€‚ä»–ä»¬ä¹‹é—´æ—¢æœ‰å„è‡ªçš„ç‰¹ç‚¹ï¼Œä¹Ÿæœ‰ç›¸åŒä¹‹å¤„ï¼š</p><ul><li>é¦–å…ˆä»–ä»¬éƒ½æ˜¯ Observableï¼Œä»–ä»¬çš„è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ä»–ä»¬å‘å‡ºçš„æ–°çš„ Eventã€‚</li><li>ç›´åˆ° Subject å‘å‡º .complete æˆ–è€… .error çš„ Event åï¼Œè¯¥ Subject ä¾¿ç»ˆç»“äº†ï¼ŒåŒæ—¶å®ƒä¹Ÿå°±ä¸ä¼šå†å‘å‡º .next äº‹ä»¶ã€‚</li><li>å¯¹äºé‚£äº›åœ¨ Subject ç»ˆç»“åå†è®¢é˜…ä»–çš„è®¢é˜…è€…ï¼Œä¹Ÿèƒ½æ”¶åˆ° subject å‘å‡ºçš„ä¸€æ¡ .complete æˆ– .error çš„ eventï¼Œå‘Šè¯‰è¿™ä¸ªæ–°çš„è®¢é˜…è€…å®ƒå·²ç»ç»ˆç»“äº†ã€‚</li><li>ä»–ä»¬ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åªæ˜¯åœ¨äºï¼šå½“ä¸€ä¸ªæ–°çš„è®¢é˜…è€…åˆšè®¢é˜…å®ƒçš„æ—¶å€™ï¼Œèƒ½ä¸èƒ½æ”¶åˆ° Subject ä»¥å‰å‘å‡ºè¿‡çš„æ—§ Eventï¼Œå¦‚æœèƒ½çš„è¯åˆèƒ½æ”¶åˆ°å¤šå°‘ä¸ªã€‚</li></ul><p>ï¼ˆ3ï¼‰Subject å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•ï¼š</p><ul><li>onNext(:)ï¼šæ˜¯ on(.next(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .next äº‹ä»¶ã€‚</li><li>onError(:)ï¼šæ˜¯ on(.error(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .error äº‹ä»¶ã€‚</li><li>onCompleted()ï¼šæ˜¯ on(.completed) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .completed äº‹ä»¶ã€‚</li></ul><h3 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h3><p>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>PublishSubject æ˜¯æœ€æ™®é€šçš„ Subjectï¼Œå®ƒä¸éœ€è¦åˆå§‹å€¼å°±èƒ½åˆ›å»ºã€‚</li><li>PublishSubject çš„è®¢é˜…è€…ä»ä»–ä»¬å¼€å§‹è®¢é˜…çš„æ—¶é—´ç‚¹èµ·ï¼Œå¯ä»¥æ”¶åˆ°è®¢é˜…å Subject å‘å‡ºçš„æ–° Eventï¼Œè€Œä¸ä¼šæ”¶åˆ°ä»–ä»¬åœ¨è®¢é˜…å‰å·²å‘å‡ºçš„ Eventã€‚<br>ï¼ˆ2ï¼‰æ—¶åºå›¾</li><li>æœ€ä¸Šé¢ä¸€æ¡æ˜¯ BehaviorSubjectã€‚<br>-ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒï¼Œå¯ä»¥å‘ç° BehaviorSubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° BehaviorSubjects ä¹‹å‰å‘å‡ºçš„ä¸€ä¸ª Eventã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3334769-516513ae6b34d5b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ—¶åºå›¾"><br><br>ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let disposeBag = DisposeBag()</span><br><span class="line"> </span><br><span class="line">//åˆ›å»ºä¸€ä¸ªBehaviorSubject</span><br><span class="line">let subject = BehaviorSubject(value: &quot;111&quot;)</span><br><span class="line"> </span><br><span class="line">//ç¬¬1æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">//å‘é€nextäº‹ä»¶</span><br><span class="line">subject.onNext(&quot;222&quot;)</span><br><span class="line"> </span><br><span class="line">//å‘é€erroräº‹ä»¶</span><br><span class="line">subject.onError(NSError(domain: &quot;local&quot;, code: 0, userInfo: nil))</span><br><span class="line"> </span><br><span class="line">//ç¬¬2æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure></li></ul><h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3><p>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>ReplaySubject åœ¨åˆ›å»ºæ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ª bufferSizeï¼Œè¡¨ç¤ºå®ƒå¯¹äºå®ƒå‘é€è¿‡çš„ event çš„ç¼“å­˜ä¸ªæ•°ã€‚</li><li>æ¯”å¦‚ä¸€ä¸ª ReplaySubject çš„ bufferSize è®¾ç½®ä¸º 2ï¼Œå®ƒå‘å‡ºäº† 3 ä¸ª .next çš„ eventï¼Œé‚£ä¹ˆå®ƒä¼šå°†åä¸¤ä¸ªï¼ˆæœ€è¿‘çš„ä¸¤ä¸ªï¼‰event ç»™ç¼“å­˜èµ·æ¥ã€‚æ­¤æ—¶å¦‚æœæœ‰ä¸€ä¸ª subscriber è®¢é˜…äº†è¿™ä¸ª ReplaySubjectï¼Œé‚£ä¹ˆè¿™ä¸ª subscriber å°±ä¼šç«‹å³æ”¶åˆ°å‰é¢ç¼“å­˜çš„ä¸¤ä¸ª .next çš„ eventã€‚</li><li>å¦‚æœä¸€ä¸ª subscriber è®¢é˜…å·²ç»ç»“æŸçš„ ReplaySubjectï¼Œé™¤äº†ä¼šæ”¶åˆ°ç¼“å­˜çš„ .next çš„ event å¤–ï¼Œè¿˜ä¼šæ”¶åˆ°é‚£ä¸ªç»ˆç»“çš„ .error æˆ–è€… .complete çš„ eventã€‚</li></ul><p>ï¼ˆ2ï¼‰æ—¶åºå›¾</p><ul><li>æœ€ä¸Šé¢ä¸€æ¡æ˜¯ ReplaySubjectï¼ˆbufferSize è®¾ä¸ºä¸º 2ï¼‰ã€‚</li><li>ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒã€‚å¯ä»¥å‘ç° ReplaySubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° ReplaySubject ä¹‹å‰å‘å‡ºçš„ä¸¤ä¸ª Eventï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3334769-4dec2ddcf714e9ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ—¶åºå›¾"><br><br>ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">let disposeBag = DisposeBag()</span><br><span class="line"> </span><br><span class="line">//åˆ›å»ºä¸€ä¸ªbufferSizeä¸º2çš„ReplaySubject</span><br><span class="line">let subject = ReplaySubject&lt;String&gt;.create(bufferSize: 2)</span><br><span class="line"> </span><br><span class="line">//è¿ç»­å‘é€3ä¸ªnextäº‹ä»¶</span><br><span class="line">subject.onNext(&quot;111&quot;)</span><br><span class="line">subject.onNext(&quot;222&quot;)</span><br><span class="line">subject.onNext(&quot;333&quot;)</span><br><span class="line"> </span><br><span class="line">//ç¬¬1æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">//å†å‘é€1ä¸ªnextäº‹ä»¶</span><br><span class="line">subject.onNext(&quot;444&quot;)</span><br><span class="line"> </span><br><span class="line">//ç¬¬2æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">//è®©subjectç»“æŸ</span><br><span class="line">subject.onCompleted()</span><br><span class="line"> </span><br><span class="line">//ç¬¬3æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬3æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure></li></ul><h3 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h3><p>ï¼ˆæ³¨æ„ï¼šç”±äº Variable åœ¨ä¹‹åç‰ˆæœ¬ä¸­å°†è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ Varible çš„åœ°æ–¹éƒ½æ”¹ç”¨ä¸‹é¢ä»‹ç»çš„ BehaviorRelay ä½œä¸ºæ›¿ä»£ã€‚ï¼‰<br><br>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>Variable å…¶å®å°±æ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚</li><li>Variable å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚</li><li>ä¸åŒçš„æ˜¯ï¼ŒVariable è¿˜æŠŠä¼šæŠŠå½“å‰å‘å‡ºçš„å€¼ä¿å­˜ä¸ºè‡ªå·±çš„çŠ¶æ€ã€‚åŒæ—¶å®ƒä¼šåœ¨é”€æ¯æ—¶è‡ªåŠ¨å‘é€ .complete çš„ eventï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ Variables å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒã€‚</li><li>ç®€å•åœ°è¯´å°±æ˜¯ Variable æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬æ”¹å˜è¿™ä¸ª value å±æ€§çš„å€¼å°±ç›¸å½“äºè°ƒç”¨ä¸€èˆ¬ Subjects çš„ onNext() æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæœ€æ–°çš„ onNext() çš„å€¼å°±è¢«ä¿å­˜åœ¨ value å±æ€§é‡Œäº†ï¼Œç›´åˆ°æˆ‘ä»¬å†æ¬¡ä¿®æ”¹å®ƒã€‚<blockquote><p>æ³¨æ„ï¼š<br><br>Variables æœ¬èº«æ²¡æœ‰ subscribe() æ–¹æ³•ï¼Œä½†æ˜¯æ‰€æœ‰ Subjects éƒ½æœ‰ä¸€ä¸ª asObservable() æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿”å›è¿™ä¸ª Variable çš„ Observable ç±»å‹ï¼Œæ‹¿åˆ°è¿™ä¸ª Observable ç±»å‹æˆ‘ä»¬å°±èƒ½è®¢é˜…å®ƒäº†ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨æ ·ä¾‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line"> </span><br><span class="line">        let disposeBag = DisposeBag()</span><br><span class="line">         </span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„Variable</span><br><span class="line">        let variable = Variable(&quot;111&quot;)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        variable.value = &quot;222&quot;</span><br><span class="line">         </span><br><span class="line">        //ç¬¬1æ¬¡è®¢é˜…</span><br><span class="line">        variable.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">        &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        variable.value = &quot;333&quot;</span><br><span class="line">         </span><br><span class="line">        //ç¬¬2æ¬¡è®¢é˜…</span><br><span class="line">        variable.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">        &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        variable.value = &quot;444&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="BehaviorRelay"><a href="#BehaviorRelay" class="headerlink" title="BehaviorRelay"></a>BehaviorRelay</h3><p>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>BehaviorRelay æ˜¯ä½œä¸º Variable çš„æ›¿ä»£è€…å‡ºç°çš„ã€‚å®ƒçš„æœ¬è´¨å…¶å®ä¹Ÿæ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚</li><li>BehaviorRelay å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚</li><li>ä¸ BehaviorSubject ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ BehaviorReply å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒï¼ˆBehaviorRelay ä¼šåœ¨é”€æ¯æ—¶ä¹Ÿä¸ä¼šè‡ªåŠ¨å‘é€ .complete çš„ eventï¼‰ã€‚</li><li>BehaviorRelay æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è·å–æœ€æ–°å€¼ã€‚è€Œé€šè¿‡å®ƒçš„ accept() æ–¹æ³•å¯ä»¥å¯¹å€¼è¿›è¡Œä¿®æ”¹ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸Šé¢çš„ Variable æ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹ç”¨æˆ BehaviorRelayï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">         </span><br><span class="line">        let disposeBag = DisposeBag()</span><br><span class="line">         </span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„BehaviorRelay</span><br><span class="line">        let subject = BehaviorRelay&lt;String&gt;(value: &quot;111&quot;)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(&quot;222&quot;)</span><br><span class="line">         </span><br><span class="line">        //ç¬¬1æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(&quot;333&quot;)</span><br><span class="line">         </span><br><span class="line">        //ç¬¬2æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(&quot;444&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ3ï¼‰å¦‚æœæƒ³å°†æ–°å€¼åˆå¹¶åˆ°åŸå€¼ä¸Šï¼Œå¯ä»¥é€šè¿‡ accept() æ–¹æ³•ä¸ value å±æ€§é…åˆæ¥å®ç°ã€‚ï¼ˆè¿™ä¸ªå¸¸ç”¨åœ¨è¡¨æ ¼ä¸Šæ‹‰åŠ è½½åŠŸèƒ½ä¸Šï¼ŒBehaviorRelay ç”¨æ¥ä¿å­˜æ‰€æœ‰åŠ è½½åˆ°çš„æ•°æ®ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">         </span><br><span class="line">        let disposeBag = DisposeBag()</span><br><span class="line">         </span><br><span class="line">        //åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸ºåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„çš„BehaviorRelay</span><br><span class="line">        let subject = BehaviorRelay&lt;[String]&gt;(value: [&quot;1&quot;])</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(subject.value + [&quot;2&quot;, &quot;3&quot;])</span><br><span class="line">         </span><br><span class="line">        //ç¬¬1æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(subject.value + [&quot;4&quot;, &quot;5&quot;])</span><br><span class="line">         </span><br><span class="line">        //ç¬¬2æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        //ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(subject.value + [&quot;6&quot;, &quot;7&quot;])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Observable-ä»‹ç»&quot;&gt;&lt;a href=&quot;#Observable-ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;Observable ä»‹ç»&quot;&gt;&lt;/a&gt;Observable ä»‹ç»&lt;/h1&gt;&lt;h2 id=&quot;Observable&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CALayerçš„å±æ€§å’Œä½¿ç”¨(æœªå®Œç»“)</title>
    <link href="https://wudan-ios.github.io/2018/11/23/CALayer%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8(%E6%9C%AA%E5%AE%8C%E7%BB%93)/"/>
    <id>https://wudan-ios.github.io/2018/11/23/CALayerçš„å±æ€§å’Œä½¿ç”¨(æœªå®Œç»“)/</id>
    <published>2018-11-23T08:19:32.074Z</published>
    <updated>2018-11-23T08:24:37.392Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§"><a href="#ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§" class="headerlink" title="ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§"></a>ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§</h2><blockquote><ul><li><p>1ã€@propertyCGPoint position;<br>å›¾å±‚ä¸­å¿ƒç‚¹çš„ä½ç½®ï¼Œç±»ä¼¼ä¸UIViewçš„centerï¼›ç”¨æ¥è®¾ç½®CALayeråœ¨çˆ¶å±‚ä¸­çš„ä½ç½®ï¼›ä»¥çˆ¶å±‚çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰</p></li><li><p>2ã€ @property CGPoint anchorPoint;<br>ç§°ã€å®šä½ç‚¹ã€ã€ã€é”šç‚¹ã€ï¼Œè¯¥æè¿°æ˜¯ç›¸å¯¹äºxã€yä½ç½®æ¯”ä¾‹è€Œè¨€çš„é»˜è®¤åœ¨å›¾åƒä¸­å¿ƒç‚¹ï¼ˆ0.5ã€0.5ï¼‰çš„ä½ç½®ï¼›å†³å®šç€CALayerèº«ä¸Šçš„å“ªä¸ªç‚¹ä¼šå†positionå±æ€§æ‰€æŒ‡çš„ä½ç½®ï¼Œä»¥è‡ªå·±çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰ï¼›å®ƒçš„xã€yå–å€¼èŒƒå›´éƒ½æ˜¯0~1</p></li><li><p>3ã€ @property(nullable) CGColorRef backgroundColor<br>å›¾å±‚èƒŒæ™¯é¢œè‰²</p></li><li><p>4ã€ @property(nullable) CGColorRef borderColor<br>å›¾å±‚è¾¹æ¡†é¢œè‰²</p></li><li><p>5ã€ @property CGFloat borderWidth<br>å›¾å±‚è¾¹æ¡†å®½åº¦</p></li><li><p>6ã€ @property CGRect bounds<br>å›¾å±‚å¤§å°</p></li><li><p>7ã€ @property(nullable, strong) id contents<br>å›¾å±‚æ˜¾ç¤ºå†…å®¹ï¼Œä¾‹å¦‚å¯ä»¥å°†å›¾ç‰‡ä½œä¸ºå›¾å±‚å†…å®¹æ˜¾ç¤º</p></li><li><p>8ã€ @property CGRect contentsRect<br>å›¾å±‚æ˜¾ç¤ºå†…å®¹çš„å¤§å°å’Œä½ç½®</p></li><li><p>9ã€ @property CGFloat cornerRadius<br>åœ†è§’åŠå¾„</p></li><li><p>10ã€ @property(getter=isDoubleSided) BOOL doubleSided<br>å›¾å±‚èƒŒæ™¯æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤æ˜¯YES</p></li><li><p>11ã€ @property CGRect frame<br>å›¾å±‚å¤§å°å’Œä½ç½®ï¼Œä¸æ”¯æŒéšå¼åŠ¨ç”»ï¼Œæ‰€ä»¥CALyaerä¸­å¾ˆå°‘ä½¿ç”¨frameï¼Œé€šå¸¸ä½¿ç”¨boundå’Œpositionä»£æ›¿</p></li><li><p>12ã€ @property(getter=isHidden) BOOL hidden<br>æ˜¯å¦éšè—</p></li><li><p>13ã€ @property(nullable, strong) CALayer *mask<br>å›¾å±‚è’™ç‰ˆ</p></li><li><p>14ã€ @property BOOL masksToBounds<br>å­å›¾å±‚æ˜¯å¦å‰ªåˆ‡å›¾å±‚è¾¹ç•Œï¼Œé»˜è®¤æ˜¯NO</p></li><li><p>15ã€ @property float opacit;<br>å›¾å±‚é€æ˜åº¦ï¼Œç±»ä¼¼ä¸UIViewçš„alpha</p></li><li><p>16ã€ @property(nullable) CGColorRef shadowColor<br>é˜´å½±é¢œè‰²</p></li><li><p>17ã€ @property CGSize shadowOffset<br>é˜´å½±åç§»é‡</p></li><li><p>18ã€ @property float shadowOpacity<br>é˜´å½±é€æ˜åº¦ï¼Œæ³¨æ„é»˜è®¤ä¸º0ï¼Œå¦‚æœè®¾ç½®é˜´å½±å¿…é¡»è®¾ç½®æ­¤å±æ€§</p></li><li><p>19ã€ @property(nullable) CGPathRef shadowPath<br>é˜´å½±å½¢çŠ¶</p></li><li><p>20ã€ @property CGFloat shadowRadius<br>é˜´å½±æ¨¡ç³ŠåŠå¾„</p></li><li><p>21ã€ @property(nullable, copy) NSArray</p></li></ul></blockquote><h2 id="äºŒã€CALayerä¸å¸¸ç”¨å±æ€§"><a href="#äºŒã€CALayerä¸å¸¸ç”¨å±æ€§" class="headerlink" title="äºŒã€CALayerä¸å¸¸ç”¨å±æ€§"></a>äºŒã€CALayerä¸å¸¸ç”¨å±æ€§</h2><blockquote><ul><li><p>1ã€ @property CGFloat zPosition<br>å›¾å±‚ä¸­å¿ƒç‚¹åœ¨zè½´ä¸­çš„ä½ç½®</p></li><li><p>2ã€ @property CGFloat anchorPointZ<br>å›¾å±‚åœ¨zè½´ä¸­çš„é”šç‚¹ï¼›</p></li><li><p>3ã€ - (CGAffineTransform)affineTransform</p></li><li><p>4ã€- (void)setAffineTransform:(CGAffineTransform)m<br>ä»¥ä¸Šå±æ€§ä¸ºå›¾å±‚å½¢å˜ï¼›è¯¥å±æ€§å€¼æŒ‡å®šä¸€ä¸ªCGAffineTransformå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»£è¡¨å¯¹CALayeræ‰§è¡ŒXã€Yä¸¤ä¸ªç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯å¹³é¢ï¼‰ä¸Šçš„æ—‹è½¬ã€ç¼©æ”¾ã€ä½ç§»ã€æ–œåˆ‡ã€é•œåƒç­‰å˜æ¢çŸ©é˜µ</p></li><li><p>5ã€ @property(nullable, readonly) CALayer *superlayer<br>å›¾å±‚çš„çˆ¶å›¾å±‚</p></li></ul></blockquote><h2 id="ä¸‰ã€CALayerå›¾å±‚æ“ä½œ"><a href="#ä¸‰ã€CALayerå›¾å±‚æ“ä½œ" class="headerlink" title="ä¸‰ã€CALayerå›¾å±‚æ“ä½œ"></a>ä¸‰ã€CALayerå›¾å±‚æ“ä½œ</h2><blockquote><ul><li><p>1ã€ - (void)addSublayer:(CALayer *)layer<br>æ·»åŠ å­å›¾å±‚</p></li><li><p>2ã€ - (void)removeFromSuperlayer<br>å°†è‡ªå·±ä»çˆ¶å›¾å±‚ä¸­ç§»é™¤</p></li><li><p>3ã€ - (void)insertSublayer:(CALayer *)layer atIndex:(unsigned)idx<br>åœ¨è‡ªå·±å­å›¾å±‚æ•°ç»„ä¸­çš„ç¬¬idxä½ç½®æ·»åŠ å›¾å±‚</p></li><li><p>4ã€ - (void)insertSublayer:(CALayer )layer below:(nullable CALayer )sibling<br>å°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸‹é¢</p></li><li><p>5ã€ - (void)insertSublayer:(CALayer )layer above:(nullable CALayer )sibling<br>å°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸Šé¢</p></li><li><p>6ã€ - (void)replaceSublayer:(CALayer )layer with:(CALayer )layer2<br>å°†å›¾å±‚layeræ›¿æ¢layer2ï¼›</p></li></ul></blockquote><h2 id="å››ã€CALayeråŠ¨ç”»æ“ä½œ"><a href="#å››ã€CALayeråŠ¨ç”»æ“ä½œ" class="headerlink" title="å››ã€CALayeråŠ¨ç”»æ“ä½œ"></a>å››ã€CALayeråŠ¨ç”»æ“ä½œ</h2><blockquote><ul><li><p>1ã€ - (void)addAnimation:(CAAnimation )anim forKey:(nullable NSString )key<br>å›¾å±‚æ·»åŠ æŸä¸€å±æ€§çš„åŠ¨ç”»</p></li><li><p>2ã€ - (nullable NSArray&lt; NSString &gt; )animationKeys<br>è·å–æ‰€æœ‰åŠ¨ç”»çš„å±æ€§</p></li><li><p>3ã€ - (nullable CAAnimation )animationForKey:(NSString )key<br>è·å–æŸä¸€å±æ€§çš„åŠ¨ç”»</p></li><li><p>4ã€ - (void)removeAnimationForKey:(NSString *)key<br>ç§»é™¤æŸä¸€å±æ€§åŠ¨ç”»</p></li><li><p>5ã€ - (void)removeAllAnimations<br>ç§»é™¤æ‰€æœ‰åŠ¨ç”»</p></li></ul></blockquote><h2 id="äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜"><a href="#äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜" class="headerlink" title="äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜"></a>äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜</h2><table><thead><tr><th>å­ç±»åç§°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>CAEmitterLayer</td><td>å‘å°„å™¨å±‚ï¼Œç”¨æ¥æ§åˆ¶ç²’å­æ•ˆæœ</td></tr><tr><td>CAGradientLayer</td><td>æ¢¯åº¦å±‚ï¼Œé¢œè‰²æ¸å˜</td></tr><tr><td>CAEAGLayer</td><td>ç”¨OpenGL ESç»˜åˆ¶çš„å±‚</td></tr><tr><td>CAReplicationLayer</td><td>ç”¨æ¥è‡ªåŠ¨å¤åˆ¶sublayer</td></tr><tr><td>CAShapeLayer</td><td>ç»˜åˆ¶ç«‹ä½“çš„è´å¡å°”æ›²çº¿</td></tr><tr><td>CAScrollLayer</td><td>ç”¨æ¥ç®¡ç†å¯æ»‘åŠ¨çš„åŒºåŸŸ</td></tr><tr><td>CATextLayer</td><td>å¯ä»¥ç»˜åˆ¶AttributeString</td></tr><tr><td>CATiledLayer</td><td>ç”¨æ¥ç®¡ç†ä¸€å‰¯å¯ä»¥è¢«åˆ†å‰²çš„å¤§å›¾</td></tr><tr><td>CATransformLayer</td><td>ç”¨æ¥æ¸²æŸ“3D layerçš„å±‚æ¬¡ç»“æ„</td></tr></tbody></table><h3 id="1-CAShapeLayer"><a href="#1-CAShapeLayer" class="headerlink" title="1. CAShapeLayer"></a>1. CAShapeLayer</h3><p>CAShapeLayerå±äºQuartzCoreæ¡†æ¶ï¼Œç»§æ‰¿è‡ªCALayerã€‚CAShapeLayeræ˜¯åœ¨åæ ‡ç³»å†…ç»˜åˆ¶è´å¡å°”æ›²çº¿çš„ï¼Œé€šè¿‡ç»˜åˆ¶è´å¡å°”æ›²çº¿ï¼Œè®¾ç½®shape(å½¢çŠ¶)çš„path(è·¯å¾„)ï¼Œä»è€Œç»˜åˆ¶å„ç§å„æ ·çš„å›¾å½¢ä»¥åŠä¸è§„åˆ™å›¾å½¢ã€‚å› æ­¤ï¼Œä½¿ç”¨CAShapeLayeréœ€è¦ä¸UIBezierPathä¸€èµ·ä½¿ç”¨ã€‚<br>UIBezierPathç±»å…è®¸ä½ åœ¨è‡ªå®šä¹‰çš„ View ä¸­ç»˜åˆ¶å’Œæ¸²æŸ“ç”±ç›´çº¿å’Œæ›²çº¿ç»„æˆçš„è·¯å¾„.ã€‚ä½ å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥ä¸ºä½ çš„UIBezierPathæŒ‡å®šä¸€ä¸ªå‡ ä½•å›¾å½¢ã€‚<br>é€šä¿—ç‚¹å°±æ˜¯UIBezierPathç”¨æ¥æŒ‡å®šç»˜åˆ¶å›¾å½¢è·¯å¾„ï¼Œè€ŒCAShapeLayerå°±æ˜¯æ ¹æ®è·¯å¾„æ¥ç»˜å›¾çš„ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>1ã€@property(nullable) CGPathRef path;  å‘ˆç°çš„å½¢çŠ¶çš„è·¯å¾„</p></li><li><p>2ã€@property(nullable) CGColorRef fillColor;å¡«å……è·¯å¾„çš„é¢œè‰²  </p></li><li><p>3ã€@property(copy) CAShapeLayerFillRule fillRule;   å½“åœ¨å¡«å……é¢œè‰²çš„æ—¶å€™åˆ™å°±éœ€è¦è¿™ç§å¡«å……è§„åˆ™ï¼Œå€¼æœ‰ä¸¤ç§ï¼Œéé›¶å’Œå¥‡å¶æ•°ï¼Œä½†é»˜è®¤æ˜¯éé›¶å€¼ã€‚</p></li><li><p>4ã€@property(nullable) CGColorRef strokeColor;è®¾ç½®æè¾¹è‰²ï¼Œé»˜è®¤æ— è‰²ã€‚</p></li><li><p>5ã€@property CGFloat strokeStart; ç»˜åˆ¶è¾¹çº¿è½®å»“è·¯å¾„çš„å­åŒºåŸŸã€‚è¯¥å€¼å¿…é¡»åœ¨[0,1]èŒƒå›´ï¼Œ0ä»£è¡¨è·¯å¾„çš„å¼€å§‹ï¼Œ1ä»£è¡¨è·¯å¾„çš„ç»“æŸã€‚ é»˜è®¤ä¸º0</p></li><li><p>6ã€@property CGFloat strokeEnd; é»˜è®¤ä¸º1</p></li><li><p>7ã€@property CGFloat lineWidth; çº¿çš„å®½åº¦ é»˜è®¤ä¸º1</p></li><li><p>8ã€@property CGFloat miterLimit;æœ€å¤§æ–œæ¥é•¿åº¦ã€‚æ–œæ¥é•¿åº¦æŒ‡çš„æ˜¯åœ¨ä¸¤æ¡çº¿äº¤æ±‡å¤„å’Œå¤–äº¤ä¹‹é—´çš„è·ç¦»ã€‚åªæœ‰lineJoinå±æ€§ä¸ºkCALineJoinMiteræ—¶miterLimitæ‰æœ‰æ•ˆã€‚è¾¹è§’çš„è§’åº¦è¶Šå°ï¼Œæ–œæ¥é•¿åº¦å°±ä¼šè¶Šå¤§ã€‚ä¸ºäº†é¿å…æ–œæ¥é•¿åº¦è¿‡é•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨miterLimitå±æ€§ã€‚å¦‚æœæ–œæ¥é•¿åº¦è¶…è¿‡miterLimitçš„å€¼ï¼Œè¾¹è§’ä¼šä»¥lineJoinçš„â€œbevelâ€å³kCALineJoinBevelç±»å‹æ¥æ˜¾ç¤ºã€‚</p></li><li><p>9ã€@property(copy) CAShapeLayerLineCap lineCap; çº¿ç«¯ç‚¹ç±»å‹ï¼Œå€¼æœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineCapButt ã€kCALineCapRound ã€kCALineCapSquareï¼Œé»˜è®¤å€¼ä¸ºButtï¼›</p></li><li><p>10ã€@property(copy) CAShapeLayerLineJoin lineJoin;lineJoinä¸ºçº¿è¿æ¥ç±»å‹ï¼Œå…¶å€¼ä¹Ÿæœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineJoinMiterã€kCALineJoinRoundã€kCALineJoinBevelï¼Œé»˜è®¤å€¼æ˜¯Miterã€‚</p></li><li><p>11ã€@property CGFloat lineDashPhase;ä¸ºçº¿å‹æ¨¡ç‰ˆçš„èµ·å§‹ä½ç½®ï¼›lineDashPatternä¸ºçº¿æ€§æ¨¡ç‰ˆï¼Œè¿™æ˜¯ä¸€ä¸ªNSNumberçš„æ•°ç»„ï¼Œç´¢å¼•ä»1å¼€å§‹è®°ï¼Œå¥‡æ•°ä½æ•°å€¼è¡¨ç¤ºå®çº¿é•¿åº¦ï¼Œå¶æ•°ä½æ•°å€¼è¡¨ç¤ºç©ºç™½é•¿åº¦ã€‚<br>æ³¨ï¼šfillColorä¸strokeColoréƒ½æ˜¯åœ¨æœ‰UIBezierPathå‚æ•°é…ç½®çš„æƒ…å†µä¸‹æ‰èƒ½å‘ç”Ÿä½œç”¨</p></li><li><p>12ã€@property(nullable, copy) NSArray<nsnumber *=""> *lineDashPattern;</nsnumber></p></li></ul></blockquote><h3 id="2-CAReplicationLayer"><a href="#2-CAReplicationLayer" class="headerlink" title="2.CAReplicationLayer"></a>2.CAReplicationLayer</h3><h4 id="å±æ€§-1"><a href="#å±æ€§-1" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>1ã€@property NSInteger instanceCount;  å¤åˆ¶subLayerä¸ªæ•°ï¼Œé»˜è®¤ä¸º1</p></li><li><p>2ã€@property BOOL preservesDepth; æ˜¯å¦å°†3Dä¾‹å­ç³»ç»Ÿå¹³é¢åŒ–åˆ°ä¸€ä¸ªå›¾å±‚ï¼ˆé»˜è®¤å€¼ï¼‰æˆ–è€…å¯ä»¥åœ¨3Dç©ºé—´ä¸­æ··åˆå…¶ä»–çš„å›¾å±‚</p></li><li><p>3ã€@property CFTimeInterval instanceDelay; è®¾ç½®å¤åˆ¶å­å±‚çš„å»¶è¿ŸåŠ¨ç”»æ—¶é•¿</p></li><li><p>4ã€@property CATransform3D instanceTransform; è®¾ç½®å¤åˆ¶å­å±‚çš„ç›¸å¯¹ä½ç½®</p></li><li><p>5ã€@property(nullable) CGColorRef instanceColor; å­å±‚é¢œè‰²ï¼Œä¼šå’ŒåŸç”Ÿå­å±‚èƒŒæ™¯è‰²å†²çªï¼Œå› æ­¤äºŒè€…é€‰å…¶ä¸€è®¾ç½®</p></li><li><p>6ã€@property float instanceRedOffset;<br>è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„çº¢è‰²åç§»é‡</p></li><li>7ã€@property float instanceRedOffset;<br>è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„ç»¿è‰²åç§»é‡</li><li><p>8ã€@property float instanceBlueOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„è“è‰²åç§»é‡</p></li><li><p>9ã€@property float instanceAlphaOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„é€æ˜åº¦åç§»é‡</p></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§&quot;&gt;&lt;a href=&quot;#ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§&quot;&gt;&lt;/a&gt;ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CAAniamtionçš„å±æ€§å’Œä½¿ç”¨</title>
    <link href="https://wudan-ios.github.io/2018/11/23/CAAniamtion%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>https://wudan-ios.github.io/2018/11/23/CAAniamtionçš„å±æ€§å’Œä½¿ç”¨/</id>
    <published>2018-11-23T08:19:24.819Z</published>
    <updated>2018-11-23T08:19:25.852Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CAAnimation"><a href="#CAAnimation" class="headerlink" title="CAAnimation"></a>CAAnimation</h2><p>CAAnimationæ˜¯æ‰€æœ‰åŠ¨ç”»å¯¹è±¡çš„çˆ¶ç±»ï¼Œè´Ÿè´£æ§åˆ¶åŠ¨ç”»çš„æŒç»­æ—¶é—´å’Œé€Ÿåº¦ï¼Œæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œåº”è¯¥ä½¿ç”¨å®ƒå…·ä½“çš„å­ç±»ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>durationï¼šåŠ¨ç”»çš„æŒç»­æ—¶é—´</p></li><li><p>repeatCountï¼šåŠ¨ç”»çš„é‡å¤æ¬¡æ•°</p></li><li><p>repeatDurationï¼šåŠ¨ç”»çš„é‡å¤æ—¶é—´</p></li><li><p>removedOnCompletionï¼šé»˜è®¤ä¸ºYESï¼Œä»£è¡¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå°±ä»å›¾å±‚ä¸Šç§»é™¤ï¼Œå›¾å½¢ä¼šæ¢å¤åˆ°åŠ¨ç”»æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚å¦‚æœæƒ³è®©å›¾å±‚ä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ï¼Œé‚£å°±è®¾ç½®ä¸ºNOï¼Œä¸è¿‡è¿˜è¦è®¾ç½®fillModeä¸ºkCAFillModeForwards</p></li><li><p>fillModeï¼šå†³å®šå½“å‰å¯¹è±¡åœ¨éactiveæ—¶é—´æ®µçš„è¡Œä¸ºã€‚æ¯”å¦‚åŠ¨ç”»å¼€å§‹ä¹‹å‰,åŠ¨ç”»ç»“æŸä¹‹å</p></li><li><p>beginTimeï¼šå¯ä»¥ç”¨æ¥è®¾ç½®åŠ¨ç”»å»¶è¿Ÿæ‰§è¡Œæ—¶é—´ï¼Œè‹¥æƒ³å»¶è¿Ÿ2sï¼Œå°±è®¾ç½®ä¸ºCACurrentMediaTime()+2ï¼ŒCACurrentMediaTime()ä¸ºå›¾å±‚çš„å½“å‰æ—¶é—´</p></li><li><p>timingFunctionï¼šé€Ÿåº¦æ§åˆ¶å‡½æ•°ï¼Œæ§åˆ¶åŠ¨ç”»è¿è¡Œçš„èŠ‚å¥</p></li><li><p>delegateï¼šåŠ¨ç”»ä»£ç†</p></li></ul></blockquote><h2 id="å­ç±»"><a href="#å­ç±»" class="headerlink" title="å­ç±»"></a>å­ç±»</h2><h3 id="1-CAPropertyAnimation"><a href="#1-CAPropertyAnimation" class="headerlink" title="1.CAPropertyAnimation"></a>1.CAPropertyAnimation</h3><p>æ˜¯CAAnimationçš„å­ç±»ï¼Œä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¦æƒ³åˆ›å»ºåŠ¨ç”»å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨å®ƒçš„ä¸¤ä¸ªå­ç±»ï¼šCABasicAnimationå’ŒCAKeyframeAnimationã€‚</p><blockquote><ul><li>keyPath é€šè¿‡æŒ‡å®šCALayerçš„ä¸€ä¸ªå±æ€§åç§°ä¸ºkeyPath(NSStringç±»å‹)ï¼Œå¹¶ä¸”å¯¹CALayerçš„è¿™ä¸ªå±æ€§çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè¾¾åˆ°ç›¸åº”çš„åŠ¨ç”»æ•ˆæœã€‚æ¯”å¦‚ï¼ŒæŒ‡å®š@â€positionâ€ä¸ºkeyPathï¼Œå°±ä¿®æ”¹CALayerçš„positionå±æ€§çš„å€¼ï¼Œä»¥è¾¾åˆ°å¹³ç§»çš„åŠ¨ç”»æ•ˆæœã€‚</li></ul></blockquote><h3 id="2-CABasicAnimation"><a href="#2-CABasicAnimation" class="headerlink" title="2.CABasicAnimation"></a>2.CABasicAnimation</h3><blockquote><ul><li><p>fromValueï¼škeyPathç›¸åº”å±æ€§çš„åˆå§‹å€¼ã€‚</p></li><li><p>toValueï¼škeyPathç›¸åº”å±æ€§çš„ç»“æŸå€¼ã€‚</p></li><li><p>éšç€åŠ¨ç”»çš„è¿›è¡Œï¼Œåœ¨é•¿åº¦ä¸ºdurationçš„æŒç»­æ—¶é—´å†…ï¼ŒkeyPathç›¸åº”å±æ€§çš„å€¼ä»fromValueæ¸æ¸åœ°å˜ä¸ºtoValueã€‚</p></li><li>å¦‚æœfillMode=kCAFillModeForwardså’ŒremovedOnComletion=NOï¼Œé‚£ä¹ˆåœ¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾å±‚ä¼šä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ã€‚ä½†åœ¨å®è´¨ä¸Šï¼Œå›¾å±‚çš„å±æ€§å€¼è¿˜æ˜¯åŠ¨ç”»æ‰§è¡Œå‰çš„åˆå§‹å€¼ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è¢«æ”¹å˜ã€‚æ¯”å¦‚ï¼ŒCALayerçš„positionåˆå§‹å€¼ä¸º(0,0)ï¼ŒCABasicAnimationçš„fromValueä¸º(10,10)ï¼ŒtoValueä¸º(100,100)ï¼Œè™½ç„¶åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå›¾å±‚ä¿æŒåœ¨(100,100)è¿™ä¸ªä½ç½®ï¼Œå®è´¨ä¸Šå›¾å±‚çš„positionè¿˜æ˜¯ä¸º(0,0)ã€‚</li></ul></blockquote><h3 id="3-CAKeyframeAnimation"><a href="#3-CAKeyframeAnimation" class="headerlink" title="3.CAKeyframeAnimation"></a>3.CAKeyframeAnimation</h3><p>CApropertyAnimationçš„å­ç±»ï¼Œè·ŸCABasicAnimationçš„åŒºåˆ«æ˜¯ï¼šCABasicAnimationåªèƒ½ä»ä¸€ä¸ªæ•°å€¼(fromValue)å˜åˆ°å¦ä¸€ä¸ªæ•°å€¼(toValue)ï¼Œè€ŒCAKeyframeAnimationä¼šä½¿ç”¨ä¸€ä¸ªNSArrayä¿å­˜è¿™äº›æ•°å€¼ã€‚</p><blockquote><ul><li><p>valuesï¼šå°±æ˜¯ä¸Šè¿°çš„NSArrayå¯¹è±¡ã€‚é‡Œé¢çš„å…ƒç´ ç§°ä¸ºâ€å…³é”®å¸§â€(keyframe)ã€‚åŠ¨ç”»å¯¹è±¡ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´(duration)å†…ï¼Œä¾æ¬¡æ˜¾ç¤ºvaluesæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…³é”®å¸§ã€‚</p></li><li><p>pathï¼šå¯ä»¥è®¾ç½®ä¸€ä¸ªCGPathRef\CGMutablePathRef,è®©å±‚è·Ÿç€è·¯å¾„ç§»åŠ¨ã€‚pathåªå¯¹CALayerçš„anchorPointå’Œpositionèµ·ä½œç”¨ã€‚å¦‚æœä½ è®¾ç½®äº†pathï¼Œé‚£ä¹ˆvalueså°†è¢«å¿½ç•¥ã€‚</p></li><li><p>keyTimesï¼šå¯ä»¥ä¸ºå¯¹åº”çš„å…³é”®å¸§æŒ‡å®šå¯¹åº”çš„æ—¶é—´ç‚¹,å…¶å–å€¼èŒƒå›´ä¸º0åˆ°1.0,keyTimesä¸­çš„æ¯ä¸€ä¸ªæ—¶é—´å€¼éƒ½å¯¹åº”valuesä¸­çš„æ¯ä¸€å¸§.å½“keyTimesæ²¡æœ‰è®¾ç½®çš„æ—¶å€™,å„ä¸ªå…³é”®å¸§çš„æ—¶é—´æ˜¯å¹³åˆ†çš„ã€‚</p></li><li><p>CABasicAnimationå¯çœ‹åšæ˜¯æœ€å¤šåªæœ‰2ä¸ªå…³é”®å¸§çš„CAKeyframeAnimationã€‚</p></li></ul></blockquote><h3 id="4-CAAnimationGroup"><a href="#4-CAAnimationGroup" class="headerlink" title="4.CAAnimationGroup"></a>4.CAAnimationGroup</h3><p>CAAnimationçš„å­ç±»ï¼Œå¯ä»¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡ï¼Œå°†CAAnimationGroupå¯¹è±¡åŠ å…¥å±‚åï¼Œç»„ä¸­æ‰€æœ‰åŠ¨ç”»å¯¹è±¡å¯ä»¥åŒæ—¶å¹¶å‘è¿è¡Œã€‚</p><blockquote><ul><li><p>animationsï¼šç”¨æ¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡çš„NSArrayã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ç»„åŠ¨ç”»å¯¹è±¡æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®åŠ¨ç”»å¯¹è±¡çš„beginTimeå±æ€§æ¥æ›´æ”¹åŠ¨ç”»çš„å¼€å§‹æ—¶é—´ã€‚</p></li></ul></blockquote><h3 id="5-CATransition"><a href="#5-CATransition" class="headerlink" title="5.CATransition"></a>5.CATransition</h3><p>CAAnimationçš„å­ç±»ï¼Œç”¨äºåšè½¬åœºåŠ¨ç”»ï¼Œèƒ½å¤Ÿä¸ºå±‚æä¾›ç§»å‡ºå±å¹•å’Œç§»å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚iOSæ¯”Mac OS Xçš„è½¬åœºåŠ¨ç”»æ•ˆæœå°‘ä¸€ç‚¹ã€‚UINavigationControllerå°±æ˜¯é€šè¿‡CATransitionå®ç°äº†å°†æ§åˆ¶å™¨çš„è§†å›¾æ¨å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚</p><blockquote><ul><li><p>typeï¼šåŠ¨ç”»è¿‡æ¸¡ç±»å‹ã€‚</p></li><li><p>subtypeï¼šåŠ¨ç”»è¿‡æ¸¡æ–¹å‘ã€‚</p></li><li><p>startProgressï¼šåŠ¨ç”»èµ·ç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚</p></li><li><p>endProgressï¼šåŠ¨ç”»ç»ˆç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚</p></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;CAAnimation&quot;&gt;&lt;a href=&quot;#CAAnimation&quot; class=&quot;headerlink&quot; title=&quot;CAAnimation&quot;&gt;&lt;/a&gt;CAAnimation&lt;/h2&gt;&lt;p&gt;CAAnimationæ˜¯æ‰€æœ‰åŠ¨ç”»å¯¹è±¡çš„çˆ¶ç±»ï¼Œè´Ÿè´£æ§åˆ¶åŠ¨ç”»çš„æŒç»­æ—¶é—´å’Œ
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶ï¼šæé†’æ¡</title>
    <link href="https://wudan-ios.github.io/2018/11/22/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%EF%BC%9A%E6%8F%90%E9%86%92%E6%9D%A1/"/>
    <id>https://wudan-ios.github.io/2018/11/22/iOSè‡ªå®šä¹‰æ§ä»¶ï¼šæé†’æ¡/</id>
    <published>2018-11-22T05:58:04.423Z</published>
    <updated>2018-11-22T05:58:04.619Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-ccc89345e72081d5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><p>ç®€å•çš„æé†’æ¡ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨å®¹æ˜“ï¼Œä»£ç ä¸­ç›®å‰æä¾›äº†ä¸‰ç§æ˜¾ç¤ºçš„é¢œè‰²ï¼Œé»˜è®¤æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ä¸ºä¸€è¡Œæ–‡å­—ï¼Œé»˜è®¤é«˜åº¦ä¸º20ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚è‡ªå®šä¹‰æ ·å¼ã€‚ä»£ç åŒæ—¶æ”¯æŒObjective-Cå’ŒSwiftï¼Œä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç‚¹å·®åˆ«ï¼Œè¯¦æƒ…çœ‹ä»£ç ã€‚</p><h4 id="æ¥å£æ–‡ä»¶"><a href="#æ¥å£æ–‡ä»¶" class="headerlink" title="æ¥å£æ–‡ä»¶"></a>æ¥å£æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, RemindBarStyle) &#123;</span><br><span class="line">    RemindBarStyleInfo, // æé†’ â‡ï¸</span><br><span class="line">    RemindBarStyleWarn, // è­¦å‘Š âš ï¸</span><br><span class="line">    RemindBarStyleError // é”™è¯¯ âŒ</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, RemindBarPosition) &#123;</span><br><span class="line">    RemindBarPositionStatusBar,     // çŠ¶æ€æ ä¸‹é¢</span><br><span class="line">    RemindBarPositionNavigationBar, // å¯¼èˆªæ ä¸‹é¢</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface LZRemindBar : UIView</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> é…ç½®æ˜¾ç¤ºæ ·å¼</span><br><span class="line"></span><br><span class="line"> @param style æ ·å¼</span><br><span class="line"> @param position ä½ç½®</span><br><span class="line"> @param text å†…å®¹</span><br><span class="line"> @return return value description</span><br><span class="line"> */</span><br><span class="line">+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(NSString *)text;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ˜¾ç¤º å¹¶è®¾ç½®æ˜¾ç¤ºæ—¶é—´</span><br><span class="line"></span><br><span class="line"> @param interval æ˜¾ç¤ºæ—¶é—´</span><br><span class="line"> */</span><br><span class="line">- (void)showBarAfterTimeInterval:(NSTimeInterval)interval;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h4 id="å®ç°æ–‡ä»¶"><a href="#å®ç°æ–‡ä»¶" class="headerlink" title="å®ç°æ–‡ä»¶"></a>å®ç°æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZRemindBar.h&quot;</span><br><span class="line"></span><br><span class="line">#define bar_IsPhoneX  UIApplication.sharedApplication.statusBarFrame.size.height != 20</span><br><span class="line">#define bar_topInterval  bar_IsPhoneX ? UIApplication.sharedApplication.statusBarFrame.size.height : 0</span><br><span class="line"></span><br><span class="line">@interface LZRemindBar ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) UILabel           *contentLabel; //*! æ–‡å­—Label</span><br><span class="line">@property (nonatomic, assign) RemindBarPosition position;      //*! æ˜¾ç¤ºä½ç½®</span><br><span class="line">@property (nonatomic, assign) BOOL              isShowing;     //*! æ˜¯å¦æ­£åœ¨æ˜¾ç¤º</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZRemindBar</span><br><span class="line"></span><br><span class="line">+ (instancetype)remind &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static LZRemindBar *remind;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        remind = [[LZRemindBar alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return remind;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(NSString *)text &#123;</span><br><span class="line">    </span><br><span class="line">    if ([LZRemindBar remind].isShowing) &#123;</span><br><span class="line">        return [LZRemindBar remind];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [LZRemindBar remind].contentLabel = (&#123;</span><br><span class="line">        UILabel *label = [[UILabel alloc] init];</span><br><span class="line">        label.backgroundColor = UIColor.clearColor;</span><br><span class="line">        label.numberOfLines = 1;</span><br><span class="line">        label.textAlignment = NSTextAlignmentCenter;</span><br><span class="line">        label.font = [UIFont systemFontOfSize:13];</span><br><span class="line">        label.textColor = UIColor.whiteColor;</span><br><span class="line">        [[LZRemindBar remind] addSubview:label];</span><br><span class="line">        label.translatesAutoresizingMaskIntoConstraints = false;</span><br><span class="line">        [[label.leadingAnchor constraintEqualToAnchor:[LZRemindBar remind].leadingAnchor] setActive:true];</span><br><span class="line">        [[label.trailingAnchor constraintEqualToAnchor:[LZRemindBar remind].trailingAnchor] setActive:true];</span><br><span class="line">        [[label.topAnchor constraintEqualToAnchor:[LZRemindBar remind].topAnchor] setActive:true];</span><br><span class="line">        [[label.bottomAnchor constraintEqualToAnchor:[LZRemindBar remind].bottomAnchor] setActive:true];</span><br><span class="line">        label.text = text;</span><br><span class="line">        label;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    [LZRemindBar remind].isShowing = true;</span><br><span class="line">    [LZRemindBar remind].position  = position;</span><br><span class="line">    </span><br><span class="line">    switch (style) &#123;</span><br><span class="line">        case RemindBarStyleInfo:</span><br><span class="line">            [LZRemindBar remind].backgroundColor = [UIColor colorWithRed:0 green:166.0/255 blue:124.0/255 alpha:1];</span><br><span class="line">            break;</span><br><span class="line">        case RemindBarStyleWarn:</span><br><span class="line">            [LZRemindBar remind].backgroundColor = UIColor.orangeColor;</span><br><span class="line">            break;</span><br><span class="line">        case RemindBarStyleError:</span><br><span class="line">            [LZRemindBar remind].backgroundColor = UIColor.redColor;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (position == RemindBarPositionStatusBar) &#123;</span><br><span class="line">        [[LZRemindBar remind] setupShowStatusBarBottomWithStutus:true];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [[LZRemindBar remind] setupShowNavigationBarBottomWithStutus:true];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return [LZRemindBar remind];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupShowStatusBarBottomWithStutus:(BOOL)show &#123;</span><br><span class="line">    if (show) &#123;</span><br><span class="line">        UIApplication.sharedApplication.delegate.window.windowLevel = bar_IsPhoneX ? UIWindowLevelNormal : UIWindowLevelAlert;</span><br><span class="line">        self.frame = CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame = CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 20);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame = CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">            UIApplication.sharedApplication.delegate.window.windowLevel = UIWindowLevelNormal;</span><br><span class="line">            [self dismissBar];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupShowNavigationBarBottomWithStutus:(BOOL)show &#123;</span><br><span class="line">    if (show) &#123;</span><br><span class="line">        self.frame = CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame = CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 20);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame = CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">            [self dismissBar];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)showBarAfterTimeInterval:(NSTimeInterval)interval &#123;</span><br><span class="line">    [UIApplication.sharedApplication.delegate.window addSubview:self];</span><br><span class="line">    </span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(interval * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        if (self.position == RemindBarPositionStatusBar) &#123;</span><br><span class="line">            [self setupShowStatusBarBottomWithStutus:false];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            [self setupShowNavigationBarBottomWithStutus:false];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dismissBar &#123;</span><br><span class="line">    self.isShowing = false;</span><br><span class="line">    [self.contentLabel removeFromSuperview];</span><br><span class="line">    [self removeFromSuperview];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//  å‚æ•°RemindBarStyleï¼š æ˜¾ç¤ºæ ·å¼</span><br><span class="line">//  å‚æ•°RemindBarPosition: æ˜¾ç¤ºä½ç½® </span><br><span class="line">//  å‚æ•°contentText: æ˜¾ç¤ºæ–‡å­—å†…å®¹ </span><br><span class="line">//  intervalï¼šæ˜¾ç¤ºæ—¶é—´</span><br><span class="line"></span><br><span class="line">// Objc</span><br><span class="line">[[LZRemindBar configurationWithStyle:RemindBarStyleInfo showPosition:RemindBarPositionStatusBar contentText:@&quot;è¿™æ˜¯ä¸€ä¸ªæç¤º&quot;] showBarAfterTimeInterval:1.2];</span><br><span class="line">// Swift</span><br><span class="line">LZRemindBar.configuration(with: .info, show: .statusBar, contentText: &quot;æç¤ºæ–‡å­—&quot;).show(afterTimeInterval: 1.2)</span><br></pre></td></tr></table></figure><h4 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-0b94020c5e06325c.gif?imageMogr2/auto-orient/strip" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-ccc89345e72081d5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶ï¼šè‡ªå®šä¹‰Alterå¼¹çª—</title>
    <link href="https://wudan-ios.github.io/2018/11/21/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89Alter%E5%BC%B9%E7%AA%97/"/>
    <id>https://wudan-ios.github.io/2018/11/21/iOSè‡ªå®šä¹‰æ§ä»¶ï¼šè‡ªå®šä¹‰Alterå¼¹çª—/</id>
    <published>2018-11-21T08:19:48.223Z</published>
    <updated>2018-11-21T08:19:49.002Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-b779b2b4e3c10261.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼å›¾"><br>åœ¨ä¸‹å°ç™½ä¸€ä¸ªï¼Œå‡†å¤‡å†™å†™å’Œè‡ªå·±å¼€å‘æ¯æ¯ç›¸å…³çš„æ§ä»¶ï¼Œå¸Œæœ›å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªå¸¸ç”¨çš„åº•éƒ¨å¼¹çª—ï¼Œä½¿ç”¨äº†æœ€ç®€å•çš„åˆ†è£…æ–¹å¼ã€‚</p><h3 id="1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚"><a href="#1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚" class="headerlink" title="1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚"></a>1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@class LZAlterView;</span><br><span class="line"></span><br><span class="line">@protocol LZAlterViewDelegate &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">- (void)alterView:(LZAlterView *)alterView didSelectedAtIndex:(NSInteger)index;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface LZAlterView : UIView</span><br><span class="line"></span><br><span class="line">+ (instancetype)alter;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ˜¾ç¤ºæ ·å¼ä¸€</span><br><span class="line"></span><br><span class="line"> @param mainTitle ä¸»æ ‡é¢˜</span><br><span class="line"> @param subTitle å‰¯æ ‡é¢˜</span><br><span class="line"> @param actionTitleArray äº‹ä»¶æŒ‰é’®æ•°ç»„</span><br><span class="line"> @param cancelTitle å–æ¶ˆæŒ‰é’®</span><br><span class="line"> @return return value description</span><br><span class="line"> */</span><br><span class="line">- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ˜¾ç¤ºæ ·å¼äºŒ</span><br><span class="line"></span><br><span class="line"> @param mainTitle ä¸»æ ‡é¢˜</span><br><span class="line"> @param subTitle å‰¯æ ‡é¢˜</span><br><span class="line"> @param actionTitleArray äº‹ä»¶æŒ‰é’®ç»„æ•°</span><br><span class="line"> @return return value description</span><br><span class="line"> */</span><br><span class="line">- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ˜¾ç¤ºæ ·å¼ä¸‰</span><br><span class="line"></span><br><span class="line"> @param actionTitleArray äº‹ä»¶æŒ‰é’®æ•°ç»„</span><br><span class="line"> @param cancelTitle å–æ¶ˆæŒ‰é’®</span><br><span class="line"> @return return value description</span><br><span class="line"> */</span><br><span class="line">- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ˜¾ç¤ºæ ·å¼å››</span><br><span class="line"></span><br><span class="line"> @param actionTitleArray äº‹ä»¶æŒ‰é’®æ•°ç»„</span><br><span class="line"> @return return value description</span><br><span class="line"> */</span><br><span class="line">- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> è®¾ç½®ä»£ç†</span><br><span class="line"></span><br><span class="line"> @param delegate ä»£ç†</span><br><span class="line"> @return return value description</span><br><span class="line"> */</span><br><span class="line">- (LZAlterView *)setupDelegate:(id&lt;LZAlterViewDelegate&gt;)delegate;</span><br><span class="line"></span><br><span class="line">- (void)showAlter;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h3 id="2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚"><a href="#2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚" class="headerlink" title="2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚"></a>2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZAlterView.h&quot;</span><br><span class="line"></span><br><span class="line">#define alter_ScreenWidth       UIScreen.mainScreen.bounds.size.width</span><br><span class="line">#define alter_ScreenHeight      UIScreen.mainScreen.bounds.size.height</span><br><span class="line"></span><br><span class="line">#define alter_actionHeight      45 * alter_ScreenWidth/375.0</span><br><span class="line">#define alter_cancelSpece       5 * alter_ScreenWidth/375.0</span><br><span class="line">#define alter_mainTitleHeight   alter_actionHeight + alter_cancelSpece</span><br><span class="line">#define alter_FontSize(s)       [UIFont systemFontOfSize:s * alter_ScreenWidth/375.0]</span><br><span class="line"></span><br><span class="line">@interface LZAlterView ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic) CGRect                         conterViewRect;</span><br><span class="line">@property (nonatomic, strong) UIView                *contanerView;</span><br><span class="line">@property (nonatomic, weak) id &lt;LZAlterViewDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZAlterView</span><br><span class="line"></span><br><span class="line">+ (instancetype)alter &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static LZAlterView *alter;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        alter = [[LZAlterView alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return alter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapGestureRecognizer:)];</span><br><span class="line">        [self addGestureRecognizer:tap];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Configuration method</span><br><span class="line">/** ä»£ç†  */</span><br><span class="line">- (LZAlterView *)setupDelegate:(id&lt;LZAlterViewDelegate&gt;)delegate &#123;</span><br><span class="line">    self.delegate = delegate;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Set title, subtitle, events and cancel */</span><br><span class="line">- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle &#123;</span><br><span class="line">    CGFloat width           = alter_actionHeight * (actionTitleArray.count + 1) + alter_cancelSpece + alter_mainTitleHeight;</span><br><span class="line">    self.contanerView.frame = CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width);</span><br><span class="line">    [self addSubview:self.contanerView];</span><br><span class="line"></span><br><span class="line">    UILabel *titleLabel     = [self setupMainTitle:mainTitle subTitle:subTitle];</span><br><span class="line">    titleLabel.frame        = CGRectMake(0, 0, alter_ScreenWidth, alter_mainTitleHeight);</span><br><span class="line">    [self.contanerView addSubview:titleLabel];</span><br><span class="line"></span><br><span class="line">    UIButton *cancelButton  = [self cancelButtonWithTitle:cancelTitle];</span><br><span class="line">    cancelButton.frame      = CGRectMake(0, self.contanerView.frame.size.height - alter_actionHeight, alter_ScreenWidth, alter_actionHeight);</span><br><span class="line">    [self.contanerView addSubview:cancelButton];</span><br><span class="line">    </span><br><span class="line">    for (NSString *name in actionTitleArray) &#123;</span><br><span class="line">        UIButton *button = [self setupActionWithTitle:name];</span><br><span class="line">        NSInteger index  = [actionTitleArray indexOfObject:name];</span><br><span class="line">        button.tag       = 1000 + index;</span><br><span class="line">        button.frame     = CGRectMake(0, titleLabel.frame.size.height + 0.5 + alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight - 0.5);</span><br><span class="line">        [self.contanerView addSubview:button];</span><br><span class="line">    &#125;</span><br><span class="line">    self.conterViewRect = self.contanerView.frame;</span><br><span class="line">    </span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Set title, subtitle and events */</span><br><span class="line">- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray &#123;</span><br><span class="line">    CGFloat width           = alter_actionHeight * actionTitleArray.count + alter_mainTitleHeight;</span><br><span class="line">    self.contanerView.frame = CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width);</span><br><span class="line">    [self addSubview:self.contanerView];</span><br><span class="line"></span><br><span class="line">    UILabel *titleLabel     = [self setupMainTitle:mainTitle subTitle:subTitle];</span><br><span class="line">    titleLabel.frame        = CGRectMake(0, 0, alter_ScreenWidth, alter_mainTitleHeight);</span><br><span class="line">    [self.contanerView addSubview:titleLabel];</span><br><span class="line">    </span><br><span class="line">    for (NSString *name in actionTitleArray) &#123;</span><br><span class="line">        UIButton *button = [self setupActionWithTitle:name];</span><br><span class="line">        NSInteger index  = [actionTitleArray indexOfObject:name];</span><br><span class="line">        button.tag       = 1000 + index;</span><br><span class="line">        button.frame     = CGRectMake(0, titleLabel.frame.size.height + 0.5 + alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight - 0.5);</span><br><span class="line">        [self.contanerView addSubview:button];</span><br><span class="line">    &#125;</span><br><span class="line">    self.conterViewRect = self.contanerView.frame;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Set events and cancel */</span><br><span class="line">- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle &#123;</span><br><span class="line">    CGFloat width           = alter_actionHeight * (actionTitleArray.count + 1) + alter_cancelSpece;</span><br><span class="line">    self.contanerView.frame = CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width);</span><br><span class="line">    [self addSubview:self.contanerView];</span><br><span class="line">    </span><br><span class="line">    UIButton *cancelButton  = [self cancelButtonWithTitle:cancelTitle];</span><br><span class="line">    cancelButton.frame      = CGRectMake(0, self.contanerView.frame.size.height - alter_actionHeight, alter_ScreenWidth, alter_actionHeight);</span><br><span class="line">    [self.contanerView addSubview:cancelButton];</span><br><span class="line">    </span><br><span class="line">    for (NSString *name in actionTitleArray) &#123;</span><br><span class="line">        UIButton *button = [self setupActionWithTitle:name];</span><br><span class="line">        NSInteger index  = [actionTitleArray indexOfObject:name];</span><br><span class="line">        button.tag       = 1000 + index;</span><br><span class="line">        button.frame     = CGRectMake(0, alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight-0.5);</span><br><span class="line">        [self.contanerView addSubview:button];</span><br><span class="line">    &#125;</span><br><span class="line">    self.conterViewRect = self.contanerView.frame;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Set events */</span><br><span class="line">- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray &#123;</span><br><span class="line">    CGFloat width           = alter_actionHeight * actionTitleArray.count;</span><br><span class="line">    self.contanerView.frame = CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width);</span><br><span class="line">    [self addSubview:self.contanerView];</span><br><span class="line"></span><br><span class="line">    for (NSString *name in actionTitleArray) &#123;</span><br><span class="line">        UIButton *button = [self setupActionWithTitle:name];</span><br><span class="line">        NSInteger index  = [actionTitleArray indexOfObject:name];</span><br><span class="line">        button.tag       = 1000 + index;</span><br><span class="line">        button.frame     = CGRectMake(0, alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight-0.5);</span><br><span class="line">        [self.contanerView addSubview:button];</span><br><span class="line">    &#125;</span><br><span class="line">    self.conterViewRect = self.contanerView.frame;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Event button style */</span><br><span class="line">- (UIButton *)setupActionWithTitle:(NSString *)title &#123;</span><br><span class="line">    UIButton *button       = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">    [button setTitle:title forState:UIControlStateNormal];</span><br><span class="line">    [button setTitleColor:UIColor.blackColor forState:UIControlStateNormal];</span><br><span class="line">    button.backgroundColor = [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:1];</span><br><span class="line">    button.titleLabel.font = alter_FontSize(15);</span><br><span class="line">    [button addTarget:self action:@selector(buttonTouched:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    return button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Cancel button style */</span><br><span class="line">- (UIButton *)cancelButtonWithTitle:(NSString *)title &#123;</span><br><span class="line">    UIButton *button       = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">    [button setTitle:title forState:UIControlStateNormal];</span><br><span class="line">    [button setTitleColor:[UIColor colorWithRed:0.9 green:0 blue:0 alpha:1] forState:UIControlStateNormal];</span><br><span class="line">    button.backgroundColor = [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:1];</span><br><span class="line">    button.titleLabel.font = alter_FontSize(15);</span><br><span class="line">    [button addTarget:self action:@selector(hidenAlter) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line"></span><br><span class="line">    return button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Title style */</span><br><span class="line">- (UILabel *)setupMainTitle:(NSString *)title subTitle:(NSString *)subTitle &#123;</span><br><span class="line">    NSString *titleString;</span><br><span class="line">    </span><br><span class="line">    if (subTitle.length == 0) &#123;</span><br><span class="line">        titleString = [NSString stringWithFormat:@&quot;%@&quot;,title];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        titleString = [NSString stringWithFormat:@&quot;%@\n%@&quot;,title,subTitle];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    UILabel *label                         = [[UILabel alloc] init];</span><br><span class="line">    label.backgroundColor                  = [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:1];</span><br><span class="line">    label.textColor                        = UIColor.blackColor;</span><br><span class="line">    label.font                             = alter_FontSize(15);</span><br><span class="line">    NSMutableAttributedString *muAttribute = [[NSMutableAttributedString alloc] initWithString:titleString];</span><br><span class="line"></span><br><span class="line">    [muAttribute addAttribute:NSFontAttributeName value:alter_FontSize(12) range:NSMakeRange(titleString.length - subTitle.length, subTitle.length)];</span><br><span class="line">    [muAttribute addAttribute:NSForegroundColorAttributeName value:UIColor.grayColor range:NSMakeRange(titleString.length - subTitle.length, subTitle.length)];</span><br><span class="line"></span><br><span class="line">    label.textAlignment                    = NSTextAlignmentCenter;</span><br><span class="line">    label.numberOfLines                    = 2;</span><br><span class="line">    label.attributedText                   = muAttribute;</span><br><span class="line">    return label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Button click events and delegate</span><br><span class="line"></span><br><span class="line">- (void)buttonTouched:(UIButton *)sender &#123;</span><br><span class="line">    [self hidenAlter];</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(alterView:didSelectedAtIndex:)]) &#123;</span><br><span class="line">        [self.delegate alterView:self didSelectedAtIndex:sender.tag - 1000];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** iOS 11 safeArea bottom space */</span><br><span class="line">- (CGFloat)safeScreenHeight &#123;</span><br><span class="line">    CGFloat safeAreaInsetsBottom = 0;</span><br><span class="line">    if (@available(iOS 11.0, *)) &#123;</span><br><span class="line">        safeAreaInsetsBottom = UIApplication.sharedApplication.delegate.window.safeAreaInsets.bottom;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        safeAreaInsetsBottom = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    return alter_ScreenHeight - safeAreaInsetsBottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Show alter And hiden alter</span><br><span class="line">/** Show alter from bottom */</span><br><span class="line">- (void)showAlter &#123;</span><br><span class="line">    [UIApplication.sharedApplication.delegate.window addSubview:self];</span><br><span class="line">    self.backgroundColor = [UIColor colorWithWhite:0 alpha:0.3];</span><br><span class="line">    self.frame           = CGRectMake(0, 0, alter_ScreenWidth, alter_ScreenHeight);</span><br><span class="line">    self.alpha           = 0;</span><br><span class="line">    self.contanerView.frame = CGRectMake(0, UIScreen.mainScreen.bounds.size.height, UIScreen.mainScreen.bounds.size.height, 0);</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">        self.alpha              = 1;</span><br><span class="line">        self.contanerView.frame = self.conterViewRect;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** Hiden alter and remove subViews from superview */</span><br><span class="line">- (void)hidenAlter &#123;</span><br><span class="line">    [UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">        self.alpha              = 0;</span><br><span class="line">        self.contanerView.frame = CGRectMake(0, UIScreen.mainScreen.bounds.size.height, UIScreen.mainScreen.bounds.size.height, 0);</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        for (UIView *view in self.contanerView.subviews) &#123;</span><br><span class="line">            [view removeFromSuperview];</span><br><span class="line">        &#125;</span><br><span class="line">        [self removeFromSuperview];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Getter</span><br><span class="line"></span><br><span class="line">- (UIView *)contanerView &#123;</span><br><span class="line">    if (!_contanerView) &#123;</span><br><span class="line">        _contanerView                 = [[UIView alloc] init];</span><br><span class="line">        _contanerView.backgroundColor = [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:0.5];</span><br><span class="line">    &#125;</span><br><span class="line">    return _contanerView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - TapGestureRecognizer event</span><br><span class="line"></span><br><span class="line">- (void)tapGestureRecognizer:(id)sender &#123;</span><br><span class="line">    [self hidenAlter];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨æ–¹æ³•ï¼Œéµå¾ªLZAlterViewDelegate"><a href="#3ã€ä½¿ç”¨æ–¹æ³•ï¼Œéµå¾ªLZAlterViewDelegate" class="headerlink" title="3ã€ä½¿ç”¨æ–¹æ³•ï¼Œéµå¾ªLZAlterViewDelegate"></a>3ã€ä½¿ç”¨æ–¹æ³•ï¼Œéµå¾ªLZAlterViewDelegate</h3><h4 id="æ ·å¼ä¸€"><a href="#æ ·å¼ä¸€" class="headerlink" title="æ ·å¼ä¸€"></a>æ ·å¼ä¸€</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//  Objc</span><br><span class="line">[[[[LZAlterView alter] configureWithMainTitle:@&quot;é€‰æ‹©å›¾ç‰‡&quot;</span><br><span class="line">                                                 subTitle:@&quot;1&quot;</span><br><span class="line">                                         actionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;]</span><br><span class="line">                                        cancelActionTitle:@&quot;å–æ¶ˆ&quot;] setupDelegate:self] showAlter];</span><br><span class="line">//  Swift</span><br><span class="line">LZAlterView.alter().configure(withMainTitle: &quot;é€‰æ‹©å›¾ç‰‡&quot;, subTitle: &quot;å‰¯æ ‡é¢˜&quot;, actionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;], cancelActionTitle: &quot;å–æ¶ˆ&quot;).setupDelegate(self).showAlter()</span><br></pre></td></tr></table></figure><h4 id="æ ·å¼äºŒ"><a href="#æ ·å¼äºŒ" class="headerlink" title="æ ·å¼äºŒ"></a>æ ·å¼äºŒ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//  Objc</span><br><span class="line"> [[[[LZAlterView alter] configureWithMainTitle:@&quot;é€‰æ‹©å›¾ç‰‡&quot;</span><br><span class="line">                                                 subTitle:@&quot;2&quot;</span><br><span class="line">                                         actionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;]] setupDelegate:self] showAlter];</span><br><span class="line">//  Swift</span><br><span class="line">LZAlterView.alter().configure(withMainTitle: &quot;é€‰æ‹©å›¾ç‰‡&quot;, subTitle: &quot;éœ€è¦ç”¨æˆ·æƒé™&quot;, actionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;]).setupDelegate(self).showAlter()</span><br></pre></td></tr></table></figure><h4 id="æ ·å¼ä¸‰"><a href="#æ ·å¼ä¸‰" class="headerlink" title="æ ·å¼ä¸‰"></a>æ ·å¼ä¸‰</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//  Objc</span><br><span class="line">[[[[LZAlterView alter] configureWithActionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;]</span><br><span class="line">                                               cancelActionTitle:@&quot;å–æ¶ˆ&quot;] setupDelegate:self] showAlter];</span><br><span class="line">//  Swift</span><br><span class="line">LZAlterView.alter().configure(withActionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;], cancelActionTitle: &quot;å–æ¶ˆ&quot;).setupDelegate(self).showAlter()</span><br></pre></td></tr></table></figure><h4 id="æ ·å¼å››"><a href="#æ ·å¼å››" class="headerlink" title="æ ·å¼å››"></a>æ ·å¼å››</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//  Objc</span><br><span class="line">[[[[LZAlterView alter] configureWithActionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;, @&quot;æ‹ç…§è§†é¢‘&quot;]] setupDelegate:self] showAlter];</span><br><span class="line">//  Swift</span><br><span class="line">LZAlterView.alter().configure(withActionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;]).setupDelegate(self).showAlter()</span><br></pre></td></tr></table></figure><h3 id="4ã€ä»£ç†æ–¹æ³•"><a href="#4ã€ä»£ç†æ–¹æ³•" class="headerlink" title="4ã€ä»£ç†æ–¹æ³•"></a>4ã€ä»£ç†æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// Objc</span><br><span class="line">- (void)alterView:(LZAlterView *)alterView didSelectedAtIndex:(NSInteger)index &#123;</span><br><span class="line">    NSLog(@&quot;ç‚¹å‡»ç¬¬%ldæŒ‰é’®&quot;, index);</span><br><span class="line">&#125;</span><br><span class="line">// Swift</span><br><span class="line">extension ViewController: LZAlterViewDelegate &#123;</span><br><span class="line">    func alterView(_ alterView: LZAlterView, didSelectedAt index: Int) &#123;</span><br><span class="line">        print(&quot;ç‚¹å‡»ç¬¬\(index)æŒ‰é’®&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€æ•ˆæœå›¾"><a href="#5ã€æ•ˆæœå›¾" class="headerlink" title="5ã€æ•ˆæœå›¾"></a>5ã€æ•ˆæœå›¾</h3><p><img src="https://upload-images.jianshu.io/upload_images/3334769-88dcc0223c16e44b.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾.gif"></p><p>ç»“å°¾ï¼šæœ‰é—®é¢˜å¸Œæœ›å¤§å®¶æŒ‡æ­£ï¼ğŸ˜„ğŸ˜„ğŸ˜„</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-b779b2b4e3c10261.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶ï¼šè‡ªå®šä¹‰åˆ†ç±»ä¸‹æ‹‰</title>
    <link href="https://wudan-ios.github.io/2018/11/19/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%B1%BB%E4%B8%8B%E6%8B%89/"/>
    <id>https://wudan-ios.github.io/2018/11/19/iOSè‡ªå®šä¹‰æ§ä»¶ï¼šè‡ªå®šä¹‰åˆ†ç±»ä¸‹æ‹‰/</id>
    <published>2018-11-19T11:22:39.388Z</published>
    <updated>2018-11-19T11:22:40.136Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-3e146d3a49636e88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®å„¿å§é•‡æ¥¼"></p><p>æœ€è¿‘è‡ªç”±æ—¶é—´æœ‰ç‚¹å¤šï¼Œå°±å¼€å§‹æ’¸æ§ä»¶ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªä¸‹æ‹‰åˆ†ç±»æ§ä»¶ï¼Œçœ‹äº†å¾ˆå¤šåˆ«äººå†™çš„ï¼Œéƒ½æ˜¯ç”¨TableViewæˆ–è€…CollectionViewæ•´åˆåœ¨ä¸€èµ·çš„æ„Ÿè§‰è‡ªå®šä¹‰æ€§æ²¡æœ‰é‚£ä¹ˆå¼ºï¼Œæ‰€ä»¥å°±å°è¯•ç”¨æŠŠTableViewå’ŒCollectionViewæ›¿æ¢æˆUIViewControllerã€‚å…¶ä»–åºŸè¯ä¸å¤šè¯´äº†ã€‚</p><h4 id="1ã€-æ¥å£æ–‡ä»¶"><a href="#1ã€-æ¥å£æ–‡ä»¶" class="headerlink" title="1ã€ æ¥å£æ–‡ä»¶"></a>1ã€ æ¥å£æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">UIKIT_EXTERN NSString *lzDropViewNotification;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@class LZDropView;</span><br><span class="line">@protocol LZDropViewDataSource &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">@required</span><br><span class="line"></span><br><span class="line">/** Height corresponding to controller display */</span><br><span class="line">- (NSArray&lt;NSNumber *&gt; *)setupCategoryControllerHeightInDropView:(LZDropView *)dropView;</span><br><span class="line">/** Title corresponding controller array */</span><br><span class="line">- (NSArray&lt;UIViewController *&gt; *)setupCategoryControllerInDropView:(LZDropView *)dropView;</span><br><span class="line">/** Default display of Title Array */</span><br><span class="line">- (NSArray&lt;NSString *&gt; *)setupCategoryTitleNameInDropView:(LZDropView *)dropView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol LZDropViewDelegate &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">/** Click the column and select the information. */</span><br><span class="line">- (void)dropView:(LZDropView *)dropView didSelectAtColumn:(NSInteger)column info:(NSString *)info;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface LZDropView : UIView</span><br><span class="line">/** Simple page configuration */</span><br><span class="line">@property (nonatomic, weak) id &lt;LZDropViewDataSource&gt; dataSorce;</span><br><span class="line">/** Click proxy event&lt;##&gt; */</span><br><span class="line">@property (nonatomic, weak) id &lt;LZDropViewDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h4 id="2ã€-å®ç°æ–‡ä»¶"><a href="#2ã€-å®ç°æ–‡ä»¶" class="headerlink" title="2ã€ å®ç°æ–‡ä»¶"></a>2ã€ å®ç°æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZDropView.h&quot;</span><br><span class="line"></span><br><span class="line">NSString *lzDropViewNotification = @&quot;nitification&quot;;</span><br><span class="line"></span><br><span class="line">@interface LZDropView ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSArray&lt;UIViewController *&gt; *controllerArray;</span><br><span class="line">@property (nonatomic, strong) NSArray&lt;NSString *&gt; *titleArray;</span><br><span class="line">@property (nonatomic, strong) UIButton *containerView;</span><br><span class="line">@property (nonatomic, strong) NSArray&lt;NSNumber *&gt; *controllerHeightArray;</span><br><span class="line">@property (nonatomic, strong) NSMutableArray&lt;UIButton *&gt; *buttonArray;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZDropView</span><br><span class="line"></span><br><span class="line">#pragma mark - Release memory</span><br><span class="line"></span><br><span class="line">- (void)dealloc &#123;</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Initialization</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(notificationAction:) name:lzDropViewNotification object:nil];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Draw the page</span><br><span class="line"></span><br><span class="line">- (void)setupTitleButton:(NSArray&lt;NSString *&gt; *)array &#123;</span><br><span class="line">    CGFloat width = UIScreen.mainScreen.bounds.size.width / array.count;</span><br><span class="line">    self.buttonArray = [NSMutableArray array];</span><br><span class="line">    for (NSString *name in array) &#123;</span><br><span class="line">        NSInteger index = [array indexOfObject:name];</span><br><span class="line">        UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">        button.titleLabel.font = [UIFont systemFontOfSize:15];</span><br><span class="line">        [button setTitle:[NSString stringWithFormat:@&quot;%@ â–¼&quot;, name] forState:UIControlStateNormal];</span><br><span class="line">        [button setTitle:[NSString stringWithFormat:@&quot;%@ â–²&quot;, name] forState:UIControlStateSelected];</span><br><span class="line">        [button setTitleColor:UIColor.grayColor forState:UIControlStateNormal];</span><br><span class="line">        [button setTitleColor:UIColor.orangeColor forState:UIControlStateSelected];</span><br><span class="line">        button.frame = CGRectMake(width * index, 0, width, 45);</span><br><span class="line">        button.tag = index + 1000;</span><br><span class="line">        [button addTarget:self action:@selector(buttonTouched:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">        [self addSubview:button];</span><br><span class="line">        [self.buttonArray addObject:button];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Button click event</span><br><span class="line"></span><br><span class="line">- (void)buttonTouched:(UIButton *)sender &#123;</span><br><span class="line">    if (sender.selected) &#123;</span><br><span class="line">        [self closeControllerView];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self openControllerViewWithButton:sender];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)backButtonTouched:(UIButton *)sender &#123;</span><br><span class="line">    [self closeControllerView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Notification event</span><br><span class="line"></span><br><span class="line">- (void)notificationAction:(NSNotification *)notification &#123;    </span><br><span class="line">    if (![self.controllerArray containsObject:notification.object]) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSInteger index = [self.controllerArray indexOfObject:notification.object];</span><br><span class="line">    UIButton *button = self.buttonArray[index];</span><br><span class="line">    [button setTitle:[NSString stringWithFormat:@&quot;%@ â–¼&quot;, notification.userInfo.allValues.firstObject] forState:UIControlStateNormal];</span><br><span class="line">    </span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(dropView:didSelectAtColumn:info:)]) &#123;</span><br><span class="line">        [self.delegate dropView:self didSelectAtColumn:index info:notification.userInfo.allValues.firstObject];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [self closeControllerView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Close all controllers.</span><br><span class="line"></span><br><span class="line">- (void)closeControllerView &#123;</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.8 animations:^&#123;</span><br><span class="line">        self.containerView.alpha = 0;</span><br><span class="line">        self.containerView.frame = CGRectMake(0, CGRectGetMaxY(self.frame), UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        [self.containerView removeFromSuperview];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    for (UIButton *button in self.buttonArray) &#123;</span><br><span class="line">        button.selected = false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Open the corresponding controller.</span><br><span class="line"></span><br><span class="line">- (void)openControllerViewWithButton:(UIButton *)sender &#123;</span><br><span class="line">    for (UIButton *button in self.buttonArray) &#123;</span><br><span class="line">        button.selected = false;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    self.containerView.alpha = 1;</span><br><span class="line">    </span><br><span class="line">    for (UIView *view in self.containerView.subviews) &#123;</span><br><span class="line">        [view removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    UIViewController *vc = self.controllerArray[sender.tag - 1000];</span><br><span class="line">    double vcHeight = [self.controllerHeightArray[sender.tag - 1000] doubleValue];</span><br><span class="line">    </span><br><span class="line">    self.containerView.frame = CGRectMake(0, CGRectGetMaxY(self.frame), self.frame.size.width, 0);</span><br><span class="line">    vc.view.frame = CGRectMake(0, 0, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">    [self.superview addSubview:self.containerView];</span><br><span class="line">    [self.containerView addSubview:vc.view];</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.6 animations:^&#123;</span><br><span class="line">        self.containerView.frame = CGRectMake(0, CGRectGetMaxY(self.frame), self.frame.size.width, UIScreen.mainScreen.bounds.size.height);</span><br><span class="line">        vc.view.frame = CGRectMake(0, 0, UIScreen.mainScreen.bounds.size.width, vcHeight);</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">    sender.selected = true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Getter</span><br><span class="line"></span><br><span class="line">- (UIView *)containerView &#123;</span><br><span class="line">    if (!_containerView) &#123;</span><br><span class="line">        _containerView = [[UIButton alloc] init];</span><br><span class="line">        _containerView.backgroundColor = [UIColor colorWithWhite:0 alpha:0.1];</span><br><span class="line">        [_containerView addTarget:self action:@selector(backButtonTouched:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    &#125;</span><br><span class="line">    return _containerView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Setter</span><br><span class="line"></span><br><span class="line">- (void)setDataSorce:(id&lt;LZDropViewDataSource&gt;)dataSorce &#123;</span><br><span class="line">    _dataSorce = dataSorce;</span><br><span class="line">    </span><br><span class="line">    if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryControllerInDropView:)])&#123;</span><br><span class="line">        self.controllerArray = [self.dataSorce setupCategoryControllerInDropView:self];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryTitleNameInDropView:)])&#123;</span><br><span class="line">        self.titleArray = [self.dataSorce setupCategoryTitleNameInDropView:self];</span><br><span class="line">        [self setupTitleButton:self.titleArray];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryControllerHeightInDropView:)]) &#123;</span><br><span class="line">        self.controllerHeightArray = [self.dataSorce setupCategoryControllerHeightInDropView:self];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.controllerArray.count != self.titleArray.count ||</span><br><span class="line">        self.controllerArray.count != self.controllerHeightArray.count) &#123;</span><br><span class="line">        @throw [NSException exceptionWithName:NSStringFromClass([self class]) reason:@&quot;The number of corresponding arrays is inconsistent.&quot; userInfo:nil];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><p> 1.éµå¾ªåè®®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;LZDropViewDataSource, LZDropViewDelegate&gt;</span><br></pre></td></tr></table></figure></p><p>2.åˆå§‹åŒ–<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LZDropView *view     = [[LZDropView alloc] init];</span><br><span class="line">    view.dataSorce       = self;</span><br><span class="line">    view.delegate        = self;</span><br><span class="line">    view.backgroundColor = UIColor.whiteColor;</span><br><span class="line">    view.frame           = CGRectMake(0, 100, UIScreen.mainScreen.bounds.size.width, 45);</span><br><span class="line">    [self.view addSubview:view];</span><br></pre></td></tr></table></figure></p><ol start="3"><li><p>å®ç°ä»£ç†å’Œæ•°æ®æº</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - LZDropViewDataSource</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;UIViewController *&gt; *)setupCategoryControllerInDropView:(LZDropView *)dropView &#123;</span><br><span class="line">    return @[[[TableViewController alloc] init],</span><br><span class="line">             [[TableViewController alloc] init],</span><br><span class="line">             [[TableViewController alloc] init],</span><br><span class="line">             [[TableViewController alloc] init]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;NSString *&gt; *)setupCategoryTitleNameInDropView:(LZDropView *)dropView &#123;</span><br><span class="line">    return @[@&quot;å…¨éƒ¨&quot;,</span><br><span class="line">             @&quot;é™„è¿‘&quot;,</span><br><span class="line">             @&quot;åªèƒ½æ’åº&quot;,</span><br><span class="line">             @&quot;ç­›é€‰&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;NSNumber *&gt; *)setupCategoryControllerHeightInDropView:(LZDropView *)dropView &#123;</span><br><span class="line">    return @[[NSNumber numberWithFloat:300],</span><br><span class="line">             [NSNumber numberWithFloat:400],</span><br><span class="line">             [NSNumber numberWithFloat:410],</span><br><span class="line">             [NSNumber numberWithFloat:420]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - LZDropViewDelegate</span><br><span class="line"></span><br><span class="line">- (void)dropView:(LZDropView *)dropView didSelectAtColumn:(NSInteger)column info:(NSString *)info &#123;</span><br><span class="line">    NSLog(@&quot;%ld---%@&quot;, column, info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç‚¹å‡»controllerä¸­çš„æ•°æ®æ˜¾ç¤ºåœ¨æŒ‰é’®çš„æ ‡é¢˜ä¸­ï¼Œè¿™å› ä¸ºè·¨ç•Œé¢æ˜¾ç¤ºï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰æƒ³åˆ°å¥½çš„åŠæ³•ï¼Œæ‰€ä»¥ä½¿ç”¨å¼ºå¤§çš„é€šçŸ¥ä¼ å€¼ã€‚</p></li><li>è®°å½•é€‰ä¸­çŠ¶æ€ï¼Œåº”è¯¥æ˜¯æ§åˆ¶å™¨é‡Œé¢çš„æ“ä½œï¼Œè¿™é‡Œå°±æ²¡æœ‰å®ç°<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[NSNotificationCenter defaultCenter] postNotificationName:lzDropViewNotification object:self userInfo:@&#123;@&quot;key&quot;:[NSString stringWithFormat:@&quot;ç¬¬%ldcell&quot;, indexPath.row]&#125;];</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://upload-images.jianshu.io/upload_images/3334769-9256553756983ba2.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></p><p>å¦‚æœæœ‰ä»€ä¹ˆä¸å¥½å¦‚æœå»ºè®®çš„åœ°æ–¹ï¼Œè¯·æ‰¹è¯„æŒ‡æ­£ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-3e146d3a49636e88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç³»ç»ŸSDKä»‹ç»-02</title>
    <link href="https://wudan-ios.github.io/2018/11/08/%E7%B3%BB%E7%BB%9FSDK%E5%B0%81%E8%A3%85-02/"/>
    <id>https://wudan-ios.github.io/2018/11/08/ç³»ç»ŸSDKå°è£…-02/</id>
    <published>2018-11-08T08:45:40.682Z</published>
    <updated>2018-11-08T08:58:33.323Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-4c46b61075c6b345.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ä¸š"></p><h3 id="ç³»ç»ŸSDKä»‹ç»"><a href="#ç³»ç»ŸSDKä»‹ç»" class="headerlink" title="ç³»ç»ŸSDKä»‹ç»"></a>ç³»ç»ŸSDKä»‹ç»</h3><ol><li>æ‰“å¼€ç›¸å†Œé€‰æ‹©å›¾ç‰‡</li><li>æ‰“å¼€ç›¸å†Œé€‰æ‹©è§†é¢‘</li><li>æ‰“å¼€ç›¸æœºæ‹æ‘„å›¾ç‰‡</li><li>æ‰“å¼€ç›¸æœºæ‹æ‘„è§†é¢‘</li></ol><h3 id="é…ç½®æƒé™ï¼š"><a href="#é…ç½®æƒé™ï¼š" class="headerlink" title="é…ç½®æƒé™ï¼š"></a>é…ç½®æƒé™ï¼š</h3><h5 id="åœ¨info-plistæ–‡ä»¶ä¸­æ·»åŠ éœ€è¦çš„æƒé™"><a href="#åœ¨info-plistæ–‡ä»¶ä¸­æ·»åŠ éœ€è¦çš„æƒé™" class="headerlink" title="åœ¨info.plistæ–‡ä»¶ä¸­æ·»åŠ éœ€è¦çš„æƒé™"></a>åœ¨info.plistæ–‡ä»¶ä¸­æ·»åŠ éœ€è¦çš„æƒé™</h5><blockquote><ul><li>ç›¸æœºæƒé™ï¼šPrivacy - Camera Usage Description å…è®¸æ­¤æƒé™æ‰èƒ½ä½¿ç”¨ç›¸æœºåŠŸï¼Œè¿™æ ·æ‰èƒ½å½•åˆ¶è§†é¢‘ï¼Œå¹¶ä¸”æƒ³è¦ä¿å­˜å›¾ç‰‡ã€‚</li><li>ç›¸å†Œæƒé™ï¼šPrivacy - Photo Library Usage Description å…è®¸æ­¤æƒé™æ‰èƒ½ä½¿ç”¨ç³»ç»Ÿç›¸å†Œã€‚</li><li>éº¦å…‹é£æƒé™ï¼šPrivacy - Microphone Usage Description è·å–éº¦å…‹é£æƒé™ä¸ç„¶ä¼šå´©ï¼Œåªæœ‰å…è®¸æ­¤æƒé™æ‰èƒ½å½•éŸ³ã€‚</li></ul></blockquote><h3 id="åˆ¤æ–­æ˜¯å¦æƒé™"><a href="#åˆ¤æ–­æ˜¯å¦æƒé™" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æƒé™"></a>åˆ¤æ–­æ˜¯å¦æƒé™</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - æƒé™åˆ¤æ–­</span><br><span class="line">- (BOOL)authorizationCamera &#123;</span><br><span class="line">    NSString *mediaType = AVMediaTypeVideo;</span><br><span class="line">    AVAuthorizationStatus authStatus = [AVCaptureDevice authorizationStatusForMediaType:mediaType];</span><br><span class="line">    if(authStatus == AVAuthorizationStatusRestricted || authStatus == AVAuthorizationStatusDenied)&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®é€‰é¡¹"><a href="#é…ç½®é€‰é¡¹" class="headerlink" title="é…ç½®é€‰é¡¹"></a>é…ç½®é€‰é¡¹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, LZSystemPhotoSelectorType) &#123;</span><br><span class="line">    LZSystemPhotoSelectorTypeVideo, // é€‰æ‹©è§†é¢‘</span><br><span class="line">    LZSystemPhotoSelectorTypePhoto, // é€‰æ‹©å›¾ç‰‡</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, LZSystemOpenDeviceType) &#123;</span><br><span class="line">    LZSystemOpenDeviceTypeCamera, // æ‰“å¼€ç›¸æœº</span><br><span class="line">    LZSystemOpenDeviceTypeVideo,  // æ‰“å¼€æ‘„åƒæœº</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ¥å£æ–‡ä»¶"><a href="#æ¥å£æ–‡ä»¶" class="headerlink" title="æ¥å£æ–‡ä»¶"></a>æ¥å£æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, LZSystemPhotoSelectorType) &#123;</span><br><span class="line">    LZSystemPhotoSelectorTypeVideo, // é€‰æ‹©è§†é¢‘</span><br><span class="line">    LZSystemPhotoSelectorTypePhoto, // é€‰æ‹©å›¾ç‰‡</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, LZSystemOpenDeviceType) &#123;</span><br><span class="line">    LZSystemOpenDeviceTypeCamera, // æ‰“å¼€ç›¸æœº</span><br><span class="line">    LZSystemOpenDeviceTypeVideo,  // æ‰“å¼€æ‘„åƒæœº</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface LZSystemPhotoSelector : NSObject</span><br><span class="line"></span><br><span class="line">+ (instancetype)selector;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> é€‰æ‹©å›¾ç‰‡æˆ–è§†é¢‘</span><br><span class="line"></span><br><span class="line"> @param type ç±»å‹</span><br><span class="line"> @param allowsEditing æ˜¯å¦å…è®¸ç¼–è¾‘</span><br><span class="line"> @param resultFile é€‰æ‹©ç»“æœï¼Œå›¾ç‰‡æ˜¯UIImage è§†é¢‘æ˜¯NSUrl</span><br><span class="line"> */</span><br><span class="line">- (void)lz_openAblumWithType:(LZSystemPhotoSelectorType)type allowsEditing:(BOOL)allowsEditing resultFile:(void(^)(id info))resultFile;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ‰“å¼€ç›¸æœºæˆ–æ‘„åƒæœº</span><br><span class="line"></span><br><span class="line"> @param type ç±»å‹</span><br><span class="line"> @param allowsEditing æ˜¯å¦æ‹æ‘„å®Œæˆè¿›è¡Œç¼–è¾‘</span><br><span class="line"> @param resultFile é€‰æ‹©ç»“æœï¼Œå›¾ç‰‡æ˜¯UIImage è§†é¢‘æ˜¯NSUrl</span><br><span class="line"> */</span><br><span class="line">- (void)lz_openDeviceWithType:(LZSystemOpenDeviceType)type allowsEditing:(BOOL)allowsEditing resultFile:(void(^)(id info))resultFile;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h3 id="å®ç°æ–‡ä»¶"><a href="#å®ç°æ–‡ä»¶" class="headerlink" title="å®ç°æ–‡ä»¶"></a>å®ç°æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZSystemPhotoSelector.h&quot;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &lt;AVFoundation/AVFoundation.h&gt;</span><br><span class="line">#import &lt;AssetsLibrary/AssetsLibrary.h&gt;</span><br><span class="line">#import &lt;MobileCoreServices/MobileCoreServices.h&gt;</span><br><span class="line"></span><br><span class="line">#define kRootViewController UIApplication.sharedApplication.delegate.window.rootViewController</span><br><span class="line"></span><br><span class="line">@interface LZSystemPhotoSelector () &lt;UIImagePickerControllerDelegate, UINavigationControllerDelegate&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) void (^resultFile)(id info);</span><br><span class="line">@property (nonatomic, assign) BOOL allowsEditing;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZSystemPhotoSelector</span><br><span class="line"></span><br><span class="line">+ (instancetype)selector &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static LZSystemPhotoSelector *selector;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        selector = [[LZSystemPhotoSelector alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return selector;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - é€‰æ‹©å›¾ç‰‡æˆ–è§†é¢‘</span><br><span class="line">- (void)lz_openAblumWithType:(LZSystemPhotoSelectorType)type allowsEditing:(BOOL)allowsEditing resultFile:(void(^)(id info))resultFile &#123;</span><br><span class="line">    </span><br><span class="line">    if (![UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypePhotoLibrary]) &#123;</span><br><span class="line">        resultFile(@&quot;è¯¥è®¾å¤‡æš‚æ—¶ä¸æ”¯æŒ&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    self.allowsEditing = allowsEditing;</span><br><span class="line">    self.resultFile = resultFile;</span><br><span class="line">    </span><br><span class="line">    UIImagePickerController *controller = [[UIImagePickerController alloc] init];</span><br><span class="line">    controller.delegate = self;</span><br><span class="line">    controller.sourceType = UIImagePickerControllerSourceTypePhotoLibrary;</span><br><span class="line">    if (type == LZSystemPhotoSelectorTypePhoto) &#123;</span><br><span class="line">        controller.mediaTypes = [NSArray arrayWithObjects:@&quot;public.image&quot;, nil];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        controller.mediaTypes = [NSArray arrayWithObjects:@&quot;public.movie&quot;, nil];</span><br><span class="line">    &#125;</span><br><span class="line">    controller.allowsEditing = allowsEditing;</span><br><span class="line">    [kRootViewController presentViewController:controller animated:true completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ‰“å¼€ç›¸æœºæˆ–æ‘„åƒæœº</span><br><span class="line">- (void)lz_openDeviceWithType:(LZSystemOpenDeviceType)type allowsEditing:(BOOL)allowsEditing resultFile:(void (^)(id _Nonnull))resultFile &#123;</span><br><span class="line">    </span><br><span class="line">    if (![UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera]) &#123;</span><br><span class="line">        resultFile(@&quot;è¯¥è®¾å¤‡æš‚æ—¶ä¸æ”¯æŒ&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (![self authorizationCamera]) &#123;</span><br><span class="line">        resultFile(@&quot;æš‚æ— ç›¸æœºæƒé™&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    self.allowsEditing = allowsEditing;</span><br><span class="line">    self.resultFile = resultFile;</span><br><span class="line">    </span><br><span class="line">    UIImagePickerController *controller = [[UIImagePickerController alloc] init];</span><br><span class="line">    controller.delegate = self;</span><br><span class="line">    controller.sourceType = UIImagePickerControllerSourceTypeCamera;</span><br><span class="line"></span><br><span class="line">    if (type == LZSystemOpenDeviceTypeCamera) &#123;</span><br><span class="line">        controller.mediaTypes = [NSArray arrayWithObjects:@&quot;public.image&quot;, nil];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        controller.mediaTypes = [NSArray arrayWithObjects:@&quot;public.movie&quot;, nil];</span><br><span class="line">    &#125;</span><br><span class="line">    controller.allowsEditing = allowsEditing;</span><br><span class="line">    [kRootViewController presentViewController:controller animated:true completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIImagePickerControllerDelegate</span><br><span class="line">- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary&lt;NSString *,id&gt; *)info &#123;</span><br><span class="line"></span><br><span class="line">    NSString *mediaType = [info objectForKey:UIImagePickerControllerMediaType];</span><br><span class="line"></span><br><span class="line">    if ([mediaType isEqualToString:(NSString *)kUTTypeImage]) &#123;</span><br><span class="line">        if (self.allowsEditing) &#123;</span><br><span class="line">            UIImage *editorImage = info[UIImagePickerControllerEditedImage];</span><br><span class="line">            self.resultFile(editorImage);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            UIImage *editorImage = info[UIImagePickerControllerOriginalImage];</span><br><span class="line">            self.resultFile(editorImage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        NSURL *url = info[UIImagePickerControllerMediaURL];</span><br><span class="line">        self.resultFile(url);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [picker dismissViewControllerAnimated:true completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)imagePickerControllerDidCancel:(UIImagePickerController *)picker &#123;</span><br><span class="line">    [picker dismissViewControllerAnimated:true completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æƒé™åˆ¤æ–­</span><br><span class="line">- (BOOL)authorizationCamera &#123;</span><br><span class="line">    NSString *mediaType = AVMediaTypeVideo;</span><br><span class="line">    AVAuthorizationStatus authStatus = [AVCaptureDevice authorizationStatusForMediaType:mediaType];</span><br><span class="line">    if(authStatus == AVAuthorizationStatusRestricted || authStatus == AVAuthorizationStatusDenied)&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-4c46b61075c6b345.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ç³»ç»ŸSDKä»‹ç»-01</title>
    <link href="https://wudan-ios.github.io/2018/11/08/%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8-01/"/>
    <id>https://wudan-ios.github.io/2018/11/08/ç³»ç»ŸåŸºç¡€åº”ç”¨-01/</id>
    <published>2018-11-08T00:29:33.637Z</published>
    <updated>2018-11-08T00:30:36.261Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç³»ç»ŸSDKä»‹ç»"><a href="#ç³»ç»ŸSDKä»‹ç»" class="headerlink" title="ç³»ç»ŸSDKä»‹ç»"></a>ç³»ç»ŸSDKä»‹ç»</h3><ol><li>è®¿é—®è”ç³»äººï¼Œå¹¶é€‰æ‹©ä¿¡æ¯</li><li>æ‹¨å·</li><li>å‘é€çŸ­ä¿¡</li><li>å‘é€é‚®ä»¶</li><li>æœ¬åœ°é€šçŸ¥</li></ol><h4 id="æ¥å£æ–‡ä»¶"><a href="#æ¥å£æ–‡ä»¶" class="headerlink" title="æ¥å£æ–‡ä»¶"></a>æ¥å£æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;ContactsUI/ContactsUI.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface LZSystemSDKManager : NSObject</span><br><span class="line"></span><br><span class="line">+ (instancetype)manager;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> é€‰æ‹©è”ç³»äºº  å…ˆæ·»åŠ æƒé™</span><br><span class="line"></span><br><span class="line"> @param result é€‰æ‹©çš„ä¿¡æ¯</span><br><span class="line"> */</span><br><span class="line">- (void)lz_selecteContactResulet:(void(^)(CNContact *obj))result API_AVAILABLE(ios(9.0));</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> å‘é€é‚®ä»¶</span><br><span class="line"></span><br><span class="line"> @param toRecipients æ”¶ä»¶äººç¾¤ç»„</span><br><span class="line"> @param ccRecipients æŠ„é€äººç¾¤ç»„</span><br><span class="line"> @param bccRecipients å¯†é€äººç¾¤ç»„</span><br><span class="line"> @param theme ä¸»é¢˜</span><br><span class="line"> @param emailContent æ­£æ–‡å†…å®¹</span><br><span class="line"> @param isHTML æ˜¯å¦æ˜¯HTMLæ ¼å¼</span><br><span class="line"> @param result å‘é€ç»“æœ</span><br><span class="line"> */</span><br><span class="line">- (void)lz_postEmialWithToRecipients:(NSArray&lt;NSString *&gt; *)toRecipients</span><br><span class="line">                        ccRecipients:(NSArray&lt;NSString *&gt; *)ccRecipients</span><br><span class="line">                       bccRecipients:(NSArray&lt;NSString *&gt; *)bccRecipients</span><br><span class="line">                               theme:(NSString *)theme</span><br><span class="line">                        emailContent:(NSString *)emailContent</span><br><span class="line">                              isHTML:(BOOL)isHTML</span><br><span class="line">                               reslt:(void(^)(NSInteger))result;</span><br><span class="line">/**</span><br><span class="line"> å‘é€çŸ­ä¿¡</span><br><span class="line"></span><br><span class="line"> @param toRecipients æ”¶ä»¶äººç¾¤ç»„</span><br><span class="line"> @param content å†…å®¹</span><br><span class="line"> @param result å‘é€ç»“æœ</span><br><span class="line"> */</span><br><span class="line">- (void)lz_sendMessageWithToRecipients:(NSArray&lt;NSString *&gt; *)toRecipients</span><br><span class="line">                               content:(NSString *)content</span><br><span class="line">                               reslt:(void(^)(NSInteger))result;</span><br><span class="line">/**</span><br><span class="line"> æ‹¨å·</span><br><span class="line"></span><br><span class="line"> @param phoneNum å·ç </span><br><span class="line"> */</span><br><span class="line">- (void)lz_dailPhone:(NSString *)phoneNum;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> å¼€å¯å®šä½æœåŠ¡</span><br><span class="line"></span><br><span class="line"> @param localResult å®šä½è·å–ä¿¡æ¯</span><br><span class="line"> */</span><br><span class="line">- (void)lz_openLocationService:(void(^)(id info))localResult;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> IOS 10çš„é€šçŸ¥   æ¨é€æ¶ˆæ¯ æ”¯æŒçš„éŸ³é¢‘  å›¾ç‰‡ &lt;= 10M  è§†é¢‘ &lt;= 50M </span><br><span class="line"> </span><br><span class="line"> @param body æ¶ˆæ¯å†…å®¹</span><br><span class="line"> @param promptTone æç¤ºéŸ³</span><br><span class="line"> @param soundName éŸ³é¢‘</span><br><span class="line"> @param imageName å›¾ç‰‡</span><br><span class="line"> @param movieName è§†é¢‘</span><br><span class="line"> @param identifier æ¶ˆæ¯æ ‡è¯†</span><br><span class="line"> */</span><br><span class="line">-(void)lz_pushNotification_IOS_10_Title:(NSString *)title</span><br><span class="line">                               subtitle:(NSString *)subtitle</span><br><span class="line">                                   body:(NSString *)body</span><br><span class="line">                             promptTone:(NSString *)promptTone</span><br><span class="line">                              soundName:(NSString *)soundName</span><br><span class="line">                              imageName:(NSString *)imageName</span><br><span class="line">                              movieName:(NSString *)movieName</span><br><span class="line">                           timeInterval:(NSTimeInterval)TimeInterval</span><br><span class="line">                                repeats:(BOOL)repeats</span><br><span class="line">                             Identifier:(NSString *)identifier API_AVAILABLE(ios(10.0));</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> IOS 10å‰çš„é€šçŸ¥</span><br><span class="line"></span><br><span class="line"> @param timeInterval å»¶è¿Ÿæ—¶é—´</span><br><span class="line"> @param repeatInterval é‡å¤æé†’æ¬¡æ•°</span><br><span class="line"> @param alertBody å†…å®¹</span><br><span class="line"> @param alertTitle æ ‡é¢˜</span><br><span class="line"> @param alertAction æ»‘åŠ¨æ–‡å­—</span><br><span class="line"> @param alertLaunchImage alertLaunchImage</span><br><span class="line"> @param soundName å£°éŸ³ ä¸ºç©ºåˆ™ä¸ºç³»ç»Ÿå£°éŸ³</span><br><span class="line"> @param userInfo å­—å…¸å‚æ•°</span><br><span class="line"> */</span><br><span class="line">- (void)lz_pushNotifationWithTimeInterval:(NSTimeInterval)timeInterval</span><br><span class="line">                           repeatInterval:(NSInteger)repeatInterval</span><br><span class="line">                                alertBody:(NSString *)alertBody</span><br><span class="line">                               alertTitle:(NSString *)alertTitle</span><br><span class="line">                              alertAction:(NSString *)alertAction</span><br><span class="line">                         alertLaunchImage:(NSString *)alertLaunchImage</span><br><span class="line">                                soundName:(NSString *)soundName</span><br><span class="line">                                 userInfo:(NSDictionary *)userInfo;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h4 id="å®ç°æ–‡ä»¶"><a href="#å®ç°æ–‡ä»¶" class="headerlink" title="å®ç°æ–‡ä»¶"></a>å®ç°æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZSystemSDKManager.h&quot;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &lt;MessageUI/MessageUI.h&gt;</span><br><span class="line">#import &lt;CoreLocation/CoreLocation.h&gt;</span><br><span class="line">#import &lt;UserNotifications/UserNotifications.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define kRootViewController  UIApplication.sharedApplication.delegate.window.rootViewController</span><br><span class="line"></span><br><span class="line">@interface LZSystemSDKManager () &lt;  CNContactPickerDelegate,</span><br><span class="line">                                    MFMailComposeViewControllerDelegate,</span><br><span class="line">                                    MFMessageComposeViewControllerDelegate,</span><br><span class="line">                                    CLLocationManagerDelegate&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) void (^selectContactResult)(CNContact *obj) API_AVAILABLE(ios(9.0));</span><br><span class="line">@property (nonatomic, copy) void (^postEmailResult)(NSInteger obj);</span><br><span class="line">@property (nonatomic, copy) void (^sendMessageResult)(NSInteger obj);</span><br><span class="line">@property (nonatomic, copy) void (^locakResult)(id info);</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZSystemSDKManager</span><br><span class="line"></span><br><span class="line">+ (instancetype)manager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static LZSystemSDKManager *manager;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        manager = [[LZSystemSDKManager alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return manager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - é€‰æ‹©è”ç³»äººä¿¡æ¯</span><br><span class="line">- (void)lz_selecteContactResulet:(void(^)(CNContact *obj))result API_AVAILABLE(ios(9.0)) &#123;</span><br><span class="line">    self.selectContactResult = result;</span><br><span class="line"></span><br><span class="line">    CNAuthorizationStatus status = [CNContactStore authorizationStatusForEntityType:CNEntityTypeContacts];</span><br><span class="line">    if (status == CNAuthorizationStatusNotDetermined) &#123;</span><br><span class="line">        CNContactStore *store = [[CNContactStore alloc] init];</span><br><span class="line">        [store requestAccessForEntityType:CNEntityTypeContacts completionHandler:^(BOOL granted, NSError * _Nullable error) &#123;</span><br><span class="line">            if (error) &#123;</span><br><span class="line">                [self showHUDTitle:@&quot;æœªè·å–è®¿é—®æƒé™&quot; info:@&quot;è¯·å‰å¾€è®¾ç½®ä¸­æ‰“å¼€è®¿é—®æƒé™&quot;];</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                CNContactPickerViewController * picker = [CNContactPickerViewController new];</span><br><span class="line">                picker.delegate = self;</span><br><span class="line">                picker.displayedPropertyKeys = @[CNContactPhoneNumbersKey];</span><br><span class="line">                [kRootViewController presentViewController: picker  animated:YES completion:nil];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (status == CNAuthorizationStatusAuthorized) &#123;</span><br><span class="line">        CNContactPickerViewController * picker = [CNContactPickerViewController new];</span><br><span class="line">        picker.delegate = self;</span><br><span class="line">        picker.displayedPropertyKeys = @[CNContactPhoneNumbersKey];</span><br><span class="line">        [kRootViewController presentViewController: picker  animated:YES completion:nil];</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        [self showHUDTitle:@&quot;æœªè·å–è®¿é—®æƒé™&quot; info:@&quot;è¯·å‰å¾€è®¾ç½®ä¸­æ‰“å¼€è®¿é—®æƒé™&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - CNContactPickerDelegate</span><br><span class="line">-  (void)contactPicker:(CNContactPickerViewController *)picker didSelectContactProperty:(CNContactProperty *)contactProperty API_AVAILABLE(ios(9.0)) &#123;</span><br><span class="line">    CNContact *contact = contactProperty.contact;</span><br><span class="line">    self.selectContactResult(contact);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - å‘é€é‚®ä»¶</span><br><span class="line">- (void)lz_postEmialWithToRecipients:(NSArray&lt;NSString *&gt; *)toRecipients</span><br><span class="line">                        ccRecipients:(NSArray&lt;NSString *&gt; *)ccRecipients</span><br><span class="line">                       bccRecipients:(NSArray&lt;NSString *&gt; *)bccRecipients</span><br><span class="line">                               theme:(NSString *)theme</span><br><span class="line">                        emailContent:(NSString *)emailContent</span><br><span class="line">                              isHTML:(BOOL)isHTML</span><br><span class="line">                               reslt:(nonnull void (^)(NSInteger))result &#123;</span><br><span class="line">    </span><br><span class="line">    self.postEmailResult = result;</span><br><span class="line">    MFMailComposeViewController *mailCompose = [[MFMailComposeViewController alloc] init];</span><br><span class="line">    mailCompose.mailComposeDelegate = self;</span><br><span class="line">    [mailCompose setToRecipients:toRecipients];</span><br><span class="line">    [mailCompose setCcRecipients:ccRecipients];</span><br><span class="line">    [mailCompose setBccRecipients:bccRecipients];</span><br><span class="line">    [mailCompose setSubject:theme];</span><br><span class="line">    [mailCompose setMessageBody:emailContent isHTML:isHTML];</span><br><span class="line">    [kRootViewController presentViewController:mailCompose animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - MFMailComposeViewControllerDelegateçš„ä»£ç†æ–¹æ³•ï¼š</span><br><span class="line">-(void)mailComposeController:(MFMailComposeViewController *)controller didFinishWithResult:(MFMailComposeResult)result error:(NSError *)error &#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:YES completion:nil];</span><br><span class="line">     self.postEmailResult(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - å‘é€çŸ­ä¿¡</span><br><span class="line">- (void)lz_sendMessageWithToRecipients:(NSArray&lt;NSString *&gt; *)toRecipients content:(NSString *)content reslt:(nonnull void (^)(NSInteger))result &#123;</span><br><span class="line">    self.sendMessageResult = result;</span><br><span class="line">        MFMessageComposeViewController *messageVC = [[MFMessageComposeViewController alloc] init];</span><br><span class="line">    messageVC.recipients = toRecipients;</span><br><span class="line">    messageVC.body = content;</span><br><span class="line">    messageVC.messageComposeDelegate = self;</span><br><span class="line">    [kRootViewController presentViewController:messageVC animated:YES completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - MFMessageComposeViewControllerDelegate</span><br><span class="line">- (void)messageComposeViewController:(MFMessageComposeViewController *)controller didFinishWithResult:(MessageComposeResult)result &#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:true completion:nil];</span><br><span class="line">    self.sendMessageResult(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ‹¨å·</span><br><span class="line">- (void)lz_dailPhone:(NSString *)phoneNum &#123;</span><br><span class="line">    [[UIApplication sharedApplication] openURL:[NSURL URLWithString:[NSString stringWithFormat:@&quot;tel:%@&quot;,phoneNum]]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - å®šä½æœåŠ¡</span><br><span class="line">- (void)lz_openLocationService:(void(^)(id info))localResult &#123;</span><br><span class="line">    self.locakResult = localResult;</span><br><span class="line">    CLLocationManager *localManager = [[CLLocationManager alloc] init];</span><br><span class="line">    localManager.delegate = self;</span><br><span class="line">    localManager.desiredAccuracy = kCLLocationAccuracyBest;</span><br><span class="line">    localManager.distanceFilter = kCLLocationAccuracyNearestTenMeters;</span><br><span class="line">    [localManager requestWhenInUseAuthorization];</span><br><span class="line">    </span><br><span class="line">    if ([CLLocationManager locationServicesEnabled] ||</span><br><span class="line">        [CLLocationManager authorizationStatus] == kCLAuthorizationStatusAuthorizedWhenInUse ||</span><br><span class="line">        [CLLocationManager authorizationStatus] == kCLAuthorizationStatusAuthorizedAlways) &#123;</span><br><span class="line">        </span><br><span class="line">        [localManager startUpdatingLocation];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self showHUDTitle:@&quot;æœªè·å–å®šä½æƒé™&quot; info:@&quot;è¯·å‰å¾€è®¾ç½®ä¸­æ‰“å¼€å®šä½æƒé™&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark CLLocationManagerDelegate</span><br><span class="line">- (void)locationManager:(CLLocationManager *)manager didUpdateLocations:(NSArray *)locations &#123;</span><br><span class="line">    </span><br><span class="line">    CLLocation *currLocation = [locations lastObject];</span><br><span class="line">    CLLocation *infLocation = [[CLLocation alloc] initWithLatitude:currLocation.coordinate.latitude longitude:currLocation.coordinate.longitude];</span><br><span class="line">    </span><br><span class="line">    CLGeocoder *geocoder=[[CLGeocoder alloc]init];</span><br><span class="line">    </span><br><span class="line">    [geocoder reverseGeocodeLocation:infLocation completionHandler:^(NSArray&lt;CLPlacemark *&gt; * _Nullable placemarks, NSError * _Nullable error) &#123;</span><br><span class="line">        if (error !=nil || placemarks.count == 0) &#123;</span><br><span class="line">            NSLog(@&quot;%@&quot;,error);</span><br><span class="line">            self.locakResult(nil);</span><br><span class="line">            return ;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        NSDictionary *infoDic = @&#123;@&quot;country&quot;:placemarks.firstObject.country,</span><br><span class="line">                                  @&quot;administrativeArea&quot;:placemarks.firstObject.administrativeArea,</span><br><span class="line">                                  @&quot;locality&quot;:placemarks.firstObject.locality,</span><br><span class="line">                                  @&quot;subLocality&quot;:placemarks.firstObject.subLocality,</span><br><span class="line">                                  @&quot;thoroughfare&quot;:placemarks.firstObject.thoroughfare,</span><br><span class="line">                                  @&quot;name&quot;:placemarks.firstObject.name</span><br><span class="line">                                  &#125;;</span><br><span class="line">        self.locakResult(infoDic);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)locationManager:(CLLocationManager *)manager didFailWithError:(NSError *)error &#123;</span><br><span class="line">    [self showHUDTitle:@&quot;æœªè·å–å®šä½æƒé™&quot; info:@&quot;è¯·å‰å¾€è®¾ç½®ä¸­æ‰“å¼€å®šä½æƒé™&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æç¤ºæ¡†</span><br><span class="line">- (void)showHUDTitle:(NSString *)title info:(NSString *)info &#123;</span><br><span class="line">    </span><br><span class="line">    UIAlertController *alterController = [UIAlertController alertControllerWithTitle:title message:info</span><br><span class="line">                                                                      preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">    UIAlertAction *cancal = [UIAlertAction actionWithTitle:@&quot;å–æ¶ˆ&quot; style:UIAlertActionStyleCancel handler:nil];</span><br><span class="line">    UIAlertAction *sure = [UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDestructive handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">        NSURL *url = [NSURL URLWithString:UIApplicationOpenSettingsURLString];</span><br><span class="line">        if ([[UIApplication sharedApplication] canOpenURL:url]) &#123;</span><br><span class="line">            if (@available(iOS 10.0, *)) &#123;</span><br><span class="line">                [[UIApplication sharedApplication] openURL:url options:@&#123;&#125; completionHandler:nil];</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [alterController addAction:cancal];</span><br><span class="line">    [alterController addAction:sure];</span><br><span class="line">    </span><br><span class="line">    [kRootViewController presentViewController:alterController animated:true completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - IOS 10å‰çš„é€šçŸ¥</span><br><span class="line">- (void)lz_pushNotifationWithTimeInterval:(NSTimeInterval)timeInterval</span><br><span class="line">                           repeatInterval:(NSInteger)repeatInterval</span><br><span class="line">                                alertBody:(NSString *)alertBody</span><br><span class="line">                               alertTitle:(NSString *)alertTitle</span><br><span class="line">                              alertAction:(NSString *)alertAction</span><br><span class="line">                         alertLaunchImage:(NSString *)alertLaunchImage</span><br><span class="line">                                soundName:(NSString *)soundName</span><br><span class="line">                                 userInfo:(NSDictionary *)userInfo &#123;</span><br><span class="line">    // å®šä¹‰æœ¬åœ°é€šçŸ¥å¯¹è±¡</span><br><span class="line">    UILocalNotification *notification = [[UILocalNotification alloc] init];</span><br><span class="line">    // è®¾ç½®è°ƒç”¨æ—¶é—´</span><br><span class="line">    notification.timeZone = [NSTimeZone localTimeZone];</span><br><span class="line">    //é€šçŸ¥è§¦å‘çš„æ—¶é—´ï¼Œ10sä»¥å</span><br><span class="line">    notification.fireDate = [NSDate dateWithTimeIntervalSinceNow:timeInterval];</span><br><span class="line">    // é€šçŸ¥é‡å¤æ¬¡æ•°</span><br><span class="line">    notification.repeatInterval = repeatInterval;</span><br><span class="line">    // å½“å‰æ—¥å†ï¼Œä½¿ç”¨å‰æœ€å¥½è®¾ç½®æ—¶åŒºç­‰ä¿¡æ¯ä»¥ä¾¿èƒ½å¤Ÿè‡ªåŠ¨åŒæ­¥æ—¶é—´</span><br><span class="line">    notification.repeatCalendar = [NSCalendar currentCalendar];</span><br><span class="line">    </span><br><span class="line">    //è®¾ç½®é€šçŸ¥å±æ€§</span><br><span class="line">    // é€šçŸ¥ä¸»ä½“</span><br><span class="line">    notification.alertBody = alertBody;</span><br><span class="line">    if (@available(iOS 8.2, *)) &#123;</span><br><span class="line">        notification.alertTitle = alertTitle;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Fallback on earlier versions</span><br><span class="line">    &#125;</span><br><span class="line">    // åº”ç”¨ç¨‹åºå›¾æ ‡å³ä¸Šè§’æ˜¾ç¤ºçš„æ¶ˆæ¯æ•°</span><br><span class="line">    notification.applicationIconBadgeNumber += 1;</span><br><span class="line">    // å¾…æœºç•Œé¢çš„æ»‘åŠ¨åŠ¨ä½œæç¤º</span><br><span class="line">    notification.alertAction = alertAction;</span><br><span class="line">    // é€šè¿‡ç‚¹å‡»é€šçŸ¥æ‰“å¼€åº”ç”¨æ—¶çš„å¯åŠ¨å›¾ç‰‡,è¿™é‡Œä½¿ç”¨ç¨‹åºå¯åŠ¨å›¾ç‰‡</span><br><span class="line">    notification.alertLaunchImage = alertLaunchImage;</span><br><span class="line">    // æ”¶åˆ°é€šçŸ¥æ—¶æ’­æ”¾çš„å£°éŸ³ï¼Œé»˜è®¤æ¶ˆæ¯å£°éŸ³</span><br><span class="line">    notification.soundName = soundName.length == 0 ? UILocalNotificationDefaultSoundName : soundName;</span><br><span class="line">    </span><br><span class="line">    //è®¾ç½®ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">    notification.userInfo = userInfo;</span><br><span class="line">    </span><br><span class="line">    //è°ƒç”¨é€šçŸ¥</span><br><span class="line">    [[UIApplication sharedApplication] scheduleLocalNotification:notification];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - IOS 10çš„é€šçŸ¥</span><br><span class="line">-(void)lz_pushNotification_IOS_10_Title:(NSString *)title</span><br><span class="line">                               subtitle:(NSString *)subtitle</span><br><span class="line">                                   body:(NSString *)body</span><br><span class="line">                             promptTone:(NSString *)promptTone</span><br><span class="line">                              soundName:(NSString *)soundName</span><br><span class="line">                              imageName:(NSString *)imageName</span><br><span class="line">                              movieName:(NSString *)movieName</span><br><span class="line">                           timeInterval:(NSTimeInterval)TimeInterval</span><br><span class="line">                                repeats:(BOOL)repeats</span><br><span class="line">                             Identifier:(NSString *)identifier API_AVAILABLE(ios(10.0)) &#123;</span><br><span class="line">    </span><br><span class="line">    //è·å–é€šçŸ¥ä¸­å¿ƒç”¨æ¥æ¿€æ´»æ–°å»ºçš„é€šçŸ¥</span><br><span class="line">    UNUserNotificationCenter * center  = [UNUserNotificationCenter currentNotificationCenter];</span><br><span class="line">    UNMutableNotificationContent * content = [[UNMutableNotificationContent alloc] init];</span><br><span class="line">    content.title = title;</span><br><span class="line">    content.subtitle = subtitle;</span><br><span class="line">    content.body = body;</span><br><span class="line">    </span><br><span class="line">    //é€šçŸ¥çš„æç¤ºéŸ³</span><br><span class="line">    if ([promptTone containsString:@&quot;.&quot;]) &#123;</span><br><span class="line">        UNNotificationSound *sound = [UNNotificationSound soundNamed:promptTone];</span><br><span class="line">        content.sound = sound;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    __block UNNotificationAttachment *imageAtt;</span><br><span class="line">    __block UNNotificationAttachment *movieAtt;</span><br><span class="line">    __block UNNotificationAttachment *soundAtt;</span><br><span class="line">    </span><br><span class="line">    if ([imageName containsString:@&quot;.&quot;]) &#123;</span><br><span class="line">        [self addNotificationAttachmentContent:content attachmentName:imageName options:nil withCompletion:^(NSError *error, UNNotificationAttachment *notificationAtt) &#123;</span><br><span class="line">            imageAtt = [notificationAtt copy];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if ([soundName containsString:@&quot;.&quot;]) &#123;</span><br><span class="line">        [self addNotificationAttachmentContent:content attachmentName:soundName options:nil withCompletion:^(NSError *error, UNNotificationAttachment *notificationAtt) &#123;</span><br><span class="line">            soundAtt = [notificationAtt copy];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if ([movieName containsString:@&quot;.&quot;]) &#123;</span><br><span class="line">        // åœ¨è¿™é‡Œæˆªå–è§†é¢‘çš„ç¬¬10sä¸ºè§†é¢‘çš„ç¼©ç•¥å›¾ ï¼šUNNotificationAttachmentOptionsThumbnailTimeKey</span><br><span class="line">        [self addNotificationAttachmentContent:content attachmentName:movieName options:@&#123;@&quot;UNNotificationAttachmentOptionsThumbnailTimeKey&quot;:@10&#125; withCompletion:^(NSError *error, UNNotificationAttachment *notificationAtt) &#123;</span><br><span class="line">            movieAtt = [notificationAtt copy];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSMutableArray * array = [NSMutableArray array];</span><br><span class="line">    </span><br><span class="line">    if (imageAtt) &#123;</span><br><span class="line">        [array addObject:imageAtt];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (soundAtt) &#123;</span><br><span class="line">        [array addObject:soundAtt];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (movieAtt) &#123;</span><br><span class="line">        [array addObject:movieAtt];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    content.attachments = array;</span><br><span class="line">    </span><br><span class="line">    //æ·»åŠ é€šçŸ¥ä¸‹æ‹‰åŠ¨ä½œæŒ‰é’®</span><br><span class="line">    NSMutableArray * actionMutableArray = [NSMutableArray array];</span><br><span class="line">    UNNotificationAction * actionA = [UNNotificationAction actionWithIdentifier:@&quot;identifierNeedUnlock&quot; title:@&quot;è¿›å…¥åº”ç”¨&quot; options:UNNotificationActionOptionAuthenticationRequired];</span><br><span class="line">    UNNotificationAction * actionB = [UNNotificationAction actionWithIdentifier:@&quot;identifierRed&quot; title:@&quot;å¿½ç•¥&quot; options:UNNotificationActionOptionDestructive];</span><br><span class="line">    [actionMutableArray addObjectsFromArray:@[actionA,actionB]];</span><br><span class="line">    </span><br><span class="line">    if (actionMutableArray.count &gt; 1) &#123;</span><br><span class="line">        UNNotificationCategory * category = [UNNotificationCategory categoryWithIdentifier:@&quot;categoryNoOperationAction&quot; actions:actionMutableArray intentIdentifiers:@[] options:UNNotificationCategoryOptionCustomDismissAction];</span><br><span class="line">        [center setNotificationCategories:[NSSet setWithObjects:category, nil]];</span><br><span class="line">        content.categoryIdentifier = @&quot;categoryNoOperationAction&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // UNTimeIntervalNotificationTrigger   å»¶æ—¶æ¨é€</span><br><span class="line">    // UNCalendarNotificationTrigger       å®šæ—¶æ¨é€</span><br><span class="line">    // UNLocationNotificationTrigger       ä½ç½®å˜åŒ–æ¨é€</span><br><span class="line">    BOOL repeat = (TimeInterval &gt; 60 &amp;&amp; repeats) ? true : false;</span><br><span class="line">    UNTimeIntervalNotificationTrigger * tirgger = [UNTimeIntervalNotificationTrigger triggerWithTimeInterval:TimeInterval repeats:repeat];</span><br><span class="line">    </span><br><span class="line">    //å»ºç«‹é€šçŸ¥è¯·æ±‚</span><br><span class="line">    UNNotificationRequest * request = [UNNotificationRequest requestWithIdentifier:identifier content:content trigger:tirgger];</span><br><span class="line">    </span><br><span class="line">    //å°†å»ºç«‹çš„é€šçŸ¥è¯·æ±‚æ·»åŠ åˆ°é€šçŸ¥ä¸­å¿ƒ</span><br><span class="line">    [center addNotificationRequest:request withCompletionHandler:^(NSError * _Nullable error) &#123;</span><br><span class="line">        NSLog(@&quot;%@æœ¬åœ°æ¨é€ :( æŠ¥é”™ %@&quot;,identifier, error);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> å¢åŠ é€šçŸ¥é™„ä»¶</span><br><span class="line"> </span><br><span class="line"> @param content é€šçŸ¥å†…å®¹</span><br><span class="line"> @param attachmentName é™„ä»¶åç§°</span><br><span class="line"> @param options ç›¸å…³é€‰é¡¹</span><br><span class="line"> @param completion ç»“æœå›è°ƒ</span><br><span class="line"> */</span><br><span class="line">-(void)addNotificationAttachmentContent:(UNMutableNotificationContent *)content attachmentName:(NSString *)attachmentName  options:(NSDictionary *)options withCompletion:(void(^)(NSError * error , UNNotificationAttachment * notificationAtt))completion  API_AVAILABLE(ios(10.0)) &#123;</span><br><span class="line">    </span><br><span class="line">    NSArray * arr = [attachmentName componentsSeparatedByString:@&quot;.&quot;];</span><br><span class="line">    </span><br><span class="line">    NSError * error;</span><br><span class="line">    </span><br><span class="line">    NSString * path = [[NSBundle mainBundle]pathForResource:arr[0] ofType:arr[1]];</span><br><span class="line">    </span><br><span class="line">    UNNotificationAttachment * attachment = [UNNotificationAttachment attachmentWithIdentifier:[NSString stringWithFormat:@&quot;notificationAtt_%@&quot;,arr[1]] URL:[NSURL fileURLWithPath:path] options:options error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    if (error) &#123;</span><br><span class="line">        NSLog(@&quot;attachment error %@&quot;, error);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    completion(error,attachment);</span><br><span class="line">    content.launchImageName = attachmentName;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç³»ç»ŸSDKä»‹ç»&quot;&gt;&lt;a href=&quot;#ç³»ç»ŸSDKä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ç³»ç»ŸSDKä»‹ç»&quot;&gt;&lt;/a&gt;ç³»ç»ŸSDKä»‹ç»&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;è®¿é—®è”ç³»äººï¼Œå¹¶é€‰æ‹©ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;æ‹¨å·&lt;/li&gt;
&lt;li&gt;å‘é€çŸ­ä¿¡&lt;/li&gt;
&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOSç³»ç»Ÿå°è£…ï¼šQQä¾§è¾¹èœå•</title>
    <link href="https://wudan-ios.github.io/2018/09/30/iOS%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85%EF%BC%9AQQ%E4%BE%A7%E8%BE%B9%E8%8F%9C%E5%8D%95/"/>
    <id>https://wudan-ios.github.io/2018/09/30/iOSç³»ç»Ÿå°è£…ï¼šQQä¾§è¾¹èœå•/</id>
    <published>2018-09-30T02:12:00.000Z</published>
    <updated>2018-11-05T11:11:31.043Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface LZSliderContainerViewController : UIViewController</span><br><span class="line">// æ˜¯å¦å…è®¸ä¾§æ»‘æ‰‹åŠ¿</span><br><span class="line">@property (nonatomic, assign) BOOL allowOpenSliderView;</span><br><span class="line"></span><br><span class="line">// å•ä¾‹</span><br><span class="line">+ (instancetype)mamager;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line"></span><br><span class="line"> @param mainController ä¸»é¡µé¢æ§åˆ¶å™¨</span><br><span class="line"> @param sliderController èœå•é¡µé¢æ§åˆ¶å™¨</span><br><span class="line"> @param space ç©ºéš™</span><br><span class="line"> @return UIViewController</span><br><span class="line"> */</span><br><span class="line">- (UIViewController *)lz_setupMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController space:(CGFloat)space;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> æ‰“å¼€ä¾§è¾¹èœå•</span><br><span class="line"> */</span><br><span class="line">- (void)lz_openSlderView;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> å…³é—­ä¾§è¾¹èœå•</span><br><span class="line"> */</span><br><span class="line">- (void)lz_closeSliderView;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZSliderContainerViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface UIView (Frame)</span><br><span class="line"></span><br><span class="line">@property (nonatomic) CGFloat left;</span><br><span class="line">@property (nonatomic) CGFloat right;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation UIView (Frame)</span><br><span class="line"></span><br><span class="line">- (CGFloat)left &#123;</span><br><span class="line">    return self.frame.origin.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setLeft:(CGFloat)x &#123;</span><br><span class="line">    CGRect frame = self.frame;</span><br><span class="line">    frame.origin.x = x;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)right &#123;</span><br><span class="line">    return self.frame.origin.x + self.frame.size.width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setRight:(CGFloat)right &#123;</span><br><span class="line">    CGRect frame = self.frame;</span><br><span class="line">    frame.origin.x = right - frame.size.width;</span><br><span class="line">    self.frame = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface LZSliderContainerViewController ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) UIViewController *mainController;</span><br><span class="line">@property (nonatomic, strong) UIViewController *sliderController;</span><br><span class="line">@property (nonatomic, assign) CGFloat spece;</span><br><span class="line">@property (nonatomic, assign) CGFloat panStartX;</span><br><span class="line">@property (nonatomic, strong) UIView *coverView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZSliderContainerViewController</span><br><span class="line">#pragma mark - å•ä¾‹æ–¹æ³•</span><br><span class="line">+ (instancetype)mamager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static LZSliderContainerViewController *vc;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        vc = [[LZSliderContainerViewController alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return vc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">- (UIViewController *)lz_setupMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController space:(CGFloat)space &#123;</span><br><span class="line">    [self lz_addChildControllerWithMainController:mainController sliderController:sliderController];</span><br><span class="line">    [self lz_setupCoverView];</span><br><span class="line">    _spece = space;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - é…ç½®é®ç½©å±‚</span><br><span class="line">- (void)lz_setupCoverView &#123;</span><br><span class="line">    self.coverView = [[UIView alloc] init];</span><br><span class="line">    self.coverView.frame = UIScreen.mainScreen.bounds;</span><br><span class="line">    self.coverView.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:0];</span><br><span class="line">    self.coverView.hidden = true;</span><br><span class="line">    [self.coverView addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(lz_closeSliderView)]];</span><br><span class="line">    [self.view addSubview:self.coverView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ·»åŠ VC</span><br><span class="line">- (void)lz_addChildControllerWithMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController &#123;</span><br><span class="line">    [self addChildViewController:mainController];</span><br><span class="line">    [mainController didMoveToParentViewController:self];</span><br><span class="line">    mainController.view.frame = UIScreen.mainScreen.bounds;</span><br><span class="line">    [self.view addSubview:mainController.view];</span><br><span class="line">    </span><br><span class="line">    [self addChildViewController:sliderController];</span><br><span class="line">    [sliderController didMoveToParentViewController:self];</span><br><span class="line">    sliderController.view.frame = CGRectMake(-UIScreen.mainScreen.bounds.size.width, 0, UIScreen.mainScreen.bounds.size.width, UIScreen.mainScreen.bounds.size.height);</span><br><span class="line">    [self.view addSubview:sliderController.view];</span><br><span class="line">    </span><br><span class="line">    self.mainController = mainController;</span><br><span class="line">    self.sliderController = sliderController;</span><br><span class="line">    </span><br><span class="line">    [self lz_setupGusture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ·»åŠ å¹³ç§»æ‰‹åŠ¿</span><br><span class="line">- (void)lz_setupGusture &#123;</span><br><span class="line">    UIPanGestureRecognizer *panGusture = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(lz_panGestureRecognizer:)];</span><br><span class="line">    [self.view addGestureRecognizer:panGusture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - UIPanGestureRecognizer Action</span><br><span class="line">- (void)lz_panGestureRecognizer:(UIPanGestureRecognizer *)sender &#123;</span><br><span class="line">    UIView *rootView = self.mainController.view;</span><br><span class="line">    UIView *menuView = self.sliderController.view;</span><br><span class="line">    </span><br><span class="line">    if (sender.state == UIGestureRecognizerStateBegan) &#123;</span><br><span class="line">        CGFloat startPointX = [sender translationInView:self.view].x;</span><br><span class="line">        self.panStartX = startPointX;</span><br><span class="line">        self.coverView.hidden = false;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.panStartX &gt;= 40 &amp;&amp; rootView.frame.origin.x == 0) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    CGFloat translationX = [sender translationInView:rootView].x;</span><br><span class="line">    CGFloat rootViewX = rootView.frame.origin.x;</span><br><span class="line">    </span><br><span class="line">    rootViewX = [self lz_minmumWithValueA:(rootViewX + translationX) valueB:(UIScreen.mainScreen.bounds.size.width - self.spece)];</span><br><span class="line">    rootViewX = [self lz_maxmumWithValueA:rootViewX valueB:0];</span><br><span class="line">    </span><br><span class="line">    rootView.left = rootViewX;</span><br><span class="line">    menuView.right = rootView.left;</span><br><span class="line">    self.coverView.frame = rootView.frame;</span><br><span class="line">    </span><br><span class="line">    CGFloat aphal = 0.5 * rootView.frame.origin.x / (UIScreen.mainScreen.bounds.size.width - self.spece);</span><br><span class="line">    self.coverView.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:aphal];</span><br><span class="line">    </span><br><span class="line">    [sender setTranslation:CGPointZero inView:rootView];</span><br><span class="line">    </span><br><span class="line">    if (sender.state == UIGestureRecognizerStateEnded || sender.state == UIGestureRecognizerStateCancelled) &#123;</span><br><span class="line">        if (rootViewX &gt;= (UIScreen.mainScreen.bounds.size.width - self.spece)/2) &#123;</span><br><span class="line">            [self lz_openSlderView];</span><br><span class="line">        &#125; else&#123;</span><br><span class="line">            [self lz_closeSliderView];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ‰“å¼€ä¾§è¾¹èœå•</span><br><span class="line">- (void)lz_openSlderView &#123;</span><br><span class="line">    [self lz_setupGusture];</span><br><span class="line">    </span><br><span class="line">    UIView *rootView = self.mainController.view;</span><br><span class="line">    UIView *menuView = self.sliderController.view;</span><br><span class="line">    </span><br><span class="line">    self.coverView.hidden = false;</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">        rootView.left = UIScreen.mainScreen.bounds.size.width - self.spece;</span><br><span class="line">        menuView.right = rootView.left;</span><br><span class="line">        self.coverView.frame = rootView.frame;</span><br><span class="line">        self.coverView.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:0.5];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - å…³é—­ä¾§è¾¹èœå•</span><br><span class="line">- (void)lz_closeSliderView &#123;</span><br><span class="line">    UIView *rootView = self.mainController.view;</span><br><span class="line">    UIView *menuView = self.sliderController.view;</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">        self.coverView.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:0];</span><br><span class="line">        rootView.left = 0;</span><br><span class="line">        menuView.right = rootView.left;</span><br><span class="line">        self.coverView.frame = rootView.frame;</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        if (finished) &#123;</span><br><span class="line">            self.coverView.hidden = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ¯”è¾ƒå¤§å°å–æœ€å°å€¼</span><br><span class="line">- (CGFloat)lz_minmumWithValueA:(CGFloat)a valueB:(CGFloat)b &#123;</span><br><span class="line">    return a &gt; b ? b : a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ¯”è¾ƒå¤§å°å–æœ€å¤§å€¼</span><br><span class="line">- (CGFloat)lz_maxmumWithValueA:(CGFloat)a valueB:(CGFloat)b &#123;</span><br><span class="line">    return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Setter</span><br><span class="line">- (void)setAllowOpenSliderView:(BOOL)allowOpenSliderView &#123;</span><br><span class="line">    _allowOpenSliderView = allowOpenSliderView;</span><br><span class="line">    if (allowOpenSliderView) &#123;</span><br><span class="line">        [self lz_setupGusture];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        for (UIGestureRecognizer *pan in self.view.gestureRecognizers) &#123;</span><br><span class="line">            [self.view removeGestureRecognizer:pan];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>AppDelegateä¸­è®¾ç½®ä¸ºæ ¹æ§åˆ¶å™¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.window.rootViewController = [[LZSliderContainerViewController mamager] lz_setupMainController:tab sliderController:sldier space:200];</span><br></pre></td></tr></table></figure></p><p>// å•ç‹¬æ‰“å¼€æˆ–å…³é—­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// æ‰“å¼€é¡µé¢</span><br><span class="line">[[LZSliderContainerViewController mamager] lz_openSlderView];</span><br><span class="line">// å…³é—­é¡µé¢</span><br><span class="line">[[LZSliderContainerViewController mamager] lz_closeSliderView];</span><br></pre></td></tr></table></figure></p><p>é»˜è®¤æ‰€æœ‰é¡µé¢éƒ½æ˜¯æ‰“å¼€çš„ï¼Œå¦‚æœéœ€è¦å…³é—­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillAppear:(BOOL)animated&#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line">    [LZSliderContainerViewController mamager].allowOpenSliderView = NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewDidDisappear:(BOOL)animated &#123;</span><br><span class="line">    [super viewDidDisappear:animated];</span><br><span class="line">    [LZSliderContainerViewController mamager].allowOpenSliderView = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ•ˆæœå›¾<br><img src="http://i2.bvimg.com/667578/85fad1a82178134d.gif" alt="image"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®å­˜å‚¨ï¼šFMDB-æ¨¡å‹è¿›è¡Œå­˜å–</title>
    <link href="https://wudan-ios.github.io/2018/09/05/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%EF%BC%9AFMDB-%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%8F%96/"/>
    <id>https://wudan-ios.github.io/2018/09/05/æ•°æ®å­˜å‚¨ï¼šFMDB-æ¨¡å‹è¿›è¡Œå­˜å–/</id>
    <published>2018-09-05T02:12:00.000Z</published>
    <updated>2018-09-20T02:10:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-db9208d961eb67c2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼å›¾"></p><p>å†™è¿™ä¸ªBlogçš„ç›®çš„æ˜¯ä¸ºäº†è®°å½•çš„å­¦ä¹ ç»å†ï¼Œä»£ç å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¸Œæœ›è¯»è€…ç†è§£ã€‚<br>æ—¥å¸¸å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œéœ€è¦è®¾è®¡å­—æ®µï¼Œæ„Ÿè§‰å¤ªç¹çäº†ï¼Œæƒ³æ‰¾ä¸ªç®€åŒ–çš„æ–¹æ³•ï¼Œå°±æƒ³é€šè¿‡è¿™æ ·è¿›è¡Œå®ç°ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸€ç§æ€è€ƒæ–¹å¼ã€‚å®é™…å®ç°è¿˜æ˜¯çœ‹éœ€æ±‚ã€‚å…·ä½“çœ‹ä»£ç ï¼š<br>1ã€å¯¼å…¥FMDB<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import FMDB</span><br></pre></td></tr></table></figure></p><p>2ã€ä½¿ç”¨å•åˆ©æ¨¡å¼å’Œå¿…è¦å±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static let defaultManger = WDDataBaseManager()</span><br><span class="line">typealias successBlock = () -&gt;Void</span><br><span class="line">typealias failBlock = () -&gt;Void</span><br><span class="line">private var tableName:String?</span><br></pre></td></tr></table></figure></p><p>3ã€æ‡’åŠ è½½åˆ›å»ºæ•°æ®åº“ï¼ˆåç§°æˆ‘éšä¾¿å–å¾—ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lazy var fmdb:FMDatabase = &#123;</span><br><span class="line">        let path = NSHomeDirectory().appending(&quot;/Documents/testDB.db&quot;)</span><br><span class="line">        let db = FMDatabase(path: path)</span><br><span class="line">        return db</span><br><span class="line">    &#125;()</span><br></pre></td></tr></table></figure></p><p>4ã€åˆ›å»ºè¡¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func creatTable(tableName:String) -&gt; Void &#123;</span><br><span class="line">        fmdb.open()</span><br><span class="line">        self.tableName = tableName</span><br><span class="line">        let creatSql = &quot;create table if not exists \(tableName) (id integer primary key autoincrement,model BLOB)&quot;</span><br><span class="line">        let result = fmdb.executeUpdate(creatSql, withArgumentsIn:[])</span><br><span class="line">        if result&#123;</span><br><span class="line">            print(&quot;åˆ›å»ºè¡¨æˆåŠŸ&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>5ã€åˆ é™¤è¡¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func dropTable() -&gt; Void &#123;</span><br><span class="line">       let sql = &quot;drop table if exists &quot; + tableName!</span><br><span class="line">       let result = fmdb.executeUpdate(sql, withArgumentsIn:[])</span><br><span class="line">       if result&#123;</span><br><span class="line">           print(&quot;åˆ é™¤è¡¨æˆåŠŸ&quot;)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>6ã€æ’å…¥æ•°æ®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func insert(model:NSObject, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;</span><br><span class="line">        let modelData = try! NSKeyedArchiver.archivedData(withRootObject: model, requiringSecureCoding: false)</span><br><span class="line">        let insertSql = &quot;insert into &quot; + tableName! + &quot; (model) values(?)&quot;</span><br><span class="line">        do &#123;</span><br><span class="line">            try fmdb.executeUpdate(insertSql, values: [modelData])</span><br><span class="line">            successBlock()</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">            failBlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>7ã€æ›´æ–°è¡¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func update(model:NSObject,uid:Int32, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;</span><br><span class="line">        let modelData = try! NSKeyedArchiver.archivedData(withRootObject: model, requiringSecureCoding: false)</span><br><span class="line">        let updateSql = &quot;update &quot; + tableName! + &quot; set model = ? where id = ?&quot;</span><br><span class="line">        do &#123;</span><br><span class="line">            try fmdb.executeUpdate(updateSql, values: [modelData, uid])</span><br><span class="line">            successBlock()</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">            failBlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>8ã€æŸ¥è¯¢æ•°æ®ï¼ˆè¿™æ˜¯æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œå…¶ä»–æŒ‰éœ€æ±‚è®¾è®¡ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func selectAll() -&gt; [NSObject] &#123;</span><br><span class="line">        var tmpArr = [NSObject]()</span><br><span class="line">        let selectSql = &quot;select * from &quot; + tableName!</span><br><span class="line">        do &#123;</span><br><span class="line">            let rs = try fmdb.executeQuery(selectSql, values:nil)</span><br><span class="line">            while rs.next() &#123;</span><br><span class="line">                var model = NSObject()</span><br><span class="line">                let modelData  = rs.data(forColumn:&quot;model&quot;)</span><br><span class="line">                let id = rs.int(forColumn: &quot;id&quot;)</span><br><span class="line">                model = try! NSKeyedUnarchiver.unarchiveTopLevelObjectWithData(modelData!) as! NSObject</span><br><span class="line">                model.wd_fmdb_id = id</span><br><span class="line">                tmpArr.append(model)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">        &#125;</span><br><span class="line">        return tmpArr</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>9ã€åˆ é™¤æ•°æ®ï¼ˆè¿™æ˜¯æ ¹æ®Idåˆ é™¤çš„ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func delete(uid:Int32, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;</span><br><span class="line">        let deleteSql = &quot;delete from &quot; + tableName! + &quot; where id = ?&quot;</span><br><span class="line">        do &#123;</span><br><span class="line">            try fmdb.executeUpdate(deleteSql, values: [uid])</span><br><span class="line">            successBlock()</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">            failBlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>10ã€æ–°å¢åˆ†ç±»æ·»åŠ é»˜è®¤Id<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private var wd_id_key: String = &quot;key&quot;</span><br><span class="line"></span><br><span class="line">extension NSObject &#123;</span><br><span class="line">    open var wd_fmdb_id:Int32? &#123;</span><br><span class="line">        get &#123;</span><br><span class="line">            return (objc_getAssociatedObject(self, &amp;wd_id_key) as? Int32)</span><br><span class="line">        &#125; set(newValue) &#123;</span><br><span class="line">            objc_setAssociatedObject(self, &amp;wd_id_key, newValue, objc_AssociationPolicy.OBJC_ASSOCIATION_ASSIGN)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>11ã€ä½¿ç”¨æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//1. åœ¨Appdelegateä¸­æ‰“å¼€æ•°æ®åº“</span><br><span class="line">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123;</span><br><span class="line">        DataBaseManager.defaultManger.creatTable()</span><br><span class="line">        return true</span><br><span class="line"> &#125;</span><br><span class="line">//2ã€æ·»åŠ æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.insert(model: model, successBlock: &#123;</span><br><span class="line">                print(&quot;æˆåŠŸ&quot;)</span><br><span class="line">            &#125;, failBlock: &#123;</span><br><span class="line">                 print(&quot;å¤±è´¥&quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">//3ã€ä¿®æ”¹æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.update(model: model, uid: self.model!.wd_fmdb_id!, successBlock: &#123;</span><br><span class="line">               print(&quot;æˆåŠŸ&quot;)</span><br><span class="line">            &#125;, failBlock: &#123;</span><br><span class="line">                print(&quot;å¤±è´¥&quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">//4ã€åˆ é™¤æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.delete(uid: model.wd_fmdb_id!, successBlock: &#123;</span><br><span class="line">                print(&quot;æˆåŠŸ&quot;)</span><br><span class="line">            &#125;, failBlock: &#123;</span><br><span class="line">                print(&quot;å¤±è´¥&quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">// 5ã€æŸ¥è¯¢æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.selectAll()</span><br></pre></td></tr></table></figure></p><ul><li>éµå¾ªNSCoding é‡å†™ä¸‰ä¸ªæ–¹æ³•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class Model: NSObject , NSCoding&#123;</span><br><span class="line"></span><br><span class="line">    public var name:String?</span><br><span class="line">    public var phone:String?</span><br><span class="line">    public var addres:String?</span><br><span class="line">    </span><br><span class="line">    override init() &#123;</span><br><span class="line">        super.init()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func encode(with aCoder: NSCoder) &#123;</span><br><span class="line">        aCoder.encode(name, forKey: &quot;name&quot;)</span><br><span class="line">        aCoder.encode(phone, forKey: &quot;phone&quot;)</span><br><span class="line">        aCoder.encode(addres, forKey: &quot;addres&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder aDecoder: NSCoder) &#123;</span><br><span class="line">        super.init()</span><br><span class="line">        self.name = aDecoder.decodeObject(forKey: &quot;name&quot;) as? String</span><br><span class="line">        self.addres = aDecoder.decodeObject(forKey: &quot;addres&quot;) as? String</span><br><span class="line">        self.phone = aDecoder.decodeObject(forKey: &quot;phone&quot;) as? String</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>12ã€æ•ˆæœå›¾</p><p><img src="https://upload-images.jianshu.io/upload_images/3334769-309b5904357f7e30.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></p><p>13ã€Demoåœ°å€:<a href="https://github.com/wudan-ios/FMDB-Model.git" target="_blank" rel="noopener">https://github.com/wudan-ios/FMDB-Model.git</a></p><hr><p>è¡¥å……Objective-Cç‰ˆæœ¬<br>1ã€æ¥å£æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface NSObject (addId)</span><br><span class="line"></span><br><span class="line">@property (nonatomic) NSInteger wd_fmdb_id;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">typedef void(^successBlock)(void);</span><br><span class="line">typedef void(^failBlock)(void);</span><br><span class="line"></span><br><span class="line">@interface WDDataBaseManager : NSObject</span><br><span class="line"></span><br><span class="line">+ (instancetype)manager;</span><br><span class="line">/** åˆ›å»ºè¡¨ */</span><br><span class="line">- (void)createTableWithName:(NSString *)name;</span><br><span class="line">/** åˆ é™¤è¡¨ */</span><br><span class="line">- (void)dropTable;</span><br><span class="line">/** æ·»åŠ æ•°æ® */</span><br><span class="line">- (void)insertDataWithModel:(NSObject *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;</span><br><span class="line">/** æ›´æ–°æ•°æ® */</span><br><span class="line">- (void)updateDataWithModel:(NSObject *)model uid:(NSInteger)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;</span><br><span class="line">/** åˆ é™¤æ•°æ® */</span><br><span class="line">- (void)deleteDataWithUid:(NSInteger)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;</span><br><span class="line">/** æŸ¥è¯¢å…¨éƒ¨æ•°æ® */</span><br><span class="line">- (NSArray&lt;NSObject *&gt; *)queryAllData;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure></p><p>2ã€å®ç°æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;WDDataBaseManager.h&quot;</span><br><span class="line">#import &lt;FMDB.h&gt;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static char *wd_id_key = &quot;key&quot;;</span><br><span class="line">@implementation NSObject (addId)</span><br><span class="line"></span><br><span class="line">- (NSInteger)wd_fmdb_id &#123;</span><br><span class="line">    NSNumber *numberValue = objc_getAssociatedObject(self, wd_id_key);</span><br><span class="line">    return numberValue.integerValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setWd_fmdb_id:(NSInteger)wd_fmdb_id &#123;</span><br><span class="line">    objc_setAssociatedObject(self, wd_id_key, @(wd_fmdb_id), OBJC_ASSOCIATION_ASSIGN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface WDDataBaseManager ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) FMDatabase *fmdb;</span><br><span class="line">@property (nonatomic, copy) NSString *tableName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WDDataBaseManager</span><br><span class="line"></span><br><span class="line">+ (instancetype)manager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static WDDataBaseManager *manager = nil;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        manager = [[WDDataBaseManager alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return manager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)createTableWithName:(NSString *)name &#123;</span><br><span class="line">    [self.fmdb open];</span><br><span class="line">    self.tableName = name;</span><br><span class="line">    NSString *sql = [NSString stringWithFormat:@&quot;create table if not exists %@ (id integer primary key autoincrement,model BLOB)&quot;, name];</span><br><span class="line">    BOOL result = [self.fmdb executeUpdate:sql];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        NSLog(@&quot;è¡¨åˆ›å»ºæˆåŠŸ&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dropTable &#123;</span><br><span class="line">    NSString *sql = [NSString stringWithFormat:@&quot;drop table if exists %@&quot;, self.tableName];</span><br><span class="line">    BOOL result = [self.fmdb executeUpdate:sql];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        NSLog(@&quot;è¡¨åˆ é™¤æˆåŠŸ&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)insertDataWithModel:(NSObject *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;</span><br><span class="line">    NSData *modelData = [NSKeyedArchiver archivedDataWithRootObject:model];</span><br><span class="line">    NSString *sql = [NSString stringWithFormat:@&quot;insert into %@ (model) values(?)&quot;, self.tableName];</span><br><span class="line">    BOOL result = [self.fmdb executeUpdate:sql withArgumentsInArray:@[modelData]];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        aSuccessBlock();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        aFailBlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)updateDataWithModel:(NSObject *)model uid:(NSInteger)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;</span><br><span class="line">    NSData *modelData = [NSKeyedArchiver archivedDataWithRootObject:model];</span><br><span class="line">    NSString *sql = [NSString stringWithFormat:@&quot;update %@ set model = ? where id = ?&quot;, self.tableName];</span><br><span class="line">    BOOL result = [self.fmdb executeUpdate:sql withArgumentsInArray:@[modelData, @(aUid)]];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        aSuccessBlock();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        aFailBlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)deleteDataWithUid:(NSInteger)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;</span><br><span class="line">    NSString *sql = [NSString stringWithFormat:@&quot;delete from %@ where id = ?&quot;, self.tableName];</span><br><span class="line">    BOOL result = [self.fmdb executeUpdate:sql withArgumentsInArray:@[@(uid)]];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        aSuccessBlock();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        aFailBlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;NSObject *&gt; *)queryAllData &#123;</span><br><span class="line">    NSMutableArray *array = [NSMutableArray array];</span><br><span class="line">    NSString *sql = [NSString stringWithFormat:@&quot;select * from %@&quot;,self.tableName];</span><br><span class="line">    @try &#123;</span><br><span class="line">        FMResultSet *rs = [self.fmdb executeQuery:sql];</span><br><span class="line">        while (rs.next) &#123;</span><br><span class="line">            NSObject *model = [[NSObject alloc] init];</span><br><span class="line">            NSData *modelData = [rs dataForColumn:@&quot;model&quot;];</span><br><span class="line">            int uid = [rs intForColumn:@&quot;id&quot;];</span><br><span class="line">            </span><br><span class="line">            model = [NSKeyedUnarchiver unarchiveObjectWithData:modelData];</span><br><span class="line">            model.wd_fmdb_id = uid;</span><br><span class="line">            [array addObject:model];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; @catch (NSException *exception) &#123;</span><br><span class="line">        NSLog(@&quot;%@&quot;, self.fmdb.lastError);</span><br><span class="line">    &#125; @finally &#123;</span><br><span class="line">        NSLog(@&quot;æŸ¥è¯¢æ•°æ®&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   return array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (FMDatabase *)fmdb &#123;</span><br><span class="line">    if (!_fmdb) &#123;</span><br><span class="line">        NSString *path = [NSHomeDirectory() stringByAppendingString:@&quot;/Documents/testDB.db&quot;];</span><br><span class="line">        _fmdb = [[FMDatabase alloc] initWithPath:path];</span><br><span class="line">    &#125;</span><br><span class="line">    return _fmdb;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><p>3ã€ä½¿ç”¨æ–¹æ³•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 1ã€æ‰“å¼€æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºè¡¨</span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    </span><br><span class="line">    [[WDDataBaseManager manager] createTableWithName:@&quot;test&quot;];</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line">// 2ã€æ·»åŠ æ•°æ®</span><br><span class="line"> [[WDDataBaseManager manager] insertDataWithModel:model successBlock:^&#123;</span><br><span class="line">        // TODO:</span><br><span class="line">    &#125; failBlock:^&#123;</span><br><span class="line">        // TODO:</span><br><span class="line">    &#125;];</span><br><span class="line">// 3ã€æŸ¥è¯¢æ•°æ®</span><br><span class="line">[[WDDataBaseManager manager] queryAllData]</span><br><span class="line">// 4ã€ä¿®æ”¹æ•°æ®</span><br><span class="line">[[WDDataBaseManager manager] updateDataWithModel:model uid:self.model.wd_fmdb_id successBlock:^&#123;</span><br><span class="line">        // TODO:</span><br><span class="line">    &#125; failBlock:^&#123;</span><br><span class="line">         // TODO:</span><br><span class="line">    &#125;];</span><br><span class="line">// 5ã€åˆ é™¤æ•°æ®</span><br><span class="line">[[WDDataBaseManager manager] deleteDataWithUid:model.wd_fmdb_id successBlock:^&#123;</span><br><span class="line">            // TODO:</span><br><span class="line">        &#125; failBlock:^&#123;</span><br><span class="line">            // TODO:</span><br><span class="line">        &#125;];</span><br><span class="line">// 6ã€åˆ é™¤è¡¨</span><br><span class="line">[[WDDataBaseManager manager] dropTable];</span><br></pre></td></tr></table></figure></p><ul><li>æ’å…¥è¡¨ä¸­çš„Modeléœ€è¦éµå¾ª<nscoding>(å®ä¾‹ä»£ç )<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)encodeWithCoder:(nonnull NSCoder *)aCoder &#123;</span><br><span class="line">    [aCoder encodeObject:self.name forKey:@&quot;name&quot;];</span><br><span class="line">    [aCoder encodeObject:self.phone forKey:@&quot;phone&quot;];</span><br><span class="line">    [aCoder encodeObject:self.address forKey:@&quot;address&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (nullable instancetype)initWithCoder:(nonnull NSCoder *)aDecoder &#123;</span><br><span class="line">    if (self == [super init]) &#123;</span><br><span class="line">        self.name = [aDecoder decodeObjectForKey:@&quot;name&quot;] ;</span><br><span class="line">        self.phone = [aDecoder decodeObjectForKey:@&quot;phone&quot;];</span><br><span class="line">        self.address = [aDecoder decodeObjectForKey:@&quot;address&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></nscoding></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/3334769-db9208d961eb67c2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;
      
    
    </summary>
    
    
  </entry>
  
</feed>
